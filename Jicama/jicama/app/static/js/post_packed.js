var app=angular.module('tempestApp',['ngAnimate','ui.router','ui.bootstrap','ncy-angular-breadcrumb','bm.uiTour','nvd3','rzModule',]).config(['$stateProvider','$urlRouterProvider','$breadcrumbProvider','$sceDelegateProvider','$uiViewScrollProvider','TourConfigProvider','$compileProvider','$locationProvider',function($stateProvider,$urlRouterProvider,$breadcrumbProvider,$sceDelegateProvider,$uiViewScrollProvider,TourConfigProvider,$compileProvider,$locationProvider){$uiViewScrollProvider.useAnchorScroll();$compileProvider.debugInfoEnabled(false);$compileProvider.commentDirectivesEnabled(false);$compileProvider.cssClassDirectivesEnabled(false);$locationProvider.html5Mode({enabled:true});$breadcrumbProvider.setOptions({prefixStateName:'home',template:'bootstrap2'});$urlRouterProvider.rule(function($injector,$location){var $rootScope=$injector.get("$rootScope");var currentUrl=$location.url().toLowerCase();var searchUrl=currentUrl.search("standalone");$rootScope.standalone=0;if(searchUrl==1)$rootScope.standalone=1;});$urlRouterProvider.otherwise(function($injector,$location){if($location.url()==='')return $location.path('/');if($location.url().length>200){console.log($location.url())
return;}
return $location.path('/404.html');});$sceDelegateProvider.resourceUrlWhitelist(['self','https://localhost:1028/#/**',]);$sceDelegateProvider.resourceUrlBlacklist([]);TourConfigProvider.enableNavigationInterceptors();}]).run(['$rootScope','$location','$transitions','$state','authService','$q','$sce','$window','$timeout','$anchorScroll',function($rootScope,$location,$transitions,$state,authService,$q,$sce,$window,$timeout,$anchorScroll){$rootScope.$state=$state;$rootScope.design_report_url='/design_report';$rootScope.imgPath='./static/img';$rootScope.standalone=0;$rootScope.loginMessage='';$rootScope.trustSrc=function(src){return $sce.trustAsResourceUrl(src);};$rootScope.trustHTML=function(src){return $sce.trustAsHtml(src);};$rootScope.has_access=function(){var isAuthenticated=authService.authenticated;var isDelinquent=authService.payment.delinquent;var isPaymentEnded=authService.payment.ended;return isAuthenticated&&!(isDelinquent||isPaymentEnded);};$timeout(function(){authService.hasHandledInfo();},3000);$transitions.onSuccess({},function(trans){$timeout(function(){$location.hash("topLevel");$anchorScroll();$location.hash("");},500);if(trans.to().name=="auth.logout"){$timeout(function(){$state.go("auth.home");},2000);}});$transitions.onBefore({},function(trans){var toState=trans.$to();var requireLogin=false;if(toState.name=="auth.home"){if(authService.authenticated)
return trans.router.stateService.target('account.home');}
var breadcrumb=toState.self.ncyBreadcrumb;if(breadcrumb){$window.document.title=breadcrumb.label;}
try{requireLogin=toState.data.requireLogin;}catch(e){}
try{ga('send','pageview',$location.path());}catch(error){}});}]);app.config(['$stateProvider',function($stateProvider){$stateProvider.state('home',{"data":{"requireLogin":false},"meta_desc":"Your Science. Our Tools. Fast Results.","ncyBreadcrumb":{"label":"MySampleSize","skip":true},"templateUrl":"static/partials//homepage.html","url":"/"})
.state('error',{"ncyBreadcrumb":{"label":"Error"},"templateUrl":"static/partials/webpage_core/404.html","url":"/404.html"})
.state('design_guide',{"controller":"designguideController","data":{"requireLogin":false},"meta_desc":"A step-by-step guide to designing your study.","ncyBreadcrumb":{"label":"Design Guide"},"templateUrl":"static/partials/webpage_design/design.guide.html","url":"/design_guide"})
.state('tools',{"abstract":true,"controller":"toolsController","data":{"requireLogin":false},"templateUrl":"static/partials//tools.html","url":"/tools"})
.state('tools.home',{"meta_desc":"MySampleSize Tools: calculate sample size, statistical power, and simulate a study","ncyBreadcrumb":{"label":"Tools Home"},"templateUrl":"static/partials/webpage_tools/tools.home.html","url":"/"})
.state('tools.samplesize',{"data":{"requireLogin":false},"meta_desc":"Calculate your sample size with this easy-to-use interface.","ncyBreadcrumb":{"label":"Sample Size","parent":"tools.home"},"templateUrl":"static/partials/webpage_tools/tools.skel.html","url":"/sample_size"})
.state('tools.powersize',{"data":{"requireLogin":false},"meta_desc":"Calculate your statistical power based on a given sample size.","ncyBreadcrumb":{"label":"Statistical Power","parent":"tools.home"},"templateUrl":"static/partials/webpage_tools/tools.skel.html","url":"/power_size"})
.state('tools.pwrgraph',{"data":{"requireLogin":false},"meta_desc":"Explore the tradeoff between power and sample size.","ncyBreadcrumb":{"label":"Power Plots","parent":"tools.home"},"templateUrl":"static/partials/webpage_tools/tools.skel.html","url":"/power_graph"})
.state('tools.rng',{"controller":"rngController","meta_desc":"Random number generator for blocking your experimental design","ncyBreadcrumb":{"label":"Random Number Generator","parent":"tools.home"},"templateUrl":"static/partials/webpage_tools/tools.skel.html","url":"/rng"})
.state('tools.analysis',{"data":{"requireLogin":false},"meta_desc":"Data analysis","ncyBreadcrumb":{"label":"Data analysis","parent":"tools.home"},"templateUrl":"static/partials/webpage_tools/tools.skel.html","url":"/analysis"})
.state('tools.sims',{"data":{"requireLogin":false},"meta_desc":"Simulate outcomes of your study.","ncyBreadcrumb":{"label":"Simulations","parent":"tools.home"},"templateUrl":"static/partials/webpage_tools/tools.skel.html","url":"/simulations"})
.state('tools.report',{"controller":"reportsController","data":{"requireLogin":false},"meta_desc":"Generate a report of our power and sample size calculations to submit for your proposal","ncyBreadcrumb":{"label":"Summary Report","parent":"tools.home"},"templateUrl":"static/partials/webpage_reports/report.tools.html","url":"/report"})
.state('auth',{"abstract":true,"data":{"requireLogin":false},"templateUrl":"static/partials//auth.html","url":"/auth"})
.state('auth.home',{"ncyBreadcrumb":{"label":"Account"},"templateUrl":"static/partials/webpage_auth/home.html","url":"/home"})
.state('auth.signup',{"ncyBreadcrumb":{"label":"Sign Up"},"templateUrl":"static/partials/webpage_auth/signup.html","url":"/signup"})
.state('auth.logout',{"ncyBreadcrumb":{"label":"Logout"},"templateUrl":"static/partials/webpage_auth/logout.html","url":"/logout.html"})
.state('account',{"abstract":true,"controller":"myAccountController","data":{"requireLogin":true},"ncyBreadcrumb":{"label":"My Account"},"templateUrl":"static/partials//auth.html","url":"/account","resolve":{"promise1":['authService',function(authService){return authService.hasHandledInfo();}],},})
.state('account.home',{"ncyBreadcrumb":{"label":"My Account","parent":"account"},"templateUrl":"static/partials/webpage_auth/account.html","url":"/"})
.state('account.billing',{"ncyBreadcrumb":{"label":"Billing","parent":"account.home"},"templateUrl":"static/partials/webpage_auth/account.payment.html","url":"/billing"})
.state('account.update',{"ncyBreadcrumb":{"label":"Change Password","parent":"account.home"},"templateUrl":"static/partials/webpage_auth/account.update_password.html","url":"/update"})
.state('account.projects',{"ncyBreadcrumb":{"label":"Projects","parent":"account.home"},"templateUrl":"static/partials/webpage_reports/report.user_projects.html","url":"/projects"})
.state('report',{"abstract":true,"controller":"reportsController","data":{"requireLogin":false},"templateUrl":"static/partials//report.html","url":"/report"})
.state('report.home',{"ncyBreadcrumb":{"label":"Reports"},"templateUrl":"static/partials/webpage_reports/report.home.html","url":"/"})
.state('report.supplement',{"controller":"reportSupplementController","ncyBreadcrumb":{"label":"Supplement","parent":"report.home"},"templateUrl":"static/partials/webpage_reports/report.supplement.html","url":"/supplement"})
.state('report.checklist',{"ncyBreadcrumb":{"label":"Checklist","parent":"report.home"},"templateUrl":"static/partials/webpage_reports/report.checklist.html","url":"/checklist"})
.state('report.user',{"data":{"requireLogin":false},"ncyBreadcrumb":{"label":"User Projects","parent":"report.home"},"templateUrl":"static/partials/webpage_reports/report.user_projects.html","url":"/userprojects"})
.state('report.power',{"data":{"requireLogin":false},"ncyBreadcrumb":{"label":"Sample Size and Power","parent":"report.home"},"templateUrl":"static/partials/webpage_reports/report.tools.html","url":"/power"})
.state('help',{"abstract":true,"controller":"HelpCtrl","data":{"requireLogin":false},"templateUrl":"static/partials//help.html","url":"/help"})
.state('help.home',{"data":{"requireLogin":false},"meta_desc":"Help on statistical basics, different types of tests, and case studies to use with our tools.","ncyBreadcrumb":{"label":"Help"},"templateUrl":"static/partials/webpage_help/help.home.html","url":"/"})
.state('help.faq',{"data":{"requireLogin":false},"ncyBreadcrumb":{"label":"FAQ","parent":"help.home"},"templateUrl":"static/partials/webpage_help/help.faq.html","url":"/faq"})
.state('help.glossary',{"ncyBreadcrumb":{"label":"Glossary","parent":"help.home"},"templateUrl":"static/partials/webpage_help/help.glossary.html","url":"/glossary"})
.state('help.case',{"meta_desc":"Real case studies to explore our tools with.","ncyBreadcrumb":{"label":"Case Studies","parent":"help.home"},"templateUrl":"static/partials/webpage_help/help.case.html","url":"/casestudies"})
.state('help.contact',{"meta_desc":"Need help or more information? Contact us!","ncyBreadcrumb":{"label":"Contact Us"},"templateUrl":"static/partials/webpage_help/help.contact.html","url":"/contact_us"})
.state('help.designtype',{"meta_desc":"Explore different design types (e.g. randomized, blocked, crossover)","ncyBreadcrumb":{"label":"Design Types","parent":"help.home"},"templateUrl":"static/partials/webpage_help/designtype/design.type.main.html","url":"/designtypes"})
.state('help.tutorial',{"abstract":true,"meta_desc":"A tutorial on how to use all the tools on our site","ncyBreadcrumb":{"label":"Tutorial","parent":"help.home"},"template":"<div ui-view autoscroll='True'></div>","url":"/tutorial"})
.state('help.stattests',{"abstract":true,"meta_desc":"Explore the difference between different tests, like T-Test, ANOVAs, and Repeated Measures.","ncyBreadcrumb":{"label":"Statistical Tests","parent":"help.home"},"template":"<div ui-view autoscroll='True'></div>","url":"/stattests"})
.state('help.statbasics',{"abstract":true,"controller":"basicsPlotCtrl","meta_desc":"Statistical basics with an emphasis on effect size, sample size, and power","ncyBreadcrumb":{"label":"Statistical Basics","parent":"help.home"},"template":"<div ui-view autoscroll='True'></div>","url":"/statbasics"})
.state('help.tutorial.home',{"url":'/',"templateUrl":'static/partials/webpage_help/tutorial/tutorial.main.html',"ncyBreadcrumb":{"parent":'help.home',"label":'Tutorial'}}).state('help.tutorial.overview',{"url":'/overview',"templateUrl":'static/partials/webpage_help/tutorial/tutorial.overview.html',"ncyBreadcrumb":{"parent":'help.tutorial.home',"label":'Overview'}}).state('help.tutorial.designguide',{"url":'/designguide',"templateUrl":'static/partials/webpage_help/tutorial/tutorial.designguide.html',"ncyBreadcrumb":{"parent":'help.tutorial.home',"label":'Design Guide'}}).state('help.tutorial.tools',{"url":'/tools',"templateUrl":'static/partials/webpage_help/tutorial/tutorial.tools.html',"ncyBreadcrumb":{"parent":'help.tutorial.home',"label":'Tools'}}).state('help.tutorial.reports',{"url":'/reports',"templateUrl":'static/partials/webpage_help/tutorial/tutorial.reports.html',"ncyBreadcrumb":{"parent":'help.tutorial.home',"label":'Reports'}}).state('help.stattests.home',{"url":'/',"templateUrl":'static/partials/webpage_help/stattests/stat.test.main.html',"ncyBreadcrumb":{"parent":'help.home',"label":'Statistical Tests'}}).state('help.stattests.overview',{"url":'/overview',"templateUrl":'static/partials/webpage_help/stattests/stat.test.overview.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'Overview'}}).state('help.stattests.sig',{"url":'/significance',"templateUrl":'static/partials/webpage_help/stattests/stat.test.sig.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'Significance and Power'}}).state('help.stattests.mean_std_es',{"url":'/mean_std_es',"templateUrl":'static/partials/webpage_help/stattests/stat.test.mean_std_es.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'Mean, Standard Deviation, and Effect Size'}}).state('help.stattests.ttest_def',{"url":'/ttest_def',"templateUrl":'static/partials/webpage_help/stattests/stat.test.ttest_def.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'Definitions'}}).state('help.stattests.t1',{"url":'/t1',"templateUrl":'static/partials/webpage_help/stattests/stat.test.t1.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'One-Sample T-Test'}}).state('help.stattests.t2',{"url":'/t2',"templateUrl":'static/partials/webpage_help/stattests/stat.test.t2.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'Paired T-Test'}}).state('help.stattests.tI',{"url":'/tI',"templateUrl":'static/partials/webpage_help/stattests/stat.test.tI.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'Independent-Sample T-Test'}}).state('help.stattests.anova_def',{"url":'/anova_def',"templateUrl":'static/partials/webpage_help/stattests/stat.test.anova_def.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'Definitions'}}).state('help.stattests.anova',{"url":'/anova',"templateUrl":'static/partials/webpage_help/stattests/stat.test.anova.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'ANOVA'}}).state('help.stattests.2anova',{"url":'/2anova',"templateUrl":'static/partials/webpage_help/stattests/stat.test.2anova.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'2-Way ANOVA'}}).state('help.stattests.3anova',{"url":'/3anova',"templateUrl":'static/partials/webpage_help/stattests/stat.test.3anova.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'3-Way ANOVA'}}).state('help.stattests.anova_rep',{"url":'/anova_rep',"templateUrl":'static/partials/webpage_help/stattests/stat.test.anova_rep.html',"ncyBreadcrumb":{"parent":'help.stattests.home',"label":'Repeated Measures ANOVA'}}).state('help.statbasics.home',{"url":'/',"templateUrl":'static/partials/webpage_help/statbasics/basics.main.html',"ncyBreadcrumb":{"parent":'help.home',"label":'Statistical Basics'}}).state('standalone',{"url":'/standalone',"template":"<div ui-view autoscroll='True'></div>","abstract":true,"controller":"basicsPlotCtrl"}).state('help.statbasics.overview',{"url":'/overview',"templateUrl":'static/partials/webpage_help/statbasics/basics.overview.html',"ncyBreadcrumb":{"parent":'help.statbasics.home',"label":'Overview'}}).state('standalone.overview',{"url":'/overview',"templateUrl":'static/partials/webpage_help/statbasics/basics.overview.html',"ncyBreadcrumb":{"label":'Overview'}}).state('help.statbasics.sig',{"url":'/significance',"templateUrl":'static/partials/webpage_help/statbasics/basics.sig.html',"ncyBreadcrumb":{"parent":'help.statbasics.home',"label":'Significance'}}).state('standalone.sig',{"url":'/significance',"templateUrl":'static/partials/webpage_help/statbasics/basics.sig.html',"ncyBreadcrumb":{"label":'Significance'}}).state('help.statbasics.stdev',{"url":'/stdev',"templateUrl":'static/partials/webpage_help/statbasics/basics.stdev.html',"ncyBreadcrumb":{"parent":'help.statbasics.home',"label":'Standard Deviation'}}).state('standalone.stdev',{"url":'/stdev',"templateUrl":'static/partials/webpage_help/statbasics/basics.stdev.html',"ncyBreadcrumb":{"label":'Standard Deviation'}}).state('help.statbasics.groups',{"url":'/groups',"templateUrl":'static/partials/webpage_help/statbasics/basics.groups.html',"ncyBreadcrumb":{"parent":'help.statbasics.home',"label":'Groups and Factors'}}).state('standalone.groups',{"url":'/groups',"templateUrl":'static/partials/webpage_help/statbasics/basics.groups.html',"ncyBreadcrumb":{"label":'Groups and Factors'}}).state('help.statbasics.samplesize',{"url":'/samplesize',"templateUrl":'static/partials/webpage_help/statbasics/basics.samplesize.html',"ncyBreadcrumb":{"parent":'help.statbasics.home',"label":'Sample Size'}}).state('standalone.samplesize',{"url":'/samplesize',"templateUrl":'static/partials/webpage_help/statbasics/basics.samplesize.html',"ncyBreadcrumb":{"label":'Sample Size'}}).state('help.statbasics.effect',{"url":'/effect',"templateUrl":'static/partials/webpage_help/statbasics/basics.effect.html',"ncyBreadcrumb":{"parent":'help.statbasics.home',"label":'Effect Size'}}).state('standalone.effect',{"url":'/effect',"templateUrl":'static/partials/webpage_help/statbasics/basics.effect.html',"ncyBreadcrumb":{"label":'Effect Size'}}).state('help.statbasics.power',{"url":'/power',"templateUrl":'static/partials/webpage_help/statbasics/basics.power.html',"ncyBreadcrumb":{"parent":'help.statbasics.home',"label":'power'}}).state('standalone.power',{"url":'/power',"templateUrl":'static/partials/webpage_help/statbasics/basics.power.html',"ncyBreadcrumb":{"label":'power'}}).state('help.statbasics.effect_anova',{"url":'/effect_anova',"templateUrl":'static/partials/webpage_help/statbasics/basics.effect_anova.html',"ncyBreadcrumb":{"parent":'help.statbasics.home',"label":'Effect Size in ANOVA'}}).state('standalone.effect_anova',{"url":'/effect_anova',"templateUrl":'static/partials/webpage_help/statbasics/basics.effect_anova.html',"ncyBreadcrumb":{"label":'Effect Size in ANOVA'}}).state('help.statbasics.effect_cohen',{"url":'/effect_cohen',"templateUrl":'static/partials/webpage_help/statbasics/basics.effect_cohen.html',"ncyBreadcrumb":{"parent":'help.statbasics.home',"label":'Cohen`s d and f Values'}}).state('standalone.effect_cohen',{"url":'/effect_cohen',"templateUrl":'static/partials/webpage_help/statbasics/basics.effect_cohen.html',"ncyBreadcrumb":{"label":'Cohen`s d and f Values'}})}]);app.controller('rootController',['$scope','$state','$rootScope','authService','$document','$timeout',rootController]);function rootController($scope,$state,$rootScope,authService,$document,$timeout)
{$scope.state=$state;$scope.getCurrentStateName=function(){return $scope.$state.current.name;};$scope.standalone=0;$rootScope.$watch('standalone',function(){$scope.standalone=$rootScope.standalone;});$scope.scrollToElementById=function(idname){$timeout(function(){var res=document.getElementById(idname);var ae=angular.element(res);$document.duScrollToElement(ae,300,750);},100);};$scope.range=function(n){var arr=[];for(var ii=0;ii<n;ii++){arr.push(ii);}
return arr;};$scope.authService=authService;};var mpath='static/module_modals/modal_templates/';app.controller('ModalInstanceCtrl',['$scope','$uibModalInstance','designService',function($scope,$uibModalInstance,designService){$scope.treatment_table=designService.treatment_table;$scope.ok=function(){$uibModalInstance.close('ok');};$scope.cancel=function(){$uibModalInstance.dismiss('cancel');};}]);app.controller('ModalInstanceCtrl_designGuideExample',['$scope','$uibModalInstance','designService','$state',function($scope,$uibModalInstance,designService,$state){$scope.ok=function(){designService.treatment_table=null;designService.formData.hypothesis="Pharmacological activation of Group II metabotropic glutamate receptors with compound DCG-IV will reduce neuronal cell degeneration measured at 24 hours after experimental TBI in rats."
$scope.formData.outMeas="degenerating cells";designService.formData.obsUnits="number of cells";$scope.formData.effectSize="75";$scope.formData.effectSizeLarge="125";$scope.formData.stdev="125";designService.formData.treatments=[{level:[{id:1,name:"20 fmol DCG-IV"},{id:2,name:"100 fmol DCG-IV"},{id:3,name:"500 fmol DCG-IV"},],description:"drug",control:{name:"Vehicle",id:0},control_desc:"Artificial CSF"}];designService.formData.factors=[];$state.go("design_guide")
$uibModalInstance.close('ok');};$scope.cancel=function(){$uibModalInstance.dismiss('cancel');};}]);function designGuide_modals($scope,$rootScope,$uibModal){$scope.animationsEnabled=true;$scope.moreInfo="<hr> Click for more.";$scope.tooltip={},$scope.init=function()
{$scope.tooltip.hypothesis='A clear statement postulating how your experimental system will behave.';$scope.tooltip.outcomeMeas='A quantity you will measure in order to investigate your hypothesis.';$scope.tooltip.obsUnits='Smallest unit from which to measure a response.';$scope.tooltip.baseline='Measurements taken before the treatment is applied.';$scope.tooltip.ctrl='Multiple control types can be used.';$scope.tooltip.covariates='A characteristic of test subjects that varies continuously, like mass or age.';$scope.tooltip.factors='A characteristic of test subjects that lies in discrete categories, like sex or litter.';$scope.tooltip.largeDiff='The number you enter should be in the same units as your outcome measure (e.g. g, cm, sec). Its value is an optimistic estimate of the effect size.  The number is used as an upper bound for possible effect sizes.';$scope.tooltip.smallDiff='The number you enter should be in the same units as your outcome measure (e.g. g, cm, sec). This value will represent a lower bound on your effect size and give you a conservative estimate for sample size. This value will be used in the calculation of power and sample size.';$scope.tooltip.outcomeSD='Enter the subject-to-subject variability in the units of the outcome measure.';$scope.tooltip.listTreat='List multiple treatments and levels.';$scope.tooltip.addTreat='Add treatments by clicking the button.';$scope.tooltip.repMeasPSWS='Enter the Standard Deviation (between 0.01 and 500).';$scope.tooltip.repMeasPSBS='Enter the Standard Deviation (between 0.01 and 500).';$scope.tooltip.typeStatTest='Go through our DesignGuide for a recommendation.';$scope.tooltip.csvdata='You can enter data directly into the text box below or upload a CSV file. Click here for more information about data formatting.';$scope.tooltip.analyzedata='';for(var ii in $scope.tooltip)
{$scope.tooltip[ii]=$rootScope.trustHTML($scope.tooltip[ii]+$scope.moreInfo);}
$scope.tooltip.outcomeUnits='The units of measure for your outcome.';$scope.tooltip.pilot='A pilot study is a preliminary experiment that helps refine your research.';$scope.tooltip.litSources='Prior work on related hypotheses with similar subjects can help with experimental design.';$scope.tooltip.addlCtrl='Additional controls may be useful when a researcher is concerned about the impact of experiment\'s steps on the outcome. Checking outcomes in the presence of incremental changes can help diagnose unexpected results and maintain adherence to procedures. Generally speaking additional control groups do not come into play for considerations of statistical power, but they will increase the sample size needed.';};$scope.init();$scope.open=function(name,size)
{var filename='error.html';var ctrl='ModalInstanceCtrl';switch(name)
{case'example':filename='designGuide.example.html';ctrl='ModalInstanceCtrl_designGuideExample';break;case'hypothesis':filename='design.hypothesis.html';break;case'outcomeMeas':filename='design.outcomeMeas.html';break;case'obsUnits':filename='design.obsUnits.html';break;case'baseline':filename='design.baseline.html';break;case'ctrl':filename='design.control.html';break;case'covariates':filename='design.covariates.html';break;case'factors':filename='design.factors.html';break;case'largeDiff':filename='design.largeDiff.html';break;case'smallDiff':filename='design.smallDiff.html';break;case'outcomeSD':filename='design.outcomeSD.html';break;case'sdWithinSubjects':filename='design.sdWithinSubjects.html';break;case'sdBetweenSubjects':filename='design.sdBetweenSubjects.html';break;case'listTreat':filename='design.treatmentsLevels.html';break;case'addTreat':filename='design.treatment.html';break;case'csvdata':filename='data.analysis.html';break;case'analyzedata':filename='button.analyzedata.html';break;default:return;break;}
var modalInstance=$uibModal.open({animation:$scope.animationsEnabled,templateUrl:mpath+filename,controller:ctrl,size:size});};$scope.toggleAnimation=function(){$scope.animationsEnabled=!$scope.animationsEnabled;};};designGuide_modals.$inject=['$scope','$rootScope','$uibModal'];app.controller('designGuide_modals',designGuide_modals);app.controller('menu_modal',['$scope','$uibModal',function($scope,$uibModal){$scope.animationsEnabled=true;$scope.open=function(size)
{var modalInstance=$uibModal.open({animation:$scope.animationsEnabled,templateUrl:mpath+'mini-menu.html',controller:'ModalInstanceCtrl',size:size});};$scope.toggleAnimation=function(){$scope.animationsEnabled=!$scope.animationsEnabled;};}]);'use strict';app.directive('tooltip',[function(){return{restrict:'E',scope:{content:'=',},template:'<span class="fa-stack" uib-tooltip="{{content}}" '+
'         tooltip-placement="top-right" '+
'         tooltip-class="customClass"> '+
'     <i class="fa fa-circle fa-stack-2x"></i>'+
'     <i class="fa fa-question fa-stack-1x"></i>'+
'</span>'};}]);app.directive('tooltipModal',['$uibModal',function($uibModal){return{restrict:'E',controller:designGuide_modals,transclude:true,scope:{content:'@',modal:'='},link:function(scope,elem,attrs,ctrl){},template:'<span ng-controller="designGuide_modals" class="fa-stack" '+
'         uib-tooltip-html="{{content}}" '+
'         ng-click="open(modal)" '+
'         tooltip-placement="top-right" tooltip-class="customClass">'+
'     <i class="fa fa-circle fa-stack-2x"></i>'+
'     <i class="fa fa-question fa-stack-1x"></i>'+
'</span>'};}]);app.directive('tooltipLink',['$uibModal',function($uibModal){return{restrict:'E',controller:['$scope','$rootScope','$uibModal',function($scope,$rootScope,$uibModal){$scope.tooltip={};function init()
{$scope.tooltip={std:'Enter the Standard Deviation (between 0.01 and 500).',sig:'A common value is 0.05.',effect:'Enter a number for the effect size.',effectAbs:'The effect size in terms of your units as entered in the DesignGuide.',sample:'Select a whole number between 2 and 500.',power:'A power of 0.8 or higher is often used.',groups:'Select the total number of levels in one factor (a Treatment or Nontreatment) in your design. Go through our DesignGuide for a recommendation.',factors:'Enter the number of factors. (Default 3.  If more than 3, consult a statistician.)',};var moreInfo="<hr> Click for more detailed help.";for(var ii in $scope.tooltip)
{$scope.tooltip[ii]=$rootScope.trustHTML($scope.tooltip[ii]+moreInfo);}};init();}],scope:{content:'=',url:'@'},template:'<a ui-sref="{{url}}" target="_blank">'+
'  <span class="text-black fa-stack" '+
'         uib-tooltip-html="{{content}}" '+
'         tooltip-placement="top-right" '+
'         tooltip-class="customClass">'+
'     <i class="fa fa-circle fa-stack-2x"></i>'+
'     <i class="fa fa-question fa-stack-1x"></i>'+
'  </span>'+
'</a>'};}]);app.directive('tooltipWarn',[function(){return{restrict:'E',scope:{content:'=',},template:'<span ng-controller="designGuide_modals" class="fa-stack" '+
'         uib-tooltip="{{content}}" tooltip-placement="top-right" '+
'         tooltip-class="customClass"> '+
'     <i style="color:red;" class="fa fa-circle fa-stack-2x"></i>'+
'     <i class="fa fa-exclamation fa-stack-1x"></i>'+
'</span>'};}]);app.directive('rLogo',[function(){return{restrict:'E',scope:true,template:'<img ng-src="{{imgPath}}/logos/Rlogo.png"></img>'};}]);app.directive('katex',[function(){function render(katex,text,element){try{katex.render(text,element[0]);}
catch(err){element.html("<div class='alert alert-danger' role='alert'>"+err+"</div>");}};return{restrict:'AE',link:function(scope,element){var text=element.html();text=text.replace(/&amp;/g,'&');if(element[0].tagName==='DIV'){element.addClass('text-center');text='\\displaystyle {'+text+'}';element.addClass('katex-outer').html();}
if(typeof(katex)==='undefined')
require(['katex'],function(katex){render(katex,text,element);});else
render(katex,text,element);}};}]);app.directive('spinnerImgLoad',function(){return{restrict:'A',link:function(scope,element){element.after('<span class="loading"> <i class="fa fa-circle-o-notch fa-spin text-grey fa-2x"></i> </span>');element.on('load',function(){element.parent().find('span').remove();});scope.$watch('ngSrc',function(){});}};});app.directive('spinnerDivLoad',function(){return{restrict:'A',link:function(scope,element,attrs){var originalContent=element.html();element.after('<div class="row text-center padding-2em"><span class="loading"> <i class="fa fa-circle-o-notch fa-spin text-grey fa-3x"></i> </span></div>');element.addClass('hidden');element.ready(function(){element.removeClass('hidden');element.parent().find('span').remove();});}};});app.directive('uibHeadingWithIcon',[function(){return{restrict:'E',transclude:true,scope:{title:'=',active:'='},template:'<uib-accordion-heading> <p style="margin-bottom: 0;"> {{title}} <i class="pull-right fa" ng-class="{\'fa-minus\': active, \'fa-plus\': !active }"></i></p>  </uib-accordion-heading>'};}]);'use strict';app.directive('effectSize',[function(){return{restrict:'E',scope:true,template:'<a class="keyword-directive" ui-sref="help.statbasics.effect">effect size</a>'};}]);app.directive('standardDeviation',[function(){return{restrict:'E',scope:true,template:'<a class="keyword-directive" ui-sref="help.statbasics.stdev">standard deviation</a>'};}]);app.directive('power',[function(){return{restrict:'E',scope:true,template:'<a class="keyword-directive" ui-sref="help.statbasics.power">power</a>'};}]);app.directive('significance',[function(){return{restrict:'E',scope:true,template:'<a class="keyword-directive" ui-sref="help.statbasics.sig">significance</a>'};}]);(function(window,angular){'use strict';var $sanitizeMinErr=angular.$$minErr('$sanitize');var bind;var extend;var forEach;var isArray;var isDefined;var lowercase;var noop;var nodeContains;var htmlParser;var htmlSanitizeWriter;function $SanitizeProvider(){var hasBeenInstantiated=false;var svgEnabled=false;this.$get=['$$sanitizeUri',function($$sanitizeUri){hasBeenInstantiated=true;if(svgEnabled){extend(validElements,svgElements);}
return function(html){var buf=[];htmlParser(html,htmlSanitizeWriter(buf,function(uri,isImage){return!/^unsafe:/.test($$sanitizeUri(uri,isImage));}));return buf.join('');};}];this.enableSvg=function(enableSvg){if(isDefined(enableSvg)){svgEnabled=enableSvg;return this;}else{return svgEnabled;}};this.addValidElements=function(elements){if(!hasBeenInstantiated){if(isArray(elements)){elements={htmlElements:elements};}
addElementsTo(svgElements,elements.svgElements);addElementsTo(voidElements,elements.htmlVoidElements);addElementsTo(validElements,elements.htmlVoidElements);addElementsTo(validElements,elements.htmlElements);}
return this;};this.addValidAttrs=function(attrs){if(!hasBeenInstantiated){extend(validAttrs,arrayToMap(attrs,true));}
return this;};bind=angular.bind;extend=angular.extend;forEach=angular.forEach;isArray=angular.isArray;isDefined=angular.isDefined;lowercase=angular.$$lowercase;noop=angular.noop;htmlParser=htmlParserImpl;htmlSanitizeWriter=htmlSanitizeWriterImpl;nodeContains=window.Node.prototype.contains||function(arg){return!!(this.compareDocumentPosition(arg)&16);};var SURROGATE_PAIR_REGEXP=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,NON_ALPHANUMERIC_REGEXP=/([^#-~ |!])/g;var voidElements=stringToMap('area,br,col,hr,img,wbr');var optionalEndTagBlockElements=stringToMap('colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr'),optionalEndTagInlineElements=stringToMap('rp,rt'),optionalEndTagElements=extend({},optionalEndTagInlineElements,optionalEndTagBlockElements);var blockElements=extend({},optionalEndTagBlockElements,stringToMap('address,article,'+
'aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,'+
'h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,section,table,ul'));var inlineElements=extend({},optionalEndTagInlineElements,stringToMap('a,abbr,acronym,b,'+
'bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,'+
'samp,small,span,strike,strong,sub,sup,time,tt,u,var'));var svgElements=stringToMap('circle,defs,desc,ellipse,font-face,font-face-name,font-face-src,g,glyph,'+
'hkern,image,linearGradient,line,marker,metadata,missing-glyph,mpath,path,polygon,polyline,'+
'radialGradient,rect,stop,svg,switch,text,title,tspan');var blockedElements=stringToMap('script,style');var validElements=extend({},voidElements,blockElements,inlineElements,optionalEndTagElements);var uriAttrs=stringToMap('background,cite,href,longdesc,src,xlink:href,xml:base');var htmlAttrs=stringToMap('abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,'+
'color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,'+
'ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,'+
'scope,scrolling,shape,size,span,start,summary,tabindex,target,title,type,'+
'valign,value,vspace,width');var svgAttrs=stringToMap('accent-height,accumulate,additive,alphabetic,arabic-form,ascent,'+
'baseProfile,bbox,begin,by,calcMode,cap-height,class,color,color-rendering,content,'+
'cx,cy,d,dx,dy,descent,display,dur,end,fill,fill-rule,font-family,font-size,font-stretch,'+
'font-style,font-variant,font-weight,from,fx,fy,g1,g2,glyph-name,gradientUnits,hanging,'+
'height,horiz-adv-x,horiz-origin-x,ideographic,k,keyPoints,keySplines,keyTimes,lang,'+
'marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mathematical,'+
'max,min,offset,opacity,orient,origin,overline-position,overline-thickness,panose-1,'+
'path,pathLength,points,preserveAspectRatio,r,refX,refY,repeatCount,repeatDur,'+
'requiredExtensions,requiredFeatures,restart,rotate,rx,ry,slope,stemh,stemv,stop-color,'+
'stop-opacity,strikethrough-position,strikethrough-thickness,stroke,stroke-dasharray,'+
'stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,'+
'stroke-width,systemLanguage,target,text-anchor,to,transform,type,u1,u2,underline-position,'+
'underline-thickness,unicode,unicode-range,units-per-em,values,version,viewBox,visibility,'+
'width,widths,x,x-height,x1,x2,xlink:actuate,xlink:arcrole,xlink:role,xlink:show,xlink:title,'+
'xlink:type,xml:base,xml:lang,xml:space,xmlns,xmlns:xlink,y,y1,y2,zoomAndPan',true);var validAttrs=extend({},uriAttrs,svgAttrs,htmlAttrs);function stringToMap(str,lowercaseKeys){return arrayToMap(str.split(','),lowercaseKeys);}
function arrayToMap(items,lowercaseKeys){var obj={},i;for(i=0;i<items.length;i++){obj[lowercaseKeys?lowercase(items[i]):items[i]]=true;}
return obj;}
function addElementsTo(elementsMap,newElements){if(newElements&&newElements.length){extend(elementsMap,arrayToMap(newElements));}}
var getInertBodyElement =(function(window,document){var inertDocument;if(document&&document.implementation){inertDocument=document.implementation.createHTMLDocument('inert');}else{throw $sanitizeMinErr('noinert','Can\'t create an inert html document');}
var inertBodyElement=(inertDocument.documentElement||inertDocument.getDocumentElement()).querySelector('body');inertBodyElement.innerHTML='<svg><g onload="this.parentNode.remove()"></g></svg>';if(!inertBodyElement.querySelector('svg')){return getInertBodyElement_XHR;}else{inertBodyElement.innerHTML='<svg><p><style><img src="</style><img src=x onerror=alert(1)//">';if(inertBodyElement.querySelector('svg img')){return getInertBodyElement_DOMParser;}else{return getInertBodyElement_InertDocument;}}
function getInertBodyElement_XHR(html){html='<remove></remove>'+html;try{html=encodeURI(html);}catch(e){return undefined;}
var xhr=new window.XMLHttpRequest();xhr.responseType='document';xhr.open('GET','data:text/html;charset=utf-8,'+html,false);xhr.send(null);var body=xhr.response.body;body.firstChild.remove();return body;}
function getInertBodyElement_DOMParser(html){html='<remove></remove>'+html;try{var body=new window.DOMParser().parseFromString(html,'text/html').body;body.firstChild.remove();return body;}catch(e){return undefined;}}
function getInertBodyElement_InertDocument(html){inertBodyElement.innerHTML=html;if(document.documentMode){stripCustomNsAttrs(inertBodyElement);}
return inertBodyElement;}})(window,window.document);function htmlParserImpl(html,handler){if(html===null||html===undefined){html='';}else if(typeof html!=='string'){html=''+html;}
var inertBodyElement=getInertBodyElement(html);if(!inertBodyElement)return'';var mXSSAttempts=5;do{if(mXSSAttempts===0){throw $sanitizeMinErr('uinput','Failed to sanitize html because the input is unstable');}
mXSSAttempts--;html=inertBodyElement.innerHTML;inertBodyElement=getInertBodyElement(html);}while(html!==inertBodyElement.innerHTML);var node=inertBodyElement.firstChild;while(node){switch(node.nodeType){case 1:handler.start(node.nodeName.toLowerCase(),attrToMap(node.attributes));break;case 3:handler.chars(node.textContent);break;}
var nextNode;if(!(nextNode=node.firstChild)){if(node.nodeType===1){handler.end(node.nodeName.toLowerCase());}
nextNode=getNonDescendant('nextSibling',node);if(!nextNode){while(nextNode==null){node=getNonDescendant('parentNode',node);if(node===inertBodyElement)break;nextNode=getNonDescendant('nextSibling',node);if(node.nodeType===1){handler.end(node.nodeName.toLowerCase());}}}}
node=nextNode;}
while((node=inertBodyElement.firstChild)){inertBodyElement.removeChild(node);}}
function attrToMap(attrs){var map={};for(var i=0,ii=attrs.length;i<ii;i++){var attr=attrs[i];map[attr.name]=attr.value;}
return map;}
function encodeEntities(value){return value.replace(/&/g,'&amp;').replace(SURROGATE_PAIR_REGEXP,function(value){var hi=value.charCodeAt(0);var low=value.charCodeAt(1);return'&#'+(((hi-0xD800)*0x400)+(low-0xDC00)+0x10000)+';';}).replace(NON_ALPHANUMERIC_REGEXP,function(value){return'&#'+value.charCodeAt(0)+';';}).replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function htmlSanitizeWriterImpl(buf,uriValidator){var ignoreCurrentElement=false;var out=bind(buf,buf.push);return{start:function(tag,attrs){tag=lowercase(tag);if(!ignoreCurrentElement&&blockedElements[tag]){ignoreCurrentElement=tag;}
if(!ignoreCurrentElement&&validElements[tag]===true){out('<');out(tag);forEach(attrs,function(value,key){var lkey=lowercase(key);var isImage=(tag==='img'&&lkey==='src')||(lkey==='background');if(validAttrs[lkey]===true&&(uriAttrs[lkey]!==true||uriValidator(value,isImage))){out(' ');out(key);out('="');out(encodeEntities(value));out('"');}});out('>');}},end:function(tag){tag=lowercase(tag);if(!ignoreCurrentElement&&validElements[tag]===true&&voidElements[tag]!==true){out('</');out(tag);out('>');}
if(tag==ignoreCurrentElement){ignoreCurrentElement=false;}},chars:function(chars){if(!ignoreCurrentElement){out(encodeEntities(chars));}}};}
function stripCustomNsAttrs(node){while(node){if(node.nodeType===window.Node.ELEMENT_NODE){var attrs=node.attributes;for(var i=0,l=attrs.length;i<l;i++){var attrNode=attrs[i];var attrName=attrNode.name.toLowerCase();if(attrName==='xmlns:ns1'||attrName.lastIndexOf('ns1:',0)===0){node.removeAttributeNode(attrNode);i--;l--;}}}
var nextNode=node.firstChild;if(nextNode){stripCustomNsAttrs(nextNode);}
node=getNonDescendant('nextSibling',node);}}
function getNonDescendant(propName,node){var nextNode=node[propName];if(nextNode&&nodeContains.call(node,nextNode)){throw $sanitizeMinErr('elclob','Failed to sanitize html because the element is clobbered: {0}',node.outerHTML||node.outerText);}
return nextNode;}}
function sanitizeText(chars){var buf=[];var writer=htmlSanitizeWriter(buf,noop);writer.chars(chars);return buf.join('');}
angular.module('ngSanitize',[]).provider('$sanitize',$SanitizeProvider).info({angularVersion:'1.7.5'});angular.module('ngSanitize').filter('linky',['$sanitize',function($sanitize){var LINKY_URL_REGEXP=/((s?ftp|https?):\/\/|(www\.)|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>"\u201d\u2019]/i,MAILTO_REGEXP=/^mailto:/i;var linkyMinErr=angular.$$minErr('linky');var isDefined=angular.isDefined;var isFunction=angular.isFunction;var isObject=angular.isObject;var isString=angular.isString;return function(text,target,attributes){if(text==null||text==='')return text;if(!isString(text))throw linkyMinErr('notstring','Expected string but received: {0}',text);var attributesFn=isFunction(attributes)?attributes:isObject(attributes)?function getAttributesObject(){return attributes;}:function getEmptyAttributesObject(){return{};};var match;var raw=text;var html=[];var url;var i;while((match=raw.match(LINKY_URL_REGEXP))){url=match[0];if(!match[2]&&!match[4]){url=(match[3]?'http://':'mailto:')+url;}
i=match.index;addText(raw.substr(0,i));addLink(url,match[0].replace(MAILTO_REGEXP,''));raw=raw.substring(i+match[0].length);}
addText(raw);return $sanitize(html.join(''));function addText(text){if(!text){return;}
html.push(sanitizeText(text));}
function addLink(url,text){var key,linkAttributes=attributesFn(url);html.push('<a ');for(key in linkAttributes){html.push(key+'="'+linkAttributes[key]+'" ');}
if(isDefined(target)&&!('target'in linkAttributes)){html.push('target="',target,'" ');}
html.push('href="',url.replace(/"/g,'&quot;'),'">');addText(text);html.push('</a>');}};}]);})(window,window.angular);(function(window,document,undefined){if(!window){return;}
var _MAP={8:'backspace',9:'tab',13:'enter',16:'shift',17:'ctrl',18:'alt',20:'capslock',27:'esc',32:'space',33:'pageup',34:'pagedown',35:'end',36:'home',37:'left',38:'up',39:'right',40:'down',45:'ins',46:'del',91:'meta',93:'meta',224:'meta'};var _KEYCODE_MAP={106:'*',107:'+',109:'-',110:'.',111:'/',186:';',187:'=',188:',',189:'-',190:'.',191:'/',192:'`',219:'[',220:'\\',221:']',222:'\''};var _SHIFT_MAP={'~':'`','!':'1','@':'2','#':'3','$':'4','%':'5','^':'6','&':'7','*':'8','(':'9',')':'0','_':'-','+':'=',':':';','\"':'\'','<':',','>':'.','?':'/','|':'\\'};var _SPECIAL_ALIASES={'option':'alt','command':'meta','return':'enter','escape':'esc','plus':'+','mod':/Mac|iPod|iPhone|iPad/.test(navigator.platform)?'meta':'ctrl'};var _REVERSE_MAP;for(var i=1;i<20;++i){_MAP[111+i]='f'+i;}
for(i=0;i<=9;++i){_MAP[i+96]=i.toString();}
function _addEvent(object,type,callback){if(object.addEventListener){object.addEventListener(type,callback,false);return;}
object.attachEvent('on'+type,callback);}
function _characterFromEvent(e){if(e.type=='keypress'){var character=String.fromCharCode(e.which);if(!e.shiftKey){character=character.toLowerCase();}
return character;}
if(_MAP[e.which]){return _MAP[e.which];}
if(_KEYCODE_MAP[e.which]){return _KEYCODE_MAP[e.which];}
return String.fromCharCode(e.which).toLowerCase();}
function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(',')===modifiers2.sort().join(',');}
function _eventModifiers(e){var modifiers=[];if(e.shiftKey){modifiers.push('shift');}
if(e.altKey){modifiers.push('alt');}
if(e.ctrlKey){modifiers.push('ctrl');}
if(e.metaKey){modifiers.push('meta');}
return modifiers;}
function _preventDefault(e){if(e.preventDefault){e.preventDefault();return;}
e.returnValue=false;}
function _stopPropagation(e){if(e.stopPropagation){e.stopPropagation();return;}
e.cancelBubble=true;}
function _isModifier(key){return key=='shift'||key=='ctrl'||key=='alt'||key=='meta';}
function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP){if(key>95&&key<112){continue;}
if(_MAP.hasOwnProperty(key)){_REVERSE_MAP[_MAP[key]]=key;}}}
return _REVERSE_MAP;}
function _pickBestAction(key,modifiers,action){if(!action){action=_getReverseMap()[key]?'keydown':'keypress';}
if(action=='keypress'&&modifiers.length){action='keydown';}
return action;}
function _keysFromString(combination){if(combination==='+'){return['+'];}
combination=combination.replace(/\+{2}/g,'+plus');return combination.split('+');}
function _getKeyInfo(combination,action){var keys;var key;var i;var modifiers=[];keys=_keysFromString(combination);for(i=0;i<keys.length;++i){key=keys[i];if(_SPECIAL_ALIASES[key]){key=_SPECIAL_ALIASES[key];}
if(action&&action!='keypress'&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push('shift');}
if(_isModifier(key)){modifiers.push(key);}}
action=_pickBestAction(key,modifiers,action);return{key:key,modifiers:modifiers,action:action};}
function _belongsTo(element,ancestor){if(element===null||element===document){return false;}
if(element===ancestor){return true;}
return _belongsTo(element.parentNode,ancestor);}
function Mousetrap(targetElement){var self=this;targetElement=targetElement||document;if(!(self instanceof Mousetrap)){return new Mousetrap(targetElement);}
self.target=targetElement;self._callbacks={};self._directMap={};var _sequenceLevels={};var _resetTimer;var _ignoreNextKeyup=false;var _ignoreNextKeypress=false;var _nextExpectedAction=false;function _resetSequences(doNotReset){doNotReset=doNotReset||{};var activeSequences=false,key;for(key in _sequenceLevels){if(doNotReset[key]){activeSequences=true;continue;}
_sequenceLevels[key]=0;}
if(!activeSequences){_nextExpectedAction=false;}}
function _getMatches(character,modifiers,e,sequenceName,combination,level){var i;var callback;var matches=[];var action=e.type;if(!self._callbacks[character]){return[];}
if(action=='keyup'&&_isModifier(character)){modifiers=[character];}
for(i=0;i<self._callbacks[character].length;++i){callback=self._callbacks[character][i];if(!sequenceName&&callback.seq&&_sequenceLevels[callback.seq]!=callback.level){continue;}
if(action!=callback.action){continue;}
if((action=='keypress'&&!e.metaKey&&!e.ctrlKey)||_modifiersMatch(modifiers,callback.modifiers)){var deleteCombo=!sequenceName&&callback.combo==combination;var deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;if(deleteCombo||deleteSequence){self._callbacks[character].splice(i,1);}
matches.push(callback);}}
return matches;}
function _fireCallback(callback,e,combo,sequence){if(self.stopCallback(e,e.target||e.srcElement,combo,sequence)){return;}
if(callback(e,combo)===false){_preventDefault(e);_stopPropagation(e);}}
self._handleKey=function(character,modifiers,e){var callbacks=_getMatches(character,modifiers,e);var i;var doNotReset={};var maxLevel=0;var processedSequenceCallback=false;for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){maxLevel=Math.max(maxLevel,callbacks[i].level);}}
for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){if(callbacks[i].level!=maxLevel){continue;}
processedSequenceCallback=true;doNotReset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq);continue;}
if(!processedSequenceCallback){_fireCallback(callbacks[i].callback,e,callbacks[i].combo);}}
var ignoreThisKeypress=e.type=='keypress'&&_ignoreNextKeypress;if(e.type==_nextExpectedAction&&!_isModifier(character)&&!ignoreThisKeypress){_resetSequences(doNotReset);}
_ignoreNextKeypress=processedSequenceCallback&&e.type=='keydown';};function _handleKeyEvent(e){if(typeof e.which!=='number'){e.which=e.keyCode;}
var character=_characterFromEvent(e);if(!character){return;}
if(e.type=='keyup'&&_ignoreNextKeyup===character){_ignoreNextKeyup=false;return;}
self.handleKey(character,_eventModifiers(e),e);}
function _resetSequenceTimer(){clearTimeout(_resetTimer);_resetTimer=setTimeout(_resetSequences,1000);}
function _bindSequence(combo,keys,callback,action){_sequenceLevels[combo]=0;function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction;++_sequenceLevels[combo];_resetSequenceTimer();};}
function _callbackAndReset(e){_fireCallback(callback,e,combo);if(action!=='keyup'){_ignoreNextKeyup=_characterFromEvent(e);}
setTimeout(_resetSequences,10);}
for(var i=0;i<keys.length;++i){var isFinal=i+1===keys.length;var wrappedCallback=isFinal?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i);}}
function _bindSingle(combination,callback,action,sequenceName,level){self._directMap[combination+':'+action]=callback;combination=combination.replace(/\s+/g,' ');var sequence=combination.split(' ');var info;if(sequence.length>1){_bindSequence(combination,sequence,callback,action);return;}
info=_getKeyInfo(combination,action);self._callbacks[info.key]=self._callbacks[info.key]||[];_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level);self._callbacks[info.key][sequenceName?'unshift':'push']({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination});}
self._bindMultiple=function(combinations,callback,action){for(var i=0;i<combinations.length;++i){_bindSingle(combinations[i],callback,action);}};_addEvent(targetElement,'keypress',_handleKeyEvent);_addEvent(targetElement,'keydown',_handleKeyEvent);_addEvent(targetElement,'keyup',_handleKeyEvent);}
Mousetrap.prototype.bind=function(keys,callback,action){var self=this;keys=keys instanceof Array?keys:[keys];self._bindMultiple.call(self,keys,callback,action);return self;};Mousetrap.prototype.unbind=function(keys,action){var self=this;return self.bind.call(self,keys,function(){},action);};Mousetrap.prototype.trigger=function(keys,action){var self=this;if(self._directMap[keys+':'+action]){self._directMap[keys+':'+action]({},keys);}
return self;};Mousetrap.prototype.reset=function(){var self=this;self._callbacks={};self._directMap={};return self;};Mousetrap.prototype.stopCallback=function(e,element){var self=this;if((' '+element.className+' ').indexOf(' mousetrap ')>-1){return false;}
if(_belongsTo(element,self.target)){return false;}
return element.tagName=='INPUT'||element.tagName=='SELECT'||element.tagName=='TEXTAREA'||element.isContentEditable;};Mousetrap.prototype.handleKey=function(){var self=this;return self._handleKey.apply(self,arguments);};Mousetrap.addKeycodes=function(object){for(var key in object){if(object.hasOwnProperty(key)){_MAP[key]=object[key];}}
_REVERSE_MAP=null;};Mousetrap.init=function(){var documentMousetrap=Mousetrap(document);for(var method in documentMousetrap){if(method.charAt(0)!=='_'){Mousetrap[method]=(function(method){return function(){return documentMousetrap[method].apply(documentMousetrap,arguments);};}(method));}}};Mousetrap.init();window.Mousetrap=Mousetrap;if(typeof module!=='undefined'&&module.exports){module.exports=Mousetrap;}
if(typeof define==='function'&&define.amd){define(function(){return Mousetrap;});}})(typeof window!=='undefined'?window:null,typeof window!=='undefined'?document:null);/*! 
 * angular-hotkeys v1.7.0
 * https://chieffancypants.github.io/angular-hotkeys
 * Copyright (c) 2016 Wes Cruver
 * License: MIT
 */
(function(){'use strict';angular.module('cfp.hotkeys',[]).provider('hotkeys',['$injector',function($injector){this.includeCheatSheet=true;this.useNgRoute=$injector.has('ngViewDirective');this.templateTitle='Keyboard Shortcuts:';this.templateHeader=null;this.templateFooter=null;this.template='<div class="cfp-hotkeys-container fade" ng-class="{in: helpVisible}" style="display: none;"><div class="cfp-hotkeys">'+
'<h4 class="cfp-hotkeys-title" ng-if="!header">{{ title }}</h4>'+
'<div ng-bind-html="header" ng-if="header"></div>'+
'<table><tbody>'+
'<tr ng-repeat="hotkey in hotkeys | filter:{ description: \'!$$undefined$$\' }">'+
'<td class="cfp-hotkeys-keys">'+
'<span ng-repeat="key in hotkey.format() track by $index" class="cfp-hotkeys-key">{{ key }}</span>'+
'</td>'+
'<td class="cfp-hotkeys-text">{{ hotkey.description }}</td>'+
'</tr>'+
'</tbody></table>'+
'<div ng-bind-html="footer" ng-if="footer"></div>'+
'<div class="cfp-hotkeys-close" ng-click="toggleCheatSheet()">&#215;</div>'+
'</div></div>';this.cheatSheetHotkey='?';this.cheatSheetDescription='Show / hide this help menu';this.$get=['$rootElement','$rootScope','$compile','$window','$document',function($rootElement,$rootScope,$compile,$window,$document){var mouseTrapEnabled=true;function pause(){mouseTrapEnabled=false;}
function unpause(){mouseTrapEnabled=true;}
Mousetrap.prototype.stopCallback=function(event,element){if(!mouseTrapEnabled){return true;}
if((' '+element.className+' ').indexOf(' mousetrap ')>-1){return false;}
return(element.contentEditable&&element.contentEditable=='true');};function symbolize(combo){var map={command:'\u2318',shift:'\u21E7',left:'\u2190',right:'\u2192',up:'\u2191',down:'\u2193','return':'\u23CE',backspace:'\u232B'};combo=combo.split('+');for(var i=0;i<combo.length;i++){if(combo[i]==='mod'){if($window.navigator&&$window.navigator.platform.indexOf('Mac')>=0){combo[i]='command';}else{combo[i]='ctrl';}}
combo[i]=map[combo[i]]||combo[i];}
return combo.join(' + ');}
function Hotkey(combo,description,callback,action,allowIn,persistent){this.combo=combo instanceof Array?combo:[combo];this.description=description;this.callback=callback;this.action=action;this.allowIn=allowIn;this.persistent=persistent;this._formated=null;}
Hotkey.prototype.format=function(){if(this._formated===null){var combo=this.combo[0];var sequence=combo.split(/[\s]/);for(var i=0;i<sequence.length;i++){sequence[i]=symbolize(sequence[i]);}
this._formated=sequence;}
return this._formated;};var scope=$rootScope.$new();scope.hotkeys=[];scope.helpVisible=false;scope.title=this.templateTitle;scope.header=this.templateHeader;scope.footer=this.templateFooter;scope.toggleCheatSheet=toggleCheatSheet;var boundScopes={};if(this.useNgRoute){$rootScope.$on('$routeChangeSuccess',function(event,route){purgeHotkeys();if(route&&route.hotkeys){angular.forEach(route.hotkeys,function(hotkey){var callback=hotkey[2];if(typeof(callback)==='string'||callback instanceof String){hotkey[2]=[callback,route];}
hotkey[5]=false;_add.apply(this,hotkey);});}});}
if(this.includeCheatSheet){var document=$document[0];var element=$rootElement[0];var helpMenu=angular.element(this.template);_add(this.cheatSheetHotkey,this.cheatSheetDescription,toggleCheatSheet);if(element===document||element===document.documentElement){element=document.body;}
angular.element(element).append($compile(helpMenu)(scope));}
function purgeHotkeys(){var i=scope.hotkeys.length;while(i--){var hotkey=scope.hotkeys[i];if(hotkey&&!hotkey.persistent){_del(hotkey);}}}
var previousEsc=false;function toggleCheatSheet(){scope.helpVisible=!scope.helpVisible;if(scope.helpVisible){previousEsc=_get('esc');_del('esc');_add('esc',previousEsc.description,toggleCheatSheet,null,['INPUT','SELECT','TEXTAREA']);}else{_del('esc');if(previousEsc!==false){_add(previousEsc);}}}
function _add(combo,description,callback,action,allowIn,persistent){var _callback;var preventIn=['INPUT','SELECT','TEXTAREA'];var objType=Object.prototype.toString.call(combo);if(objType==='[object Object]'){description=combo.description;callback=combo.callback;action=combo.action;persistent=combo.persistent;allowIn=combo.allowIn;combo=combo.combo;}
_del(combo);if(description instanceof Function){action=callback;callback=description;description='$$undefined$$';}else if(angular.isUndefined(description)){description='$$undefined$$';}
if(persistent===undefined){persistent=true;}
if(typeof callback==='function'){_callback=callback;if(!(allowIn instanceof Array)){allowIn=[];}
var index;for(var i=0;i<allowIn.length;i++){allowIn[i]=allowIn[i].toUpperCase();index=preventIn.indexOf(allowIn[i]);if(index!==-1){preventIn.splice(index,1);}}
callback=function(event){var shouldExecute=true;if(event){var target=event.target||event.srcElement;var nodeName=target.nodeName.toUpperCase();if((' '+target.className+' ').indexOf(' mousetrap ')>-1){shouldExecute=true;}else{for(var i=0;i<preventIn.length;i++){if(preventIn[i]===nodeName){shouldExecute=false;break;}}}}
if(shouldExecute){wrapApply(_callback.apply(this,arguments));}};}
if(typeof(action)==='string'){Mousetrap.bind(combo,wrapApply(callback),action);}else{Mousetrap.bind(combo,wrapApply(callback));}
var hotkey=new Hotkey(combo,description,callback,action,allowIn,persistent);scope.hotkeys.push(hotkey);return hotkey;}
function _del(hotkey){var combo=(hotkey instanceof Hotkey)?hotkey.combo:hotkey;Mousetrap.unbind(combo);if(angular.isArray(combo)){var retStatus=true;var i=combo.length;while(i--){retStatus=_del(combo[i])&&retStatus;}
return retStatus;}else{var index=scope.hotkeys.indexOf(_get(combo));if(index>-1){if(scope.hotkeys[index].combo.length>1){scope.hotkeys[index].combo.splice(scope.hotkeys[index].combo.indexOf(combo),1);}else{angular.forEach(boundScopes,function(boundScope){var scopeIndex=boundScope.indexOf(scope.hotkeys[index]);if(scopeIndex!==-1){boundScope.splice(scopeIndex,1);}});scope.hotkeys.splice(index,1);}
return true;}}
return false;}
function _get(combo){if(!combo){return scope.hotkeys;}
var hotkey;for(var i=0;i<scope.hotkeys.length;i++){hotkey=scope.hotkeys[i];if(hotkey.combo.indexOf(combo)>-1){return hotkey;}}
return false;}
function bindTo(scope){if(!(scope.$id in boundScopes)){boundScopes[scope.$id]=[];scope.$on('$destroy',function(){var i=boundScopes[scope.$id].length;while(i--){_del(boundScopes[scope.$id].pop());}});}
return{add:function(args){var hotkey;if(arguments.length>1){hotkey=_add.apply(this,arguments);}else{hotkey=_add(args);}
boundScopes[scope.$id].push(hotkey);return this;}};}
function wrapApply(callback){return function(event,combo){if(callback instanceof Array){var funcString=callback[0];var route=callback[1];callback=function(event){route.scope.$eval(funcString);};}
$rootScope.$apply(function(){callback(event,_get(combo));});};}
var publicApi={add:_add,del:_del,get:_get,bindTo:bindTo,template:this.template,toggleCheatSheet:toggleCheatSheet,includeCheatSheet:this.includeCheatSheet,cheatSheetHotkey:this.cheatSheetHotkey,cheatSheetDescription:this.cheatSheetDescription,useNgRoute:this.useNgRoute,purgeHotkeys:purgeHotkeys,templateTitle:this.templateTitle,pause:pause,unpause:unpause};return publicApi;}];}]).directive('hotkey',['hotkeys',function(hotkeys){return{restrict:'A',link:function(scope,el,attrs){var keys=[],allowIn;angular.forEach(scope.$eval(attrs.hotkey),function(func,hotkey){allowIn=typeof attrs.hotkeyAllowIn==="string"?attrs.hotkeyAllowIn.split(/[\s,]+/):[];keys.push(hotkey);hotkeys.add({combo:hotkey,description:attrs.hotkeyDescription,callback:func,action:attrs.hotkeyAction,allowIn:allowIn});});el.bind('$destroy',function(){angular.forEach(keys,hotkeys.del);});}};}]).run(['hotkeys',function(hotkeys){}]);})();(function(window,document,undefined){var _MAP={8:'backspace',9:'tab',13:'enter',16:'shift',17:'ctrl',18:'alt',20:'capslock',27:'esc',32:'space',33:'pageup',34:'pagedown',35:'end',36:'home',37:'left',38:'up',39:'right',40:'down',45:'ins',46:'del',91:'meta',93:'meta',224:'meta'};var _KEYCODE_MAP={106:'*',107:'+',109:'-',110:'.',111:'/',186:';',187:'=',188:',',189:'-',190:'.',191:'/',192:'`',219:'[',220:'\\',221:']',222:'\''};var _SHIFT_MAP={'~':'`','!':'1','@':'2','#':'3','$':'4','%':'5','^':'6','&':'7','*':'8','(':'9',')':'0','_':'-','+':'=',':':';','\"':'\'','<':',','>':'.','?':'/','|':'\\'};var _SPECIAL_ALIASES={'option':'alt','command':'meta','return':'enter','escape':'esc','plus':'+','mod':/Mac|iPod|iPhone|iPad/.test(navigator.platform)?'meta':'ctrl'};var _REVERSE_MAP;for(var i=1;i<20;++i){_MAP[111+i]='f'+i;}
for(i=0;i<=9;++i){_MAP[i+96]=i;}
function _addEvent(object,type,callback){if(object.addEventListener){object.addEventListener(type,callback,false);return;}
object.attachEvent('on'+type,callback);}
function _characterFromEvent(e){if(e.type=='keypress'){var character=String.fromCharCode(e.which);if(!e.shiftKey){character=character.toLowerCase();}
return character;}
if(_MAP[e.which]){return _MAP[e.which];}
if(_KEYCODE_MAP[e.which]){return _KEYCODE_MAP[e.which];}
return String.fromCharCode(e.which).toLowerCase();}
function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(',')===modifiers2.sort().join(',');}
function _eventModifiers(e){var modifiers=[];if(e.shiftKey){modifiers.push('shift');}
if(e.altKey){modifiers.push('alt');}
if(e.ctrlKey){modifiers.push('ctrl');}
if(e.metaKey){modifiers.push('meta');}
return modifiers;}
function _preventDefault(e){if(e.preventDefault){e.preventDefault();return;}
e.returnValue=false;}
function _stopPropagation(e){if(e.stopPropagation){e.stopPropagation();return;}
e.cancelBubble=true;}
function _isModifier(key){return key=='shift'||key=='ctrl'||key=='alt'||key=='meta';}
function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP){if(key>95&&key<112){continue;}
if(_MAP.hasOwnProperty(key)){_REVERSE_MAP[_MAP[key]]=key;}}}
return _REVERSE_MAP;}
function _pickBestAction(key,modifiers,action){if(!action){action=_getReverseMap()[key]?'keydown':'keypress';}
if(action=='keypress'&&modifiers.length){action='keydown';}
return action;}
function _keysFromString(combination){if(combination==='+'){return['+'];}
combination=combination.replace(/\+{2}/g,'+plus');return combination.split('+');}
function _getKeyInfo(combination,action){var keys;var key;var i;var modifiers=[];keys=_keysFromString(combination);for(i=0;i<keys.length;++i){key=keys[i];if(_SPECIAL_ALIASES[key]){key=_SPECIAL_ALIASES[key];}
if(action&&action!='keypress'&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push('shift');}
if(_isModifier(key)){modifiers.push(key);}}
action=_pickBestAction(key,modifiers,action);return{key:key,modifiers:modifiers,action:action};}
function _belongsTo(element,ancestor){if(element===document){return false;}
if(element===ancestor){return true;}
return _belongsTo(element.parentNode,ancestor);}
function Mousetrap(targetElement){var self=this;targetElement=targetElement||document;if(!(self instanceof Mousetrap)){return new Mousetrap(targetElement);}
self.target=targetElement;self._callbacks={};self._directMap={};var _sequenceLevels={};var _resetTimer;var _ignoreNextKeyup=false;var _ignoreNextKeypress=false;var _nextExpectedAction=false;function _resetSequences(doNotReset){doNotReset=doNotReset||{};var activeSequences=false,key;for(key in _sequenceLevels){if(doNotReset[key]){activeSequences=true;continue;}
_sequenceLevels[key]=0;}
if(!activeSequences){_nextExpectedAction=false;}}
function _getMatches(character,modifiers,e,sequenceName,combination,level){var i;var callback;var matches=[];var action=e.type;if(!self._callbacks[character]){return[];}
if(action=='keyup'&&_isModifier(character)){modifiers=[character];}
for(i=0;i<self._callbacks[character].length;++i){callback=self._callbacks[character][i];if(!sequenceName&&callback.seq&&_sequenceLevels[callback.seq]!=callback.level){continue;}
if(action!=callback.action){continue;}
if((action=='keypress'&&!e.metaKey&&!e.ctrlKey)||_modifiersMatch(modifiers,callback.modifiers)){var deleteCombo=!sequenceName&&callback.combo==combination;var deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;if(deleteCombo||deleteSequence){self._callbacks[character].splice(i,1);}
matches.push(callback);}}
return matches;}
function _fireCallback(callback,e,combo,sequence){if(self.stopCallback(e,e.target||e.srcElement,combo,sequence)){return;}
if(callback(e,combo)===false){_preventDefault(e);_stopPropagation(e);}}
self._handleKey=function(character,modifiers,e){var callbacks=_getMatches(character,modifiers,e);var i;var doNotReset={};var maxLevel=0;var processedSequenceCallback=false;for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){maxLevel=Math.max(maxLevel,callbacks[i].level);}}
for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){if(callbacks[i].level!=maxLevel){continue;}
processedSequenceCallback=true;doNotReset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq);continue;}
if(!processedSequenceCallback){_fireCallback(callbacks[i].callback,e,callbacks[i].combo);}}
var ignoreThisKeypress=e.type=='keypress'&&_ignoreNextKeypress;if(e.type==_nextExpectedAction&&!_isModifier(character)&&!ignoreThisKeypress){_resetSequences(doNotReset);}
_ignoreNextKeypress=processedSequenceCallback&&e.type=='keydown';};function _handleKeyEvent(e){if(typeof e.which!=='number'){e.which=e.keyCode;}
var character=_characterFromEvent(e);if(!character){return;}
if(e.type=='keyup'&&_ignoreNextKeyup===character){_ignoreNextKeyup=false;return;}
self.handleKey(character,_eventModifiers(e),e);}
function _resetSequenceTimer(){clearTimeout(_resetTimer);_resetTimer=setTimeout(_resetSequences,1000);}
function _bindSequence(combo,keys,callback,action){_sequenceLevels[combo]=0;function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction;++_sequenceLevels[combo];_resetSequenceTimer();};}
function _callbackAndReset(e){_fireCallback(callback,e,combo);if(action!=='keyup'){_ignoreNextKeyup=_characterFromEvent(e);}
setTimeout(_resetSequences,10);}
for(var i=0;i<keys.length;++i){var isFinal=i+1===keys.length;var wrappedCallback=isFinal?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i);}}
function _bindSingle(combination,callback,action,sequenceName,level){self._directMap[combination+':'+action]=callback;combination=combination.replace(/\s+/g,' ');var sequence=combination.split(' ');var info;if(sequence.length>1){_bindSequence(combination,sequence,callback,action);return;}
info=_getKeyInfo(combination,action);self._callbacks[info.key]=self._callbacks[info.key]||[];_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level);self._callbacks[info.key][sequenceName?'unshift':'push']({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination});}
self._bindMultiple=function(combinations,callback,action){for(var i=0;i<combinations.length;++i){_bindSingle(combinations[i],callback,action);}};_addEvent(targetElement,'keypress',_handleKeyEvent);_addEvent(targetElement,'keydown',_handleKeyEvent);_addEvent(targetElement,'keyup',_handleKeyEvent);}
Mousetrap.prototype.bind=function(keys,callback,action){var self=this;keys=keys instanceof Array?keys:[keys];self._bindMultiple.call(self,keys,callback,action);return self;};Mousetrap.prototype.unbind=function(keys,action){var self=this;return self.bind.call(self,keys,function(){},action);};Mousetrap.prototype.trigger=function(keys,action){var self=this;if(self._directMap[keys+':'+action]){self._directMap[keys+':'+action]({},keys);}
return self;};Mousetrap.prototype.reset=function(){var self=this;self._callbacks={};self._directMap={};return self;};Mousetrap.prototype.stopCallback=function(e,element){var self=this;if((' '+element.className+' ').indexOf(' mousetrap ')>-1){return false;}
if(_belongsTo(element,self.target)){return false;}
return element.tagName=='INPUT'||element.tagName=='SELECT'||element.tagName=='TEXTAREA'||element.isContentEditable;};Mousetrap.prototype.handleKey=function(){var self=this;return self._handleKey.apply(self,arguments);};Mousetrap.init=function(){var documentMousetrap=Mousetrap(document);for(var method in documentMousetrap){if(method.charAt(0)!=='_'){Mousetrap[method]=(function(method){return function(){return documentMousetrap[method].apply(documentMousetrap,arguments);};}(method));}}};Mousetrap.init();window.Mousetrap=Mousetrap;if(typeof module!=='undefined'&&module.exports){module.exports=Mousetrap;}
if(typeof define==='function'&&define.amd){define(function(){return Mousetrap;});}})(window,document);!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Hone",[],e):"object"==typeof exports?exports.Hone=e():t.Hone=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=4)}([function(t,e,n){"use strict";function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){e.split(" ").filter(function(t){return t.length}).forEach(function(e){t.classList?t.classList.add(e):"[object SVGAnimatedString]"===t.className.toString()?t.className.baseVal+=(t.className.baseVal.length?" ":"")+e:t.className+=(t.className.length?" ":"")+e})}function r(t,e){e.split(" ").filter(function(t){return t.length}).forEach(function(e){t.classList?t.classList.remove(e):"[object SVGAnimatedString]"===t.className.toString()?t.className.baseVal=t.className.baseVal.toString().replace(new RegExp("(^|s)"+e.split(" ").join("|")+"(s|$)","gi")," "):t.className=t.className.toString().replace(new RegExp("(^|s)"+e.split(" ").join("|")+"(s|$)","gi")," ")})}function a(t){return t=parseFloat(t),isFinite(t)?t:0}function l(t){var e=t.getBoundingClientRect();return{width:Math.round("number"==typeof e.width?e.width:elem.offsetWidth),height:Math.round("number"==typeof e.height?e.height:elem.offsetHeight),top:Math.round(e.top+(window.pageYOffset||document.documentElement.scrollTop)),left:Math.round(e.left+(window.pageXOffset||document.documentElement.scrollLeft)),viewportWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),viewportHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}}function f(t){var e=t.getBoundingClientRect(),n=l(t),o={top:0,left:0},i=document.documentElement,s=i.getBoundingClientRect(),r=window.getComputedStyle(i);return o.top=s.top+i.clientTop,o.left=s.left+i.clientLeft,o.top+=window.pageYOffset,o.left+=window.pageXOffset,o.top+=a(r.paddingTop),o.left+=a(r.paddingLeft),Object.assign(n,{top:Math.round(e.top-o.top),left:Math.round(e.left-o.left)})}function u(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}function c(t){var e=t.split(" ").filter(function(t){return t.length}).map(function(t){return parseInt(t,10)});switch(e.length){case 0:return{top:0,right:0,bottom:0,left:0};case 1:return{top:e[0],right:e[0],bottom:e[0],left:e[0]};case 2:return{top:e[0],right:e[1],bottom:e[0],left:e[1]};case 3:return{top:e[0],right:e[1],bottom:e[2],left:e[1]};case 4:return{top:e[0],right:e[1],bottom:e[2],left:e[3]};default:throw new Error("Invalid padding for hone scope: "+t)}}function p(t){function e(t,n){return null===t.parentNode?n:e(t.parentNode,n.concat([t]))}function n(t,e){return getComputedStyle(t,null).getPropertyValue(e)}function i(t){return n(t,"overflow")+n(t,"overflow-y")+n(t,"overflow-x")}function s(t){return r.test(i(t))}var r=/(auto|scroll)/;if(!(t instanceof HTMLElement||t instanceof SVGElement))return[];var a=e(t.parentNode,[]),l=a.filter(function(t){return s(t)});return[window].concat(o(l))}Object.defineProperty(e,"__esModule",{value:!0}),e.addClass=s,e.removeClass=r,e.parseStyle=a,e.offset=l,e.viewportOffset=f,e.createElement=u,e.parsePadding=c,e.scrollParents=p;e.Enum=function t(e){var n=this;i(this,t),e.forEach(function(t){n[t.toUpperCase()]=t})},e.transformKey=function(){if("undefined"==typeof document)return"";for(var t=document.createElement("div"),e=["transform","WebkitTransform","OTransform","MozTransform","msTransform"],n=0;n<e.length;++n){var o=e[n];if(void 0!==t.style[o])return o}}()},function(t,e,n){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),s=function(){function t(e,n){o(this,t),this.element=n,this.options=e}return i(t,[{key:"show",value:function(){this.element.style.display="block"}},{key:"hide",value:function(){this.element.style.display="none"}},{key:"setOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.removeEventListeners(),this.options=Object.assign(this.options||{},t),this.addEventListeners()}},{key:"addEventListeners",value:function(){if(this.options&&this.options.events)for(var t in this.options.events)Object.prototype.hasOwnProperty.call(this.options.events,t)&&this.element.addEventListener(t,this.options.events[t])}},{key:"removeEventListeners",value:function(){if(this.options&&this.options.events)for(var t in this.options.events)Object.prototype.hasOwnProperty.call(this.options.events,t)&&this.element.removeEventListener(t,this.options.events[t])}},{key:"destroy",value:function(){this.removeEventListeners(),this.element=null}}]),t}();e.default=s,t.exports=e.default},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),f=n(1),u=o(f),c=n(0),p=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,(0,c.createElement)('\n        <div>\n            <svg width="100%" height="100%" viewBox="0 0 100 100" fill="none" style="position: absolute">\n                <path d="M100 0\n                         Q 0 0 0 100\n                         L0 0\n                         Z" />\n            </svg>\n        </div>')));return(0,c.addClass)(n.element.querySelector("path"),"hone-scope "+n.options.classPrefix+" "+n.options.classPrefix+"-component "+n.options.classPrefix+"-corner "+n.options.classPrefix+"-corner-"+t.name),n.hide(),n}return a(e,t),l(e,[{key:"position",value:function(t){var n=this.options.borderRadius||0,o=this.options.borderRadius||0,s=void 0,r=void 0,a=void 0;switch(this.options.position){case e.position.TOP_LEFT:s=t.left,r=t.top,a="0deg";break;case e.position.TOP_RIGHT:s=t.left+t.width-o,r=t.top,a="90deg";break;case e.position.BOTTOM_RIGHT:s=t.left+t.width-o,r=t.top+t.height-n,a="180deg";break;case e.position.BOTTOM_LEFT:s=t.left,r=t.top+t.height-n,a="-90deg";break;default:throw new Error("Invalid position: "+this.options.position)}Object.assign(this.element.style,i({position:this.options.fixed?"fixed":"absolute",left:s+"px",top:r+"px",height:n+"px",width:o+"px"},c.transformKey,"rotate("+a+")")),this.show()}}]),e}(u.default);e.default=p,p.position=new c.Enum(["TOP_LEFT","TOP_RIGHT","BOTTOM_RIGHT","BOTTOM_LEFT"]),t.exports=e.default},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),l=n(1),f=o(l),u=n(0),c=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,document.createElement("div")));return(0,u.addClass)(n.element,"hone-scope "+n.options.classPrefix+" "+n.options.classPrefix+"-component "+n.options.classPrefix+"-component-"+t.name),n.hide(),n}return r(e,t),a(e,[{key:"position",value:function(t){var n=(0,u.offset)(document.body),o=void 0,i=void 0,s=void 0,r=void 0;switch(this.options.position){case e.position.TOP:o="0",i="0",s=t.top+"px",r="100%";break;case e.position.RIGHT:o=t.left+t.width+"px",i=t.top+"px",s=t.height+"px",r=Math.min(n.left+n.width-t.left-t.width,t.viewportWidth-t.left-t.width)+"px";break;case e.position.BOTTOM:o="0",i=t.top+t.height+"px",s=Math.max(n.top+n.height-t.top-t.height,t.viewportHeight-t.top-t.height)+"px",r="100%";break;case e.position.LEFT:o="0",i=t.top+"px",s=t.height+"px",r=t.left+"px";break;default:throw new Error("Invalid position: "+this.options.position)}Object.assign(this.element.style,{position:this.options.fixed?"fixed":"absolute",left:o,top:i,height:s,width:r}),this.show()}}]),e}(f.default);e.default=c,c.position=new u.Enum(["TOP","RIGHT","BOTTOM","LEFT"]),t.exports=e.default},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(){if(this.status===v.status.DESTROYED)throw new Error("Hone scope has been destroyed.")}function r(){var t=this;window.addEventListener("resize",this.eventListener),this.scrollParents.forEach(function(e){e.addEventListener("scroll",t.eventListener)})}function a(){var t=this;window.removeEventListener("resize",this.eventListener),this.scrollParents.forEach(function(e){e.removeEventListener("scroll",t.eventListener)})}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),f=n(3),u=o(f),c=n(2),p=o(c),h=n(0),d={classPrefix:"hone",fixed:!1,borderRadius:0,enabled:!0,padding:"0",fullScreen:!1,disableOptimizations:!1},v=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,t),n instanceof Element?this.target=n:(o=n,o.enabled=!1),this.element=document.createElement("div"),this.status=t.status.HIDDEN,this.setOptions(Object.assign({},d,o)),this.createComponents(this.options),document.body.appendChild(this.element),this.eventListener=function(){return e.status===t.status.VISIBLE&&e.position()},this.scrollParents=(0,h.scrollParents)(this.target),r.call(this),this.options.enabled&&this.show()}return l(t,[{key:"createComponents",value:function(t){var e=this;this.components=[new u.default(Object.assign({name:"top",position:u.default.position.TOP},t)),new u.default(Object.assign({name:"right",position:u.default.position.RIGHT},t)),new u.default(Object.assign({name:"bottom",position:u.default.position.BOTTOM},t)),new u.default(Object.assign({name:"left",position:u.default.position.LEFT},t)),new p.default(Object.assign({name:"top-left",position:p.default.position.TOP_LEFT},t)),new p.default(Object.assign({name:"top-right",position:p.default.position.TOP_RIGHT},t)),new p.default(Object.assign({name:"bottom-right",position:p.default.position.BOTTOM_RIGHT},t)),new p.default(Object.assign({name:"bottom-left",position:p.default.position.BOTTOM_LEFT},t))],this.components.forEach(function(t){return e.element.appendChild(t.element)})}},{key:"getOffset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.target;return this.options.fixed?(0,h.viewportOffset)(t):(0,h.offset)(t)}},{key:"position",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.target;s.call(this);var e=this.options.parsedPadding,n=this.getOffset(t);this.options.fullScreen?Object.assign(n,{top:0,left:0,width:0,height:0}):(n.top-=e.top,n.left-=e.left,n.width+=e.left+e.right,n.height+=e.top+e.bottom),this.lastOffset&&!this.options.disableOptimizations&&n.top===this.lastOffset.top&&n.left===this.lastOffset.left&&n.width===this.lastOffset.width&&n.height===this.lastOffset.height&&n.viewportWidth===this.lastOffset.viewportWidth&&n.videoHeight===this.lastOffset.videoHeight||(this.components.forEach(function(t){return t.position(n)}),this.lastOffset=n,t!==this.target&&(a.call(this),this.target=t,this.scrollParents=(0,h.scrollParents)(this.target),r.call(this)))}},{key:"show",value:function(){s.call(this),this.element.style.display="block",this.status=t.status.VISIBLE}},{key:"hide",value:function(){s.call(this),this.element.style.display="none",this.status=t.status.HIDDEN}},{key:"setOptions",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.call(this),this.options=Object.assign(this.options||{},e),this.options.parsedPadding=(0,h.parsePadding)(this.options.padding),this.components&&this.components.forEach(function(e){return e.setOptions(t.options)})}},{key:"destroy",value:function(){var e=this;s.call(this),this.components.forEach(function(t){return t.destroy()}),this.scrollParents.forEach(function(t){t.removeEventListener("scroll",e.eventListener)}),window.removeEventListener("resize",this.eventListener),document.body.removeChild(this.element),this.element=null,this.status=t.status.DESTROYED}}]),t}();e.default=v,v.status=new h.Enum(["HIDDEN","VISIBLE","DESTROYED"]),t.exports=e.default}])});/*! tether 1.4.0 */
(function(root,factory){if(typeof define==='function'&&define.amd){define(factory);}else if(typeof exports==='object'){module.exports=factory(require,exports,module);}else{root.Tether=factory();}}(this,function(require,exports,module){'use strict';var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
var TetherBase=undefined;if(typeof TetherBase==='undefined'){TetherBase={modules:[]};}
var zeroElement=null;function getActualBoundingClientRect(node){var boundingRect=node.getBoundingClientRect();var rect={};for(var k in boundingRect){rect[k]=boundingRect[k];}
if(node.ownerDocument!==document){var _frameElement=node.ownerDocument.defaultView.frameElement;if(_frameElement){var frameRect=getActualBoundingClientRect(_frameElement);rect.top+=frameRect.top;rect.bottom+=frameRect.top;rect.left+=frameRect.left;rect.right+=frameRect.left;}}
return rect;}
function getScrollParents(el){var computedStyle=getComputedStyle(el)||{};var position=computedStyle.position;var parents=[];if(position==='fixed'){return[el];}
var parent=el;while((parent=parent.parentNode)&&parent&&parent.nodeType===1){var style=undefined;try{style=getComputedStyle(parent);}catch(err){}
if(typeof style==='undefined'||style===null){parents.push(parent);return parents;}
var _style=style;var overflow=_style.overflow;var overflowX=_style.overflowX;var overflowY=_style.overflowY;if(/(auto|scroll)/.test(overflow+overflowY+overflowX)){if(position!=='absolute'||['relative','absolute','fixed'].indexOf(style.position)>=0){parents.push(parent);}}}
parents.push(el.ownerDocument.body);if(el.ownerDocument!==document){parents.push(el.ownerDocument.defaultView);}
return parents;}
var uniqueId=(function(){var id=0;return function(){return++id;};})();var zeroPosCache={};var getOrigin=function getOrigin(){var node=zeroElement;if(!node||!document.body.contains(node)){node=document.createElement('div');node.setAttribute('data-tether-id',uniqueId());extend(node.style,{top:0,left:0,position:'absolute'});document.body.appendChild(node);zeroElement=node;}
var id=node.getAttribute('data-tether-id');if(typeof zeroPosCache[id]==='undefined'){zeroPosCache[id]=getActualBoundingClientRect(node);defer(function(){delete zeroPosCache[id];});}
return zeroPosCache[id];};function removeUtilElements(){if(zeroElement){document.body.removeChild(zeroElement);}
zeroElement=null;};function getBounds(el){var doc=undefined;if(el===document){doc=document;el=document.documentElement;}else{doc=el.ownerDocument;}
var docEl=doc.documentElement;var box=getActualBoundingClientRect(el);var origin=getOrigin();box.top-=origin.top;box.left-=origin.left;if(typeof box.width==='undefined'){box.width=document.body.scrollWidth-box.left-box.right;}
if(typeof box.height==='undefined'){box.height=document.body.scrollHeight-box.top-box.bottom;}
box.top=box.top-docEl.clientTop;box.left=box.left-docEl.clientLeft;box.right=doc.body.clientWidth-box.width-box.left;box.bottom=doc.body.clientHeight-box.height-box.top;return box;}
function getOffsetParent(el){return el.offsetParent||document.documentElement;}
var _scrollBarSize=null;function getScrollBarSize(){if(_scrollBarSize){return _scrollBarSize;}
var inner=document.createElement('div');inner.style.width='100%';inner.style.height='200px';var outer=document.createElement('div');extend(outer.style,{position:'absolute',top:0,left:0,pointerEvents:'none',visibility:'hidden',width:'200px',height:'150px',overflow:'hidden'});outer.appendChild(inner);document.body.appendChild(outer);var widthContained=inner.offsetWidth;outer.style.overflow='scroll';var widthScroll=inner.offsetWidth;if(widthContained===widthScroll){widthScroll=outer.clientWidth;}
document.body.removeChild(outer);var width=widthContained-widthScroll;_scrollBarSize={width:width,height:width};return _scrollBarSize;}
function extend(){var out=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var args=[];Array.prototype.push.apply(args,arguments);args.slice(1).forEach(function(obj){if(obj){for(var key in obj){if(({}).hasOwnProperty.call(obj,key)){out[key]=obj[key];}}}});return out;}
function removeClass(el,name){if(typeof el.classList!=='undefined'){name.split(' ').forEach(function(cls){if(cls.trim()){el.classList.remove(cls);}});}else{var regex=new RegExp('(^| )'+name.split(' ').join('|')+'( |$)','gi');var className=getClassName(el).replace(regex,' ');setClassName(el,className);}}
function addClass(el,name){if(typeof el.classList!=='undefined'){name.split(' ').forEach(function(cls){if(cls.trim()){el.classList.add(cls);}});}else{removeClass(el,name);var cls=getClassName(el)+(' '+name);setClassName(el,cls);}}
function hasClass(el,name){if(typeof el.classList!=='undefined'){return el.classList.contains(name);}
var className=getClassName(el);return new RegExp('(^| )'+name+'( |$)','gi').test(className);}
function getClassName(el){if(el.className instanceof el.ownerDocument.defaultView.SVGAnimatedString){return el.className.baseVal;}
return el.className;}
function setClassName(el,className){el.setAttribute('class',className);}
function updateClasses(el,add,all){all.forEach(function(cls){if(add.indexOf(cls)===-1&&hasClass(el,cls)){removeClass(el,cls);}});add.forEach(function(cls){if(!hasClass(el,cls)){addClass(el,cls);}});}
var deferred=[];var defer=function defer(fn){deferred.push(fn);};var flush=function flush(){var fn=undefined;while(fn=deferred.pop()){fn();}};var Evented=(function(){function Evented(){_classCallCheck(this,Evented);}
_createClass(Evented,[{key:'on',value:function on(event,handler,ctx){var once=arguments.length<=3||arguments[3]===undefined?false:arguments[3];if(typeof this.bindings==='undefined'){this.bindings={};}
if(typeof this.bindings[event]==='undefined'){this.bindings[event]=[];}
this.bindings[event].push({handler:handler,ctx:ctx,once:once});}},{key:'once',value:function once(event,handler,ctx){this.on(event,handler,ctx,true);}},{key:'off',value:function off(event,handler){if(typeof this.bindings==='undefined'||typeof this.bindings[event]==='undefined'){return;}
if(typeof handler==='undefined'){delete this.bindings[event];}else{var i=0;while(i<this.bindings[event].length){if(this.bindings[event][i].handler===handler){this.bindings[event].splice(i,1);}else{++i;}}}}},{key:'trigger',value:function trigger(event){if(typeof this.bindings!=='undefined'&&this.bindings[event]){var i=0;for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key];}
while(i<this.bindings[event].length){var _bindings$event$i=this.bindings[event][i];var handler=_bindings$event$i.handler;var ctx=_bindings$event$i.ctx;var once=_bindings$event$i.once;var context=ctx;if(typeof context==='undefined'){context=this;}
handler.apply(context,args);if(once){this.bindings[event].splice(i,1);}else{++i;}}}}}]);return Evented;})();TetherBase.Utils={getActualBoundingClientRect:getActualBoundingClientRect,getScrollParents:getScrollParents,getBounds:getBounds,getOffsetParent:getOffsetParent,extend:extend,addClass:addClass,removeClass:removeClass,hasClass:hasClass,updateClasses:updateClasses,defer:defer,flush:flush,uniqueId:uniqueId,Evented:Evented,getScrollBarSize:getScrollBarSize,removeUtilElements:removeUtilElements};'use strict';var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i['return'])_i['return']();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError('Invalid attempt to destructure non-iterable instance');}};})();var _createClass=(function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if('value'in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};})();var _get=function get(_x6,_x7,_x8){var _again=true;_function:while(_again){var object=_x6,property=_x7,receiver=_x8;_again=false;if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined;}else{_x6=parent;_x7=property;_x8=receiver;_again=true;desc=parent=undefined;continue _function;}}else if('value'in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError('Cannot call a class as a function');}}
function _inherits(subClass,superClass){if(typeof superClass!=='function'&&superClass!==null){throw new TypeError('Super expression must either be null or a function, not '+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}
if(typeof TetherBase==='undefined'){throw new Error('You must include the utils.js file before tether.js');}
var _TetherBase$Utils=TetherBase.Utils;var getScrollParents=_TetherBase$Utils.getScrollParents;var getBounds=_TetherBase$Utils.getBounds;var getOffsetParent=_TetherBase$Utils.getOffsetParent;var extend=_TetherBase$Utils.extend;var addClass=_TetherBase$Utils.addClass;var removeClass=_TetherBase$Utils.removeClass;var updateClasses=_TetherBase$Utils.updateClasses;var defer=_TetherBase$Utils.defer;var flush=_TetherBase$Utils.flush;var getScrollBarSize=_TetherBase$Utils.getScrollBarSize;var removeUtilElements=_TetherBase$Utils.removeUtilElements;function within(a,b){var diff=arguments.length<=2||arguments[2]===undefined?1:arguments[2];return a+diff>=b&&b>=a-diff;}
var transformKey=(function(){if(typeof document==='undefined'){return'';}
var el=document.createElement('div');var transforms=['transform','WebkitTransform','OTransform','MozTransform','msTransform'];for(var i=0;i<transforms.length;++i){var key=transforms[i];if(el.style[key]!==undefined){return key;}}})();var tethers=[];var position=function position(){tethers.forEach(function(tether){tether.position(false);});flush();};function now(){if(typeof performance!=='undefined'&&typeof performance.now!=='undefined'){return performance.now();}
return+new Date();}
(function(){var lastCall=null;var lastDuration=null;var pendingTimeout=null;var tick=function tick(){if(typeof lastDuration!=='undefined'&&lastDuration>16){lastDuration=Math.min(lastDuration-16,250);pendingTimeout=setTimeout(tick,250);return;}
if(typeof lastCall!=='undefined'&&now()-lastCall<10){return;}
if(pendingTimeout!=null){clearTimeout(pendingTimeout);pendingTimeout=null;}
lastCall=now();position();lastDuration=now()-lastCall;};if(typeof window!=='undefined'&&typeof window.addEventListener!=='undefined'){['resize','scroll','touchmove'].forEach(function(event){window.addEventListener(event,tick);});}})();var MIRROR_LR={center:'center',left:'right',right:'left'};var MIRROR_TB={middle:'middle',top:'bottom',bottom:'top'};var OFFSET_MAP={top:0,left:0,middle:'50%',center:'50%',bottom:'100%',right:'100%'};var autoToFixedAttachment=function autoToFixedAttachment(attachment,relativeToAttachment){var left=attachment.left;var top=attachment.top;if(left==='auto'){left=MIRROR_LR[relativeToAttachment.left];}
if(top==='auto'){top=MIRROR_TB[relativeToAttachment.top];}
return{left:left,top:top};};var attachmentToOffset=function attachmentToOffset(attachment){var left=attachment.left;var top=attachment.top;if(typeof OFFSET_MAP[attachment.left]!=='undefined'){left=OFFSET_MAP[attachment.left];}
if(typeof OFFSET_MAP[attachment.top]!=='undefined'){top=OFFSET_MAP[attachment.top];}
return{left:left,top:top};};function addOffset(){var out={top:0,left:0};for(var _len=arguments.length,offsets=Array(_len),_key=0;_key<_len;_key++){offsets[_key]=arguments[_key];}
offsets.forEach(function(_ref){var top=_ref.top;var left=_ref.left;if(typeof top==='string'){top=parseFloat(top,10);}
if(typeof left==='string'){left=parseFloat(left,10);}
out.top+=top;out.left+=left;});return out;}
function offsetToPx(offset,size){if(typeof offset.left==='string'&&offset.left.indexOf('%')!==-1){offset.left=parseFloat(offset.left,10)/100*size.width;}
if(typeof offset.top==='string'&&offset.top.indexOf('%')!==-1){offset.top=parseFloat(offset.top,10)/100*size.height;}
return offset;}
var parseOffset=function parseOffset(value){var _value$split=value.split(' ');var _value$split2=_slicedToArray(_value$split,2);var top=_value$split2[0];var left=_value$split2[1];return{top:top,left:left};};var parseAttachment=parseOffset;var TetherClass=(function(_Evented){_inherits(TetherClass,_Evented);function TetherClass(options){var _this=this;_classCallCheck(this,TetherClass);_get(Object.getPrototypeOf(TetherClass.prototype),'constructor',this).call(this);this.position=this.position.bind(this);tethers.push(this);this.history=[];this.setOptions(options,false);TetherBase.modules.forEach(function(module){if(typeof module.initialize!=='undefined'){module.initialize.call(_this);}});this.position();}
_createClass(TetherClass,[{key:'getClass',value:function getClass(){var key=arguments.length<=0||arguments[0]===undefined?'':arguments[0];var classes=this.options.classes;if(typeof classes!=='undefined'&&classes[key]){return this.options.classes[key];}else if(this.options.classPrefix){return this.options.classPrefix+'-'+key;}else{return key;}}},{key:'setOptions',value:function setOptions(options){var _this2=this;var pos=arguments.length<=1||arguments[1]===undefined?true:arguments[1];var defaults={offset:'0 0',targetOffset:'0 0',targetAttachment:'auto auto',classPrefix:'tether'};this.options=extend(defaults,options);var _options=this.options;var element=_options.element;var target=_options.target;var targetModifier=_options.targetModifier;this.element=element;this.target=target;this.targetModifier=targetModifier;if(this.target==='viewport'){this.target=document.body;this.targetModifier='visible';}else if(this.target==='scroll-handle'){this.target=document.body;this.targetModifier='scroll-handle';}
['element','target'].forEach(function(key){if(typeof _this2[key]==='undefined'){throw new Error('Tether Error: Both element and target must be defined');}
if(typeof _this2[key].jquery!=='undefined'){_this2[key]=_this2[key][0];}else if(typeof _this2[key]==='string'){_this2[key]=document.querySelector(_this2[key]);}});addClass(this.element,this.getClass('element'));if(!(this.options.addTargetClasses===false)){addClass(this.target,this.getClass('target'));}
if(!this.options.attachment){throw new Error('Tether Error: You must provide an attachment');}
this.targetAttachment=parseAttachment(this.options.targetAttachment);this.attachment=parseAttachment(this.options.attachment);this.offset=parseOffset(this.options.offset);this.targetOffset=parseOffset(this.options.targetOffset);if(typeof this.scrollParents!=='undefined'){this.disable();}
if(this.targetModifier==='scroll-handle'){this.scrollParents=[this.target];}else{this.scrollParents=getScrollParents(this.target);}
if(!(this.options.enabled===false)){this.enable(pos);}}},{key:'getTargetBounds',value:function getTargetBounds(){if(typeof this.targetModifier!=='undefined'){if(this.targetModifier==='visible'){if(this.target===document.body){return{top:pageYOffset,left:pageXOffset,height:innerHeight,width:innerWidth};}else{var bounds=getBounds(this.target);var out={height:bounds.height,width:bounds.width,top:bounds.top,left:bounds.left};out.height=Math.min(out.height,bounds.height-(pageYOffset-bounds.top));out.height=Math.min(out.height,bounds.height-(bounds.top+bounds.height-(pageYOffset+innerHeight)));out.height=Math.min(innerHeight,out.height);out.height-=2;out.width=Math.min(out.width,bounds.width-(pageXOffset-bounds.left));out.width=Math.min(out.width,bounds.width-(bounds.left+bounds.width-(pageXOffset+innerWidth)));out.width=Math.min(innerWidth,out.width);out.width-=2;if(out.top<pageYOffset){out.top=pageYOffset;}
if(out.left<pageXOffset){out.left=pageXOffset;}
return out;}}else if(this.targetModifier==='scroll-handle'){var bounds=undefined;var target=this.target;if(target===document.body){target=document.documentElement;bounds={left:pageXOffset,top:pageYOffset,height:innerHeight,width:innerWidth};}else{bounds=getBounds(target);}
var style=getComputedStyle(target);var hasBottomScroll=target.scrollWidth>target.clientWidth||[style.overflow,style.overflowX].indexOf('scroll')>=0||this.target!==document.body;var scrollBottom=0;if(hasBottomScroll){scrollBottom=15;}
var height=bounds.height-parseFloat(style.borderTopWidth)-parseFloat(style.borderBottomWidth)-scrollBottom;var out={width:15,height:height*0.975*(height/target.scrollHeight),left:bounds.left+bounds.width-parseFloat(style.borderLeftWidth)-15};var fitAdj=0;if(height<408&&this.target===document.body){fitAdj=-0.00011*Math.pow(height,2)-0.00727*height+22.58;}
if(this.target!==document.body){out.height=Math.max(out.height,24);}
var scrollPercentage=this.target.scrollTop/(target.scrollHeight-height);out.top=scrollPercentage*(height-out.height-fitAdj)+bounds.top+parseFloat(style.borderTopWidth);if(this.target===document.body){out.height=Math.max(out.height,24);}
return out;}}else{return getBounds(this.target);}}},{key:'clearCache',value:function clearCache(){this._cache={};}},{key:'cache',value:function cache(k,getter){if(typeof this._cache==='undefined'){this._cache={};}
if(typeof this._cache[k]==='undefined'){this._cache[k]=getter.call(this);}
return this._cache[k];}},{key:'enable',value:function enable(){var _this3=this;var pos=arguments.length<=0||arguments[0]===undefined?true:arguments[0];if(!(this.options.addTargetClasses===false)){addClass(this.target,this.getClass('enabled'));}
addClass(this.element,this.getClass('enabled'));this.enabled=true;this.scrollParents.forEach(function(parent){if(parent!==_this3.target.ownerDocument){parent.addEventListener('scroll',_this3.position);}});if(pos){this.position();}}},{key:'disable',value:function disable(){var _this4=this;removeClass(this.target,this.getClass('enabled'));removeClass(this.element,this.getClass('enabled'));this.enabled=false;if(typeof this.scrollParents!=='undefined'){this.scrollParents.forEach(function(parent){parent.removeEventListener('scroll',_this4.position);});}}},{key:'destroy',value:function destroy(){var _this5=this;this.disable();tethers.forEach(function(tether,i){if(tether===_this5){tethers.splice(i,1);}});if(tethers.length===0){removeUtilElements();}}},{key:'updateAttachClasses',value:function updateAttachClasses(elementAttach,targetAttach){var _this6=this;elementAttach=elementAttach||this.attachment;targetAttach=targetAttach||this.targetAttachment;var sides=['left','top','bottom','right','middle','center'];if(typeof this._addAttachClasses!=='undefined'&&this._addAttachClasses.length){this._addAttachClasses.splice(0,this._addAttachClasses.length);}
if(typeof this._addAttachClasses==='undefined'){this._addAttachClasses=[];}
var add=this._addAttachClasses;if(elementAttach.top){add.push(this.getClass('element-attached')+'-'+elementAttach.top);}
if(elementAttach.left){add.push(this.getClass('element-attached')+'-'+elementAttach.left);}
if(targetAttach.top){add.push(this.getClass('target-attached')+'-'+targetAttach.top);}
if(targetAttach.left){add.push(this.getClass('target-attached')+'-'+targetAttach.left);}
var all=[];sides.forEach(function(side){all.push(_this6.getClass('element-attached')+'-'+side);all.push(_this6.getClass('target-attached')+'-'+side);});defer(function(){if(!(typeof _this6._addAttachClasses!=='undefined')){return;}
updateClasses(_this6.element,_this6._addAttachClasses,all);if(!(_this6.options.addTargetClasses===false)){updateClasses(_this6.target,_this6._addAttachClasses,all);}
delete _this6._addAttachClasses;});}},{key:'position',value:function position(){var _this7=this;var flushChanges=arguments.length<=0||arguments[0]===undefined?true:arguments[0];if(!this.enabled){return;}
this.clearCache();var targetAttachment=autoToFixedAttachment(this.targetAttachment,this.attachment);this.updateAttachClasses(this.attachment,targetAttachment);var elementPos=this.cache('element-bounds',function(){return getBounds(_this7.element);});var width=elementPos.width;var height=elementPos.height;if(width===0&&height===0&&typeof this.lastSize!=='undefined'){var _lastSize=this.lastSize;width=_lastSize.width;height=_lastSize.height;}else{this.lastSize={width:width,height:height};}
var targetPos=this.cache('target-bounds',function(){return _this7.getTargetBounds();});var targetSize=targetPos;var offset=offsetToPx(attachmentToOffset(this.attachment),{width:width,height:height});var targetOffset=offsetToPx(attachmentToOffset(targetAttachment),targetSize);var manualOffset=offsetToPx(this.offset,{width:width,height:height});var manualTargetOffset=offsetToPx(this.targetOffset,targetSize);offset=addOffset(offset,manualOffset);targetOffset=addOffset(targetOffset,manualTargetOffset);var left=targetPos.left+targetOffset.left-offset.left;var top=targetPos.top+targetOffset.top-offset.top;for(var i=0;i<TetherBase.modules.length;++i){var _module2=TetherBase.modules[i];var ret=_module2.position.call(this,{left:left,top:top,targetAttachment:targetAttachment,targetPos:targetPos,elementPos:elementPos,offset:offset,targetOffset:targetOffset,manualOffset:manualOffset,manualTargetOffset:manualTargetOffset,scrollbarSize:scrollbarSize,attachment:this.attachment});if(ret===false){return false;}else if(typeof ret==='undefined'||typeof ret!=='object'){continue;}else{top=ret.top;left=ret.left;}}
var next={page:{top:top,left:left},viewport:{top:top-pageYOffset,bottom:pageYOffset-top-height+innerHeight,left:left-pageXOffset,right:pageXOffset-left-width+innerWidth}};var doc=this.target.ownerDocument;var win=doc.defaultView;var scrollbarSize=undefined;if(win.innerHeight>doc.documentElement.clientHeight){scrollbarSize=this.cache('scrollbar-size',getScrollBarSize);next.viewport.bottom-=scrollbarSize.height;}
if(win.innerWidth>doc.documentElement.clientWidth){scrollbarSize=this.cache('scrollbar-size',getScrollBarSize);next.viewport.right-=scrollbarSize.width;}
if(['','static'].indexOf(doc.body.style.position)===-1||['','static'].indexOf(doc.body.parentElement.style.position)===-1){next.page.bottom=doc.body.scrollHeight-top-height;next.page.right=doc.body.scrollWidth-left-width;}
if(typeof this.options.optimizations!=='undefined'&&this.options.optimizations.moveElement!==false&&!(typeof this.targetModifier!=='undefined')){(function(){var offsetParent=_this7.cache('target-offsetparent',function(){return getOffsetParent(_this7.target);});var offsetPosition=_this7.cache('target-offsetparent-bounds',function(){return getBounds(offsetParent);});var offsetParentStyle=getComputedStyle(offsetParent);var offsetParentSize=offsetPosition;var offsetBorder={};['Top','Left','Bottom','Right'].forEach(function(side){offsetBorder[side.toLowerCase()]=parseFloat(offsetParentStyle['border'+side+'Width']);});offsetPosition.right=doc.body.scrollWidth-offsetPosition.left-offsetParentSize.width+offsetBorder.right;offsetPosition.bottom=doc.body.scrollHeight-offsetPosition.top-offsetParentSize.height+offsetBorder.bottom;if(next.page.top>=offsetPosition.top+offsetBorder.top&&next.page.bottom>=offsetPosition.bottom){if(next.page.left>=offsetPosition.left+offsetBorder.left&&next.page.right>=offsetPosition.right){var scrollTop=offsetParent.scrollTop;var scrollLeft=offsetParent.scrollLeft;next.offset={top:next.page.top-offsetPosition.top+scrollTop-offsetBorder.top,left:next.page.left-offsetPosition.left+scrollLeft-offsetBorder.left};}}})();}
this.move(next);this.history.unshift(next);if(this.history.length>3){this.history.pop();}
if(flushChanges){flush();}
return true;}
},{key:'move',value:function move(pos){var _this8=this;if(!(typeof this.element.parentNode!=='undefined')){return;}
var same={};for(var type in pos){same[type]={};for(var key in pos[type]){var found=false;for(var i=0;i<this.history.length;++i){var point=this.history[i];if(typeof point[type]!=='undefined'&&!within(point[type][key],pos[type][key])){found=true;break;}}
if(!found){same[type][key]=true;}}}
var css={top:'',left:'',right:'',bottom:''};var transcribe=function transcribe(_same,_pos){var hasOptimizations=typeof _this8.options.optimizations!=='undefined';var gpu=hasOptimizations?_this8.options.optimizations.gpu:null;if(gpu!==false){var yPos=undefined,xPos=undefined;if(_same.top){css.top=0;yPos=_pos.top;}else{css.bottom=0;yPos=-_pos.bottom;}
if(_same.left){css.left=0;xPos=_pos.left;}else{css.right=0;xPos=-_pos.right;}
if(window.matchMedia){var retina=window.matchMedia('only screen and (min-resolution: 1.3dppx)').matches||window.matchMedia('only screen and (-webkit-min-device-pixel-ratio: 1.3)').matches;if(!retina){xPos=Math.round(xPos);yPos=Math.round(yPos);}}
css[transformKey]='translateX('+xPos+'px) translateY('+yPos+'px)';if(transformKey!=='msTransform'){css[transformKey]+=" translateZ(0)";}}else{if(_same.top){css.top=_pos.top+'px';}else{css.bottom=_pos.bottom+'px';}
if(_same.left){css.left=_pos.left+'px';}else{css.right=_pos.right+'px';}}};var moved=false;if((same.page.top||same.page.bottom)&&(same.page.left||same.page.right)){css.position='absolute';transcribe(same.page,pos.page);}else if((same.viewport.top||same.viewport.bottom)&&(same.viewport.left||same.viewport.right)){css.position='fixed';transcribe(same.viewport,pos.viewport);}else if(typeof same.offset!=='undefined'&&same.offset.top&&same.offset.left){(function(){css.position='absolute';var offsetParent=_this8.cache('target-offsetparent',function(){return getOffsetParent(_this8.target);});if(getOffsetParent(_this8.element)!==offsetParent){defer(function(){_this8.element.parentNode.removeChild(_this8.element);offsetParent.appendChild(_this8.element);});}
transcribe(same.offset,pos.offset);moved=true;})();}else{css.position='absolute';transcribe({top:true,left:true},pos.page);}
if(!moved){if(this.options.bodyElement){this.options.bodyElement.appendChild(this.element);}else{var offsetParentIsBody=true;var currentNode=this.element.parentNode;while(currentNode&&currentNode.nodeType===1&&currentNode.tagName!=='BODY'){if(getComputedStyle(currentNode).position!=='static'){offsetParentIsBody=false;break;}
currentNode=currentNode.parentNode;}
if(!offsetParentIsBody){this.element.parentNode.removeChild(this.element);this.element.ownerDocument.body.appendChild(this.element);}}}
var writeCSS={};var write=false;for(var key in css){var val=css[key];var elVal=this.element.style[key];if(elVal!==val){write=true;writeCSS[key]=val;}}
if(write){defer(function(){extend(_this8.element.style,writeCSS);_this8.trigger('repositioned');});}}}]);return TetherClass;})(Evented);TetherClass.modules=[];TetherBase.position=position;var Tether=extend(TetherClass,TetherBase);'use strict';var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i['return'])_i['return']();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError('Invalid attempt to destructure non-iterable instance');}};})();var _TetherBase$Utils=TetherBase.Utils;var getBounds=_TetherBase$Utils.getBounds;var extend=_TetherBase$Utils.extend;var updateClasses=_TetherBase$Utils.updateClasses;var defer=_TetherBase$Utils.defer;var BOUNDS_FORMAT=['left','top','right','bottom'];function getBoundingRect(tether,to){if(to==='scrollParent'){to=tether.scrollParents[0];}else if(to==='window'){to=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset];}
if(to===document){to=to.documentElement;}
if(typeof to.nodeType!=='undefined'){(function(){var node=to;var size=getBounds(to);var pos=size;var style=getComputedStyle(to);to=[pos.left,pos.top,size.width+pos.left,size.height+pos.top];if(node.ownerDocument!==document){var win=node.ownerDocument.defaultView;to[0]+=win.pageXOffset;to[1]+=win.pageYOffset;to[2]+=win.pageXOffset;to[3]+=win.pageYOffset;}
BOUNDS_FORMAT.forEach(function(side,i){side=side[0].toUpperCase()+side.substr(1);if(side==='Top'||side==='Left'){to[i]+=parseFloat(style['border'+side+'Width']);}else{to[i]-=parseFloat(style['border'+side+'Width']);}});})();}
return to;}
TetherBase.modules.push({position:function position(_ref){var _this=this;var top=_ref.top;var left=_ref.left;var targetAttachment=_ref.targetAttachment;if(!this.options.constraints){return true;}
var _cache=this.cache('element-bounds',function(){return getBounds(_this.element);});var height=_cache.height;var width=_cache.width;if(width===0&&height===0&&typeof this.lastSize!=='undefined'){var _lastSize=this.lastSize;width=_lastSize.width;height=_lastSize.height;}
var targetSize=this.cache('target-bounds',function(){return _this.getTargetBounds();});var targetHeight=targetSize.height;var targetWidth=targetSize.width;var allClasses=[this.getClass('pinned'),this.getClass('out-of-bounds')];this.options.constraints.forEach(function(constraint){var outOfBoundsClass=constraint.outOfBoundsClass;var pinnedClass=constraint.pinnedClass;if(outOfBoundsClass){allClasses.push(outOfBoundsClass);}
if(pinnedClass){allClasses.push(pinnedClass);}});allClasses.forEach(function(cls){['left','top','right','bottom'].forEach(function(side){allClasses.push(cls+'-'+side);});});var addClasses=[];var tAttachment=extend({},targetAttachment);var eAttachment=extend({},this.attachment);this.options.constraints.forEach(function(constraint){var to=constraint.to;var attachment=constraint.attachment;var pin=constraint.pin;if(typeof attachment==='undefined'){attachment='';}
var changeAttachX=undefined,changeAttachY=undefined;if(attachment.indexOf(' ')>=0){var _attachment$split=attachment.split(' ');var _attachment$split2=_slicedToArray(_attachment$split,2);changeAttachY=_attachment$split2[0];changeAttachX=_attachment$split2[1];}else{changeAttachX=changeAttachY=attachment;}
var bounds=getBoundingRect(_this,to);if(changeAttachY==='target'||changeAttachY==='both'){if(top<bounds[1]&&tAttachment.top==='top'){top+=targetHeight;tAttachment.top='bottom';}
if(top+height>bounds[3]&&tAttachment.top==='bottom'){top-=targetHeight;tAttachment.top='top';}}
if(changeAttachY==='together'){if(tAttachment.top==='top'){if(eAttachment.top==='bottom'&&top<bounds[1]){top+=targetHeight;tAttachment.top='bottom';top+=height;eAttachment.top='top';}else if(eAttachment.top==='top'&&top+height>bounds[3]&&top-(height-targetHeight)>=bounds[1]){top-=height-targetHeight;tAttachment.top='bottom';eAttachment.top='bottom';}}
if(tAttachment.top==='bottom'){if(eAttachment.top==='top'&&top+height>bounds[3]){top-=targetHeight;tAttachment.top='top';top-=height;eAttachment.top='bottom';}else if(eAttachment.top==='bottom'&&top<bounds[1]&&top+(height*2-targetHeight)<=bounds[3]){top+=height-targetHeight;tAttachment.top='top';eAttachment.top='top';}}
if(tAttachment.top==='middle'){if(top+height>bounds[3]&&eAttachment.top==='top'){top-=height;eAttachment.top='bottom';}else if(top<bounds[1]&&eAttachment.top==='bottom'){top+=height;eAttachment.top='top';}}}
if(changeAttachX==='target'||changeAttachX==='both'){if(left<bounds[0]&&tAttachment.left==='left'){left+=targetWidth;tAttachment.left='right';}
if(left+width>bounds[2]&&tAttachment.left==='right'){left-=targetWidth;tAttachment.left='left';}}
if(changeAttachX==='together'){if(left<bounds[0]&&tAttachment.left==='left'){if(eAttachment.left==='right'){left+=targetWidth;tAttachment.left='right';left+=width;eAttachment.left='left';}else if(eAttachment.left==='left'){left+=targetWidth;tAttachment.left='right';left-=width;eAttachment.left='right';}}else if(left+width>bounds[2]&&tAttachment.left==='right'){if(eAttachment.left==='left'){left-=targetWidth;tAttachment.left='left';left-=width;eAttachment.left='right';}else if(eAttachment.left==='right'){left-=targetWidth;tAttachment.left='left';left+=width;eAttachment.left='left';}}else if(tAttachment.left==='center'){if(left+width>bounds[2]&&eAttachment.left==='left'){left-=width;eAttachment.left='right';}else if(left<bounds[0]&&eAttachment.left==='right'){left+=width;eAttachment.left='left';}}}
if(changeAttachY==='element'||changeAttachY==='both'){if(top<bounds[1]&&eAttachment.top==='bottom'){top+=height;eAttachment.top='top';}
if(top+height>bounds[3]&&eAttachment.top==='top'){top-=height;eAttachment.top='bottom';}}
if(changeAttachX==='element'||changeAttachX==='both'){if(left<bounds[0]){if(eAttachment.left==='right'){left+=width;eAttachment.left='left';}else if(eAttachment.left==='center'){left+=width/2;eAttachment.left='left';}}
if(left+width>bounds[2]){if(eAttachment.left==='left'){left-=width;eAttachment.left='right';}else if(eAttachment.left==='center'){left-=width/2;eAttachment.left='right';}}}
if(typeof pin==='string'){pin=pin.split(',').map(function(p){return p.trim();});}else if(pin===true){pin=['top','left','right','bottom'];}
pin=pin||[];var pinned=[];var oob=[];if(top<bounds[1]){if(pin.indexOf('top')>=0){top=bounds[1];pinned.push('top');}else{oob.push('top');}}
if(top+height>bounds[3]){if(pin.indexOf('bottom')>=0){top=bounds[3]-height;pinned.push('bottom');}else{oob.push('bottom');}}
if(left<bounds[0]){if(pin.indexOf('left')>=0){left=bounds[0];pinned.push('left');}else{oob.push('left');}}
if(left+width>bounds[2]){if(pin.indexOf('right')>=0){left=bounds[2]-width;pinned.push('right');}else{oob.push('right');}}
if(pinned.length){(function(){var pinnedClass=undefined;if(typeof _this.options.pinnedClass!=='undefined'){pinnedClass=_this.options.pinnedClass;}else{pinnedClass=_this.getClass('pinned');}
addClasses.push(pinnedClass);pinned.forEach(function(side){addClasses.push(pinnedClass+'-'+side);});})();}
if(oob.length){(function(){var oobClass=undefined;if(typeof _this.options.outOfBoundsClass!=='undefined'){oobClass=_this.options.outOfBoundsClass;}else{oobClass=_this.getClass('out-of-bounds');}
addClasses.push(oobClass);oob.forEach(function(side){addClasses.push(oobClass+'-'+side);});})();}
if(pinned.indexOf('left')>=0||pinned.indexOf('right')>=0){eAttachment.left=tAttachment.left=false;}
if(pinned.indexOf('top')>=0||pinned.indexOf('bottom')>=0){eAttachment.top=tAttachment.top=false;}
if(tAttachment.top!==targetAttachment.top||tAttachment.left!==targetAttachment.left||eAttachment.top!==_this.attachment.top||eAttachment.left!==_this.attachment.left){_this.updateAttachClasses(eAttachment,tAttachment);_this.trigger('update',{attachment:eAttachment,targetAttachment:tAttachment});}});defer(function(){if(!(_this.options.addTargetClasses===false)){updateClasses(_this.target,addClasses,allClasses);}
updateClasses(_this.element,addClasses,allClasses);});return{top:top,left:left};}});'use strict';var _TetherBase$Utils=TetherBase.Utils;var getBounds=_TetherBase$Utils.getBounds;var updateClasses=_TetherBase$Utils.updateClasses;var defer=_TetherBase$Utils.defer;TetherBase.modules.push({position:function position(_ref){var _this=this;var top=_ref.top;var left=_ref.left;var _cache=this.cache('element-bounds',function(){return getBounds(_this.element);});var height=_cache.height;var width=_cache.width;var targetPos=this.getTargetBounds();var bottom=top+height;var right=left+width;var abutted=[];if(top<=targetPos.bottom&&bottom>=targetPos.top){['left','right'].forEach(function(side){var targetPosSide=targetPos[side];if(targetPosSide===left||targetPosSide===right){abutted.push(side);}});}
if(left<=targetPos.right&&right>=targetPos.left){['top','bottom'].forEach(function(side){var targetPosSide=targetPos[side];if(targetPosSide===top||targetPosSide===bottom){abutted.push(side);}});}
var allClasses=[];var addClasses=[];var sides=['left','top','right','bottom'];allClasses.push(this.getClass('abutted'));sides.forEach(function(side){allClasses.push(_this.getClass('abutted')+'-'+side);});if(abutted.length){addClasses.push(this.getClass('abutted'));}
abutted.forEach(function(side){addClasses.push(_this.getClass('abutted')+'-'+side);});defer(function(){if(!(_this.options.addTargetClasses===false)){updateClasses(_this.target,addClasses,allClasses);}
updateClasses(_this.element,addClasses,allClasses);});return true;}});'use strict';var _slicedToArray=(function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i['return'])_i['return']();}finally{if(_d)throw _e;}}return _arr;}return function(arr,i){if(Array.isArray(arr)){return arr;}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i);}else{throw new TypeError('Invalid attempt to destructure non-iterable instance');}};})();TetherBase.modules.push({position:function position(_ref){var top=_ref.top;var left=_ref.left;if(!this.options.shift){return;}
var shift=this.options.shift;if(typeof this.options.shift==='function'){shift=this.options.shift.call(this,{top:top,left:left});}
var shiftTop=undefined,shiftLeft=undefined;if(typeof shift==='string'){shift=shift.split(' ');shift[1]=shift[1]||shift[0];var _shift=shift;var _shift2=_slicedToArray(_shift,2);shiftTop=_shift2[0];shiftLeft=_shift2[1];shiftTop=parseFloat(shiftTop,10);shiftLeft=parseFloat(shiftLeft,10);}else{shiftTop=shift.top;shiftLeft=shift.left;}
top+=shiftTop;left+=shiftLeft;return{top:top,left:left};}});return Tether;}));var duScrollDefaultEasing=function(x){'use strict';if(x<0.5){return Math.pow(x*2,2)/2;}
return 1-Math.pow((1-x)*2,2)/2;};var duScroll=angular.module('duScroll',['duScroll.scrollspy','duScroll.smoothScroll','duScroll.scrollContainer','duScroll.spyContext','duScroll.scrollHelpers'])
.value('duScrollDuration',350)
.value('duScrollSpyWait',100)
.value('duScrollSpyRefreshInterval',0)
.value('duScrollGreedy',false)
.value('duScrollOffset',0)
.value('duScrollEasing',duScrollDefaultEasing)
.value('duScrollCancelOnEvents','scroll mousedown mousewheel touchmove keydown')
.value('duScrollBottomSpy',false)
.value('duScrollActiveClass','active');if(typeof module!=='undefined'&&module&&module.exports){module.exports=duScroll;}
angular.module('duScroll.scrollHelpers',['duScroll.requestAnimation']).run(["$window","$q","cancelAnimation","requestAnimation","duScrollEasing","duScrollDuration","duScrollOffset","duScrollCancelOnEvents",function($window,$q,cancelAnimation,requestAnimation,duScrollEasing,duScrollDuration,duScrollOffset,duScrollCancelOnEvents){'use strict';var proto={};var isDocument=function(el){return(typeof HTMLDocument!=='undefined'&&el instanceof HTMLDocument)||(el.nodeType&&el.nodeType===el.DOCUMENT_NODE);};var isElement=function(el){return(typeof HTMLElement!=='undefined'&&el instanceof HTMLElement)||(el.nodeType&&el.nodeType===el.ELEMENT_NODE);};var unwrap=function(el){return isElement(el)||isDocument(el)?el:el[0];};proto.duScrollTo=function(left,top,duration,easing){var aliasFn;if(angular.isElement(left)){aliasFn=this.duScrollToElement;}else if(angular.isDefined(duration)){aliasFn=this.duScrollToAnimated;}
if(aliasFn){return aliasFn.apply(this,arguments);}
var el=unwrap(this);if(isDocument(el)){return $window.scrollTo(left,top);}
el.scrollLeft=left;el.scrollTop=top;};var scrollAnimation,deferred;proto.duScrollToAnimated=function(left,top,duration,easing){if(duration&&!easing){easing=duScrollEasing;}
var startLeft=this.duScrollLeft(),startTop=this.duScrollTop(),deltaLeft=Math.round(left-startLeft),deltaTop=Math.round(top-startTop);var startTime=null,progress=0;var el=this;var cancelScrollAnimation=function($event){if(!$event||(progress&&$event.which>0)){if(duScrollCancelOnEvents){el.unbind(duScrollCancelOnEvents,cancelScrollAnimation);}
cancelAnimation(scrollAnimation);deferred.reject();scrollAnimation=null;}};if(scrollAnimation){cancelScrollAnimation();}
deferred=$q.defer();if(duration===0||(!deltaLeft&&!deltaTop)){if(duration===0){el.duScrollTo(left,top);}
deferred.resolve();return deferred.promise;}
var animationStep=function(timestamp){if(startTime===null){startTime=timestamp;}
progress=timestamp-startTime;var percent=(progress>=duration?1:easing(progress/duration));el.scrollTo(startLeft+Math.ceil(deltaLeft*percent),startTop+Math.ceil(deltaTop*percent));if(percent<1){scrollAnimation=requestAnimation(animationStep);}else{if(duScrollCancelOnEvents){el.unbind(duScrollCancelOnEvents,cancelScrollAnimation);}
scrollAnimation=null;deferred.resolve();}};el.duScrollTo(startLeft,startTop);if(duScrollCancelOnEvents){el.bind(duScrollCancelOnEvents,cancelScrollAnimation);}
scrollAnimation=requestAnimation(animationStep);return deferred.promise;};proto.duScrollToElement=function(target,offset,duration,easing){var el=unwrap(this);if(!angular.isNumber(offset)||isNaN(offset)){offset=duScrollOffset;}
var top=this.duScrollTop()+unwrap(target).getBoundingClientRect().top-offset;if(isElement(el)){top-=el.getBoundingClientRect().top;}
return this.duScrollTo(0,top,duration,easing);};proto.duScrollLeft=function(value,duration,easing){if(angular.isNumber(value)){return this.duScrollTo(value,this.duScrollTop(),duration,easing);}
var el=unwrap(this);if(isDocument(el)){return $window.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft;}
return el.scrollLeft;};proto.duScrollTop=function(value,duration,easing){if(angular.isNumber(value)){return this.duScrollTo(this.duScrollLeft(),value,duration,easing);}
var el=unwrap(this);if(isDocument(el)){return $window.scrollY||document.documentElement.scrollTop||document.body.scrollTop;}
return el.scrollTop;};proto.duScrollToElementAnimated=function(target,offset,duration,easing){return this.duScrollToElement(target,offset,duration||duScrollDuration,easing);};proto.duScrollTopAnimated=function(top,duration,easing){return this.duScrollTop(top,duration||duScrollDuration,easing);};proto.duScrollLeftAnimated=function(left,duration,easing){return this.duScrollLeft(left,duration||duScrollDuration,easing);};angular.forEach(proto,function(fn,key){angular.element.prototype[key]=fn;var unprefixed=key.replace(/^duScroll/,'scroll');if(angular.isUndefined(angular.element.prototype[unprefixed])){angular.element.prototype[unprefixed]=fn;}});}]);angular.module('duScroll.polyfill',[]).factory('polyfill',["$window",function($window){'use strict';var vendors=['webkit','moz','o','ms'];return function(fnName,fallback){if($window[fnName]){return $window[fnName];}
var suffix=fnName.substr(0,1).toUpperCase()+fnName.substr(1);for(var key,i=0;i<vendors.length;i++){key=vendors[i]+suffix;if($window[key]){return $window[key];}}
return fallback;};}]);angular.module('duScroll.requestAnimation',['duScroll.polyfill']).factory('requestAnimation',["polyfill","$timeout",function(polyfill,$timeout){'use strict';var lastTime=0;var fallback=function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=$timeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};return polyfill('requestAnimationFrame',fallback);}]).factory('cancelAnimation',["polyfill","$timeout",function(polyfill,$timeout){'use strict';var fallback=function(promise){$timeout.cancel(promise);};return polyfill('cancelAnimationFrame',fallback);}]);angular.module('duScroll.spyAPI',['duScroll.scrollContainerAPI']).factory('spyAPI',["$rootScope","$timeout","$interval","$window","$document","scrollContainerAPI","duScrollGreedy","duScrollSpyWait","duScrollSpyRefreshInterval","duScrollBottomSpy","duScrollActiveClass",function($rootScope,$timeout,$interval,$window,$document,scrollContainerAPI,duScrollGreedy,duScrollSpyWait,duScrollSpyRefreshInterval,duScrollBottomSpy,duScrollActiveClass){'use strict';var createScrollHandler=function(context){var timer=false,queued=false;var handler=function(){queued=false;var container=context.container,containerEl=container[0],containerOffset=0,bottomReached;if(typeof HTMLElement!=='undefined'&&containerEl instanceof HTMLElement||containerEl.nodeType&&containerEl.nodeType===containerEl.ELEMENT_NODE){containerOffset=containerEl.getBoundingClientRect().top;bottomReached=Math.round(containerEl.scrollTop+containerEl.clientHeight)>=containerEl.scrollHeight;}else{var documentScrollHeight=$document[0].body.scrollHeight||$document[0].documentElement.scrollHeight;bottomReached=Math.round($window.pageYOffset+$window.innerHeight)>=documentScrollHeight;}
var compareProperty=(duScrollBottomSpy&&bottomReached?'bottom':'top');var i,currentlyActive,toBeActive,spies,spy,pos;spies=context.spies;currentlyActive=context.currentlyActive;toBeActive=undefined;for(i=0;i<spies.length;i++){spy=spies[i];pos=spy.getTargetPosition();if(!pos||!spy.$element)continue;if((duScrollBottomSpy&&bottomReached)||(pos.top+spy.offset-containerOffset<20&&(duScrollGreedy||pos.top*-1+containerOffset)<pos.height)){if(!toBeActive||toBeActive[compareProperty]<pos[compareProperty]){toBeActive={spy:spy};toBeActive[compareProperty]=pos[compareProperty];}}}
if(toBeActive){toBeActive=toBeActive.spy;}
if(currentlyActive===toBeActive||(duScrollGreedy&&!toBeActive))return;if(currentlyActive&&currentlyActive.$element){currentlyActive.$element.removeClass(duScrollActiveClass);$rootScope.$broadcast('duScrollspy:becameInactive',currentlyActive.$element,angular.element(currentlyActive.getTargetElement()));}
if(toBeActive){toBeActive.$element.addClass(duScrollActiveClass);$rootScope.$broadcast('duScrollspy:becameActive',toBeActive.$element,angular.element(toBeActive.getTargetElement()));}
context.currentlyActive=toBeActive;};if(!duScrollSpyWait){return handler;}
return function(){if(!timer){handler();timer=$timeout(function(){timer=false;if(queued){handler();}},duScrollSpyWait,false);}else{queued=true;}};};var contexts={};var createContext=function($scope){var id=$scope.$id;var context={spies:[]};context.handler=createScrollHandler(context);contexts[id]=context;$scope.$on('$destroy',function(){destroyContext($scope);});return id;};var destroyContext=function($scope){var id=$scope.$id;var context=contexts[id],container=context.container;if(context.intervalPromise){$interval.cancel(context.intervalPromise);}
if(container){container.off('scroll',context.handler);}
delete contexts[id];};var defaultContextId=createContext($rootScope);var getContextForScope=function(scope){if(contexts[scope.$id]){return contexts[scope.$id];}
if(scope.$parent){return getContextForScope(scope.$parent);}
return contexts[defaultContextId];};var getContextForSpy=function(spy){var context,contextId,scope=spy.$scope;if(scope){return getContextForScope(scope);}
for(contextId in contexts){context=contexts[contextId];if(context.spies.indexOf(spy)!==-1){return context;}}};var isElementInDocument=function(element){while(element.parentNode){element=element.parentNode;if(element===document){return true;}}
return false;};var addSpy=function(spy){var context=getContextForSpy(spy);if(!context)return;context.spies.push(spy);if(!context.container||!isElementInDocument(context.container)){if(context.container){context.container.off('scroll',context.handler);}
context.container=scrollContainerAPI.getContainer(spy.$scope);if(duScrollSpyRefreshInterval&&!context.intervalPromise){context.intervalPromise=$interval(context.handler,duScrollSpyRefreshInterval,0,false);}
context.container.on('scroll',context.handler).triggerHandler('scroll');}};var removeSpy=function(spy){var context=getContextForSpy(spy);if(spy===context.currentlyActive){$rootScope.$broadcast('duScrollspy:becameInactive',context.currentlyActive.$element);context.currentlyActive=null;}
var i=context.spies.indexOf(spy);if(i!==-1){context.spies.splice(i,1);}
spy.$element=null;};return{addSpy:addSpy,removeSpy:removeSpy,createContext:createContext,destroyContext:destroyContext,getContextForScope:getContextForScope};}]);angular.module('duScroll.scrollContainerAPI',[]).factory('scrollContainerAPI',["$document",function($document){'use strict';var containers={};var setContainer=function(scope,element){var id=scope.$id;containers[id]=element;return id;};var getContainerId=function(scope){if(containers[scope.$id]){return scope.$id;}
if(scope.$parent){return getContainerId(scope.$parent);}
return;};var getContainer=function(scope){var id=getContainerId(scope);return id?containers[id]:$document;};var removeContainer=function(scope){var id=getContainerId(scope);if(id){delete containers[id];}};return{getContainerId:getContainerId,getContainer:getContainer,setContainer:setContainer,removeContainer:removeContainer};}]);angular.module('duScroll.smoothScroll',['duScroll.scrollHelpers','duScroll.scrollContainerAPI']).directive('duSmoothScroll',["duScrollDuration","duScrollOffset","scrollContainerAPI",function(duScrollDuration,duScrollOffset,scrollContainerAPI){'use strict';return{link:function($scope,$element,$attr){$element.on('click',function(e){if((!$attr.href||$attr.href.indexOf('#')===-1)&&$attr.duSmoothScroll==='')return;var id=$attr.href?$attr.href.replace(/.*(?=#[^\s]+$)/,'').substring(1):$attr.duSmoothScroll;var target=document.getElementById(id)||document.getElementsByName(id)[0];if(!target||!target.getBoundingClientRect)return;if(e.stopPropagation)e.stopPropagation();if(e.preventDefault)e.preventDefault();var offset=$attr.offset?parseInt($attr.offset,10):duScrollOffset;var duration=$attr.duration?parseInt($attr.duration,10):duScrollDuration;var container=scrollContainerAPI.getContainer($scope);container.duScrollToElement(angular.element(target),isNaN(offset)?0:offset,isNaN(duration)?0:duration);});}};}]);angular.module('duScroll.spyContext',['duScroll.spyAPI']).directive('duSpyContext',["spyAPI",function(spyAPI){'use strict';return{restrict:'A',scope:true,compile:function compile(tElement,tAttrs,transclude){return{pre:function preLink($scope,iElement,iAttrs,controller){spyAPI.createContext($scope);}};}};}]);angular.module('duScroll.scrollContainer',['duScroll.scrollContainerAPI']).directive('duScrollContainer',["scrollContainerAPI",function(scrollContainerAPI){'use strict';return{restrict:'A',scope:true,compile:function compile(tElement,tAttrs,transclude){return{pre:function preLink($scope,iElement,iAttrs,controller){iAttrs.$observe('duScrollContainer',function(element){if(angular.isString(element)){element=document.getElementById(element);}
element=(angular.isElement(element)?angular.element(element):iElement);scrollContainerAPI.setContainer($scope,element);$scope.$on('$destroy',function(){scrollContainerAPI.removeContainer($scope);});});}};}};}]);angular.module('duScroll.scrollspy',['duScroll.spyAPI']).directive('duScrollspy',["spyAPI","duScrollOffset","$timeout","$rootScope",function(spyAPI,duScrollOffset,$timeout,$rootScope){'use strict';var Spy=function(targetElementOrId,$scope,$element,offset){if(angular.isElement(targetElementOrId)){this.target=targetElementOrId;}else if(angular.isString(targetElementOrId)){this.targetId=targetElementOrId;}
this.$scope=$scope;this.$element=$element;this.offset=offset;};Spy.prototype.getTargetElement=function(){if(!this.target&&this.targetId){this.target=document.getElementById(this.targetId)||document.getElementsByName(this.targetId)[0];}
return this.target;};Spy.prototype.getTargetPosition=function(){var target=this.getTargetElement();if(target){return target.getBoundingClientRect();}};Spy.prototype.flushTargetCache=function(){if(this.targetId){this.target=undefined;}};return{link:function($scope,$element,$attr){var href=$attr.ngHref||$attr.href;var targetId;if(href&&href.indexOf('#')!==-1){targetId=href.replace(/.*(?=#[^\s]+$)/,'').substring(1);}else if($attr.duScrollspy){targetId=$attr.duScrollspy;}else if($attr.duSmoothScroll){targetId=$attr.duSmoothScroll;}
if(!targetId)return;var timeoutPromise=$timeout(function(){var spy=new Spy(targetId,$scope,$element,-($attr.offset?parseInt($attr.offset,10):duScrollOffset));spyAPI.addSpy(spy);$scope.$on('$locationChangeSuccess',spy.flushTargetCache.bind(spy));var deregisterOnStateChange=$rootScope.$on('$stateChangeSuccess',spy.flushTargetCache.bind(spy));$scope.$on('$destroy',function(){spyAPI.removeSpy(spy);deregisterOnStateChange();});},0,false);$scope.$on('$destroy',function(){$timeout.cancel(timeoutPromise);});}};}]);(function(angular){'use strict';var bindHtmlCompile=angular.module('angular-bind-html-compile',[]);bindHtmlCompile.directive('bindHtmlCompile',['$compile',function($compile){return{restrict:'A',link:function(scope,element,attrs){scope.$watch(function(){return scope.$eval(attrs.bindHtmlCompile);},function(value){element.html(value&&value.toString());var compileScope=scope;if(attrs.bindHtmlScope){compileScope=scope.$eval(attrs.bindHtmlScope);}
$compile(element.contents())(compileScope);});}};}]);if(typeof module!=='undefined'&&module.exports){module.exports=bindHtmlCompile.name;}}(window.angular));!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("angular"),require("angular-sanitize"),require("angular-scroll"),require("angular-hotkeys"),require("angular-bind-html-compile"),require("tether"),require("hone")):"function"==typeof define&&define.amd?define(["angular","angular-sanitize","angular-scroll","angular-hotkeys","angular-bind-html-compile","Tether","Hone"],t):"object"==typeof exports?exports.uiTour=t(require("angular"),require("angular-sanitize"),require("angular-scroll"),require("angular-hotkeys"),require("angular-bind-html-compile"),require("tether"),require("hone")):e.uiTour=t(e.angular,e["angular-sanitize"],e["angular-scroll"],e["angular-hotkeys"],e["angular-bind-html-compile"],e.Tether,e.Hone)}(this,function(e,t,n,r,o,i,u){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r){"ngInject";function o(){t.isTourWaiting()||t.endAllTours()}e.areNavigationInterceptorsEnabled()&&(n.$on("$locationChangeStart",o),n.$on("$stateChangeStart",o),r.has("$transitions")&&r.get("$transitions").onStart({},o))}o.$inject=["TourConfig","uiTourService","$rootScope","$injector"],Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),u=r(i);n(2),n(3),n(4),n(5);var s=n(6),a=r(s),l=n(7),c=r(l);n(8),t.default=u.default.module("bm.uiTour",["ngSanitize","duScroll","cfp.hotkeys","angular-bind-html-compile"]).run(o).value("Tether",a.default).value("Hone",c.default).constant("positionMap",n(13).default).provider("TourConfig",n(14).default).factory("uiTourBackdrop",n(15).default).factory("TourHelpers",n(16).default).factory("uiTourService",n(17).default).factory("TourStepService",n(18).default).controller("uiTourController",n(19).default).directive("uiTour",n(21).default).directive("tourStep",n(22).default).name},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t){e.exports=u},function(e,t,n){var r=n(9);"string"==typeof r&&(r=[[e.i,r,""]]);var o={};o.transform=void 0;n(11)(r,o);r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(10)(void 0),t.push([e.i,".no-scrolling{height:100%;overflow:hidden}.ui-tour-popup:focus{outline:none}.ui-tour-popup-orphan{position:fixed;top:50%;left:50%;margin:0;transform:translateX(-50%) translateY(-50%)}.ui-tour-popup.popover.bottom-left>.arrow,.ui-tour-popup.popover.top-left>.arrow{left:25px}.ui-tour-popup.popover.bottom-right>.arrow,.ui-tour-popup.popover.top-right>.arrow{left:auto;right:25px}.ui-tour-popup.popover.left-top>.arrow,.ui-tour-popup.popover.right-top>.arrow{top:25px}.ui-tour-popup.popover.left-bottom>.arrow,.ui-tour-popup.popover.right-bottom>.arrow{top:auto;bottom:25px}",""])},function(e,t){function n(e,t){var n=e[1]||"",o=e[3];if(!o)return n;if(t&&"function"==typeof btoa){var i=r(o);return[n].concat(o.sources.map(function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"})).concat([i]).join("\n")}return[n].join("\n")}function r(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var r=n(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(r[i]=!0)}for(o=0;o<e.length;o++){var u=e[o];"number"==typeof u[0]&&r[u[0]]||(n&&!u[2]?u[2]=n:n&&(u[2]="("+u[2]+") and ("+n+")"),t.push(u))}},t}},function(e,t,n){function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=h[r.id];if(o){o.refs++;for(var i=0;i<o.parts.length;i++)o.parts[i](r.parts[i]);for(;i<r.parts.length;i++)o.parts.push(c(r.parts[i],t))}else{for(var u=[],i=0;i<r.parts.length;i++)u.push(c(r.parts[i],t));h[r.id]={id:r.id,refs:1,parts:u}}}}function o(e,t){for(var n=[],r={},o=0;o<e.length;o++){var i=e[o],u=t.base?i[0]+t.base:i[0],s=i[1],a=i[2],l=i[3],c={css:s,media:a,sourceMap:l};r[u]?r[u].parts.push(c):n.push(r[u]={id:u,parts:[c]})}return n}function i(e,t){var n=m(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=y[y.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),y.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function u(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=y.indexOf(e);t>=0&&y.splice(t,1)}function s(e){var t=document.createElement("style");return e.attrs.type="text/css",l(t,e.attrs),i(e,t),t}function a(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",l(t,e.attrs),i(e,t),t}function l(e,t){Object.keys(t).forEach(function(n){e.setAttribute(n,t[n])})}function c(e,t){var n,r,o,i;if(t.transform&&e.css){if(!(i=t.transform(e.css)))return function(){};e.css=i}if(t.singleton){var l=b++;n=g||(g=s(t)),r=p.bind(null,n,l,!1),o=p.bind(null,n,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=a(t),r=d.bind(null,n,t),o=function(){u(n),n.href&&URL.revokeObjectURL(n.href)}):(n=s(t),r=f.bind(null,n),o=function(){u(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}function p(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=x(t,o);else{var i=document.createTextNode(o),u=e.childNodes;u[t]&&e.removeChild(u[t]),u.length?e.insertBefore(i,u[t]):e.appendChild(i)}}function f(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function d(e,t,n){var r=n.css,o=n.sourceMap,i=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||i)&&(r=S(r)),o&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var u=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(u),s&&URL.revokeObjectURL(s)}var h={},v=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),m=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e.call(this,n)),t[n]}}(function(e){return document.querySelector(e)}),g=null,b=0,y=[],S=n(12);e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");t=t||{},t.attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||(t.singleton=v()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=o(e,t);return r(n,t),function(e){for(var i=[],u=0;u<n.length;u++){var s=n[u],a=h[s.id];a.refs--,i.push(a)}if(e){r(o(e,t),t)}for(var u=0;u<i.length;u++){var a=i[u];if(0===a.refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete h[a.id]}}}};var x=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(o))return e;var i;return i=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")"})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={top:{target:"top center",popup:"bottom center"},"top-left":{target:"top left",popup:"bottom left"},"top-right":{target:"top right",popup:"bottom right"},bottom:{target:"bottom center",popup:"top center"},"bottom-left":{target:"bottom left",popup:"top left"},"bottom-right":{target:"bottom right",popup:"top right"},left:{target:"middle left",popup:"middle right"},"left-top":{target:"top left",popup:"top right"},"left-bottom":{target:"bottom left",popup:"bottom right"},right:{target:"middle right",popup:"middle left"},"right-top":{target:"top right",popup:"top left"},"right-bottom":{target:"bottom right",popup:"bottom left"}}},function(e,t,n){"use strict";function r(){"ngInject";var e=!1,t={placement:"top",animation:!0,popupDelay:1,closePopupDelay:0,enable:!0,appendToBody:!1,popupClass:"",orphan:!1,backdrop:!1,backdropZIndex:1e4,backdropPadding:"0px",disableBackdropOptimizations:!1,scrollOffset:100,scrollIntoView:!0,useUiRouter:!1,useHotkeys:!1,scrollParentId:"$document",onStart:null,onEnd:null,onPause:null,onResume:null,onNext:null,onPrev:null,onShow:null,onShown:null,onHide:null,onHidden:null};this.set=function(e,n){t[e]=n},this.enableNavigationInterceptors=function(){e=!0},this.$get=["$q",function(n){var r={};return r.get=function(e){return t[e]},r.getAll=function(){return i.default.copy(t)},r.areNavigationInterceptorsEnabled=function(){return e},function(){i.default.forEach(t,function(e,r){0===r.indexOf("on")&&i.default.isFunction(e)&&(t[r]=function(){return n.resolve(e())})})}(),r}]}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function r(e,t){"ngInject";function n(){u.addClass("no-scrolling"),u.on("touchmove",s)}function r(){u.removeClass("no-scrolling"),u.off("touchmove",s)}var o={},u=i.default.element(e[0].body),s=function(e){e.preventDefault()},a=new t({classPrefix:"ui-tour-backdrop"});return o.createForElement=function(e,t){a.setOptions(t),a.position(e[0]),a.show(),t.preventScrolling?o.shouldPreventScrolling(!0):o.shouldPreventScrolling(!1)},o.hide=function(){a.hide(),o.shouldPreventScrolling(!1)},o.shouldPreventScrolling=function(){arguments.length>0&&void 0!==arguments[0]&&!arguments[0]?r():n()},o.reposition=function(){a.status===t.status.VISIBLE&&a.position()},o}r.$inject=["$document","Hone"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function r(e,t,n,r,o,u,s){"ngInject";function a(e){return"true"===e||"false"!==e&&e}var l,c,p={};return u.has("$state")&&(c=u.get("$state")),l=p.safeApply=function(e,t){var n=e.$root.$$phase;"$apply"===n||"$digest"===n?t&&"function"==typeof t&&t():e.$apply(t)},p.attachTourConfigProperties=function(e,t,n,r){i.default.forEach(r,function(e){!t[p.getAttrName(e)]&&i.default.isDefined(n.config(e))&&t.$set(p.getAttrName(e),String(n.config(e)))})},p.attachEventHandlers=function(e,t,n,r,u){i.default.forEach(r,function(r){var i=p.getAttrName(r,u);t[i]&&(n[r]=function(){return o(function(n){l(e,function(){n(e.$eval(t[i]))})})})})},p.attachInterpolatedValues=function(e,t,n,r){i.default.forEach(n,function(n){var o=p.getAttrName(n,r);e[o]&&(t[n]=a(e[o]),e.$observe(o,function(e){t[n]=a(e)}))})},p.setRedirect=function(e,t,r,i,u){var a=e[r];e[r]=function(r){return o(function(o){a&&a(r),t.waitFor(u),e.config("useUiRouter")?c.go(i).then(o):(n.path(i),s(o))})}},p.getAttrName=function(e,t){return(t||"tourStep")+e.charAt(0).toUpperCase()+e.substr(1)},p}r.$inject=["$http","$compile","$location","TourConfig","$q","$injector","$timeout"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function r(e,t){"ngInject";var n={},r=[];return n.getTour=function(){return r[0]},n.getTourByName=function(e){return r.filter(function(t){return t.options.name===e})[0]},n.getTourByElement=function(e){return i.default.element(e).controller("uiTour")},n.createDetachedTour=function(t,n){if(!t)throw{name:"ParameterMissingError",message:"A unique tour name is required for creating a detached tour."};return n=n||{},n.name=t,e("uiTourController").init(n)},n.isTourWaiting=function(){return r.reduce(function(e,t){return e||t.getStatus()===t.Status.WAITING},!1)},n.endAllTours=function(){return t.all(r.map(function(e){return e.end()}))},n._registerTour=function(e){r.push(e)},n._unregisterTour=function(e){r.splice(r.indexOf(e),1)},n}r.$inject=["$controller","$q"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=["Tether","$compile","$document","$templateCache","$rootScope","$window","$q","$timeout","positionMap","uiTourBackdrop",function(e,t,n,r,i,u,s,a,l,c){"ngInject";function p(e,u){var s=o.default.extend(i.$new(),{tourStep:e,tour:u}),a=t(r.get("tour-step-popup.html"))(s);return(e.config("appendToBody")?o.default.element(n[0].body):e.element.parent()).append(a),a}function f(e){if(!e.config("orphan")&&e.config("scrollIntoView")){("$document"===e.config("scrollParentId")?n:o.default.element(n[0].getElementById(e.config("scrollParentId")))).duScrollToElementAnimated(e.popup,e.config("scrollOffset"),500,g).then(function(){e.popup[0].focus()},function(){return"Failed to scroll."})}else e.popup[0].focus()}function d(t){t.config("orphan")||(t.tether?(t.tether.enable(),t.tether.position()):(t.tether=new e({element:t.popup[0],target:t.element[0],attachment:l[t.config("placement")].popup,targetAttachment:l[t.config("placement")].target}),t.tether.position()))}function h(e){d(e),u.scrollTo(u.scrollX,u.scrollY+1),a(function(){e.popup.css({visibility:"visible",display:"block"}),f(e)},100)}function v(e){e.tether&&e.tether.disable(),e.popup[0].style.setProperty("display","none","important")}var m={},g=function(e){return e<.5?2*e*e:(4-2*e)*e-1};return m.createStep=function(e,t){if(!e.element&&!e.elementId&&!e.selector)throw{name:"PropertyMissingError",message:"Steps require an element, ID, or selector to be specified"};return e.config=function(n){return o.default.isDefined(e[n])?e[n]:t.config(n)},e.reposition=function(){e.tether&&e.tether.position()},o.default.isDefined(e.enabled)||(e.enabled=!0),e},m.showStep=function(e,t){if(e.elementId&&(e.element=o.default.element(n[0].getElementById(e.elementId))),e.selector&&(e.element=o.default.element(n[0].querySelector(e.selector))),!e.element)throw"No element found for step: '"+e+"'.";e.config("backdrop")&&c.createForElement(e.element,{preventScrolling:e.config("preventScrolling"),fixed:e.config("fixed"),borderRadius:e.config("backdropBorderRadius"),padding:e.config("backdropPadding"),fullScreen:e.config("orphan"),disableOptimizations:e.config("disableBackdropOptimizations"),events:{click:e.config("onBackdropClick")}}),e.element.addClass("ui-tour-active-step"),e.popup||(e.popup=p(e,t)),h(e)},m.hideStep=function(e){v(e),e.element.removeClass("ui-tour-active-step")},m}];var r=n(0),o=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o,i,s,l,c){"ngInject";function p(){return t.resolve()}function f(){return k}function d(e){k=e}function h(e){return f()?f().config("nextPath")&&e>0?null:f().config("prevPath")&&e<0?null:$[$.indexOf(f())+e]:null}function v(e){if(u.default.isNumber(e))return $[e];if(u.default.isString(e))return $.filter(function(t){return t.stepId===e})[0];if(u.default.isObject(e)){if(~$.indexOf(e))return e;if(e.stepId)return $.filter(function(t){return t.stepId===e.stepId})[0]}return null}function m(){return h(1)}function g(){return h(-1)}function b(){return!!(m()||f()&&(f().config("nextPath")||f().onNext))}function y(){return!!(g()||f()&&(f().config("prevPath")||f().onPrev))}function S(e){return(e||p)()}function x(){c.add({combo:"esc",description:"End tour",callback:function(){T.end()}}),c.add({combo:"right",description:"Go to next step",callback:function(){b()&&T.next()}}),c.add({combo:"left",description:"Go to previous step",callback:function(){y()&&T.prev()}})}function _(){c.del("esc"),c.del("right"),c.del("left")}var w,T=new a.default,$=[],k=null,P={OFF:0,ON:1,PAUSED:2,WAITING:3},C=P.OFF,N=o.getAll();return T.off=T.removeListener,T.addStep=function(e){~$.indexOf(e)||($.push(e),$=n("orderBy")($,"order"),T.emit("stepAdded",e),w&&w(e))},T.removeStep=function(e){var t=$.indexOf(e);-1!==t&&($.splice(t,1),T.emit("stepRemoved",e))},T.reorderStep=function(e){T.removeStep(e),T.addStep(e),T.emit("stepsReordered",e)},T.hasStep=function(e){return!!v(e)},T.showStep=function(e){return t.resolve().then(function(){if(!e)throw"No step.";return S(e.config("onShow"))}).then(function(){return l.showStep(e,T),p()}).then(function(){return S(e.config("onShown"))}).then(function(){T.emit("stepShown",e),e.isNext=b,e.isPrev=y})},T.hideStep=function(e){return t.resolve().then(function(){if(!e)throw"No step.";return S(e.config("onHide"))}).then(function(){return l.hideStep(e),p()}).then(function(){return S(e.config("onHidden"))}).then(function(){T.emit("stepHidden",e)})},T.config=function(e){return N[e]},T.init=function(e){return N=u.default.extend(N,e),T.options=N,s._registerTour(T),T.initialized=!0,T.emit("initialized"),T},T.destroy=function(){s._unregisterTour(T)},T.start=function(){return T.startAt(0)},T.startAt=function(e){var n;return t.resolve().then(function(){return S(N.onStart)}).then(function(){return n=v(e),d(n),C=P.ON,T.emit("started",n),N.useHotkeys&&x(),T.showStep(f())})},T.end=function(){return t.resolve().then(function(){return S(N.onEnd)}).then(function(){if(f())return i.hide(),T.hideStep(f())}).then(function(){d(null),T.emit("ended"),C=P.OFF,w=null,N.useHotkeys&&_()})},T.pause=function(){return t.resolve().then(function(){return S(N.onPause)}).then(function(){return C=P.PAUSED,i.hide(),T.hideStep(f())}).then(function(){T.emit("paused",f())})},T.resume=function(){return t.resolve().then(function(){return S(N.onResume)}).then(function(){return C=P.ON,T.emit("resumed",f()),T.showStep(f())})},T.next=function(){return T.goTo("$next")},T.prev=function(){return T.goTo("$prev")},T.goTo=function(e){var n,r,o,u;return t.resolve().then(function(){if(n=f(),r=v(e),o={$prev:{getStep:g,preEvent:"onPrev",navCheck:"prevStep"},$next:{getStep:m,preEvent:"onNext",navCheck:"nextStep"}},u="$prev"===e||"$next"===e)return t.resolve().then(function(){return S(n.config(o[e].preEvent))}).then(function(){return T.hideStep(n)})}).then(function(){return!u||n[o[e].navCheck]&&n[o[e].navCheck]===f().stepId||(d(o[e].getStep()),T.emit("stepChanged",f())),u&&f()&&!f().config("backdrop")&&i.hide(),u&&f()&&!f().config("preventScrolling")&&i.shouldPreventScrolling(!1),u&&f()?T.showStep(f()):u?T.end():t.resolve().then(function(){if(!r)throw"No step.";return T.hideStep(f())}).then(function(){return f().config("backdrop")&&!r.config("backdrop")&&i.hide(),f().config("backdrop")&&!r.config("preventScrolling")&&i.shouldPreventScrolling(!1),d(r),T.emit("stepChanged",f()),T.showStep(r)})}).then(function(){})},T.waitFor=function(e){function n(t){t.stepId===e&&(d($[$.indexOf(t)]),T.resume(),w=null)}return t.resolve().then(function(){return w=n,T.pause()}).then(function(){return C=P.WAITING,t.reject()})},T.createStep=function(e){var t=l.createStep(e,T);return T.initialized?T.addStep(t):T.once("initialized",function(){T.addStep(t)}),t},T.getCurrentStep=function(){return f()},T.reposition=function(){f()&&(f().reposition(),i.reposition())},T.getStatus=function(){return C},T.Status=P,T._getSteps=function(){return $},T._getCurrentStep=f,T._setCurrentStep=d,T}o.$inject=["$timeout","$q","$filter","$document","TourConfig","uiTourBackdrop","uiTourService","TourStepService","hotkeys"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=o;var i=n(0),u=r(i),s=n(20),a=r(s)},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function u(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,s,a,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],u(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(i(n))for(s=Array.prototype.slice.call(arguments,1),l=n.slice(),o=l.length,a=0;a<o;a++)l[a].apply(this,s);return!0},n.prototype.addListener=function(e,t){var o;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(o=u(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var o=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,o,u,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],u=n.length,o=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(s=u;s-->0;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";function r(e){"ngInject";return{restrict:"EA",scope:!0,controller:"uiTourController",link:function(t,n,r,o){var u={name:r.uiTour},s="onReady onStart onEnd onShow onShown onHide onHidden onNext onPrev onPause onResume onBackdropClick".split(" "),a="placement animation popupDelay closePopupDelay enable appendToBody popupClass orphan backdrop backdropBorderRadius backdropPadding disableBackdropOptimizations scrollParentId scrollOffset scrollIntoView useUiRouter useHotkeys".split(" ");e.attachInterpolatedValues(r,u,a,"uiTour"),e.attachEventHandlers(t,r,u,s,"uiTour"),r[e.getAttrName("templateUrl","uiTour")]&&(u.templateUrl=t.$eval(r[e.getAttrName("templateUrl","uiTour")])),r[e.getAttrName("options")]&&i.default.extend(u,t.$eval(r[e.getAttrName("options")])),t.tour=o.init(u),"function"==typeof u.onReady&&u.onReady(),t.$on("$destroy",function(){o.destroy()})}}}r.$inject=["TourHelpers"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(o)},function(e,t,n){"use strict";function r(e,t,n){"ngInject";return{restrict:"EA",scope:!0,require:"?^uiTour",link:function(r,o,u,s){var a,l,c,p,f,d="onShow onShown onHide onHidden onNext onPrev onBackdropClick".split(" "),h="content title animation placement backdrop backdropBorderRadius backdropPadding disableBackdropOptimizations orphan popupDelay popupCloseDelay popupClass fixed preventScrolling scrollIntoView nextStep prevStep nextPath prevPath scrollOffset scrollParentId".split(" ");if(u[e.getAttrName("belongsTo")]?a=t.getTourByName(u[e.getAttrName("belongsTo")]):s&&(a=s),!a)throw{name:"DependencyMissingError",message:"No tour provided for tour step."};l=a.createStep({stepId:u.tourStep,element:o}),e.attachInterpolatedValues(u,l,h),c=u.$observe(e.getAttrName("order"),function(e){l.order=isNaN(1*e)?0:1*e,a.hasStep(l)&&a.reorderStep(l)}),p=u.$observe(e.getAttrName("enabled"),function(e){l.enabled="false"!==e,l.enabled?a.addStep(l):a.removeStep(l)}),f=u.$observe(e.getAttrName("content"),function(e){e&&(l.trustedContent=n.trustAsHtml(l.content))}),e.attachEventHandlers(r,u,l,d),u[e.getAttrName("templateUrl")]&&(l.templateUrl=r.$eval(u[e.getAttrName("templateUrl")])),u[e.getAttrName("options")]&&i.default.extend(l,r.$eval(u[e.getAttrName("options")])),l.nextPath&&(l.redirectNext=!0,e.setRedirect(l,a,"onNext",l.nextPath,l.nextStep)),l.prevPath&&(l.redirectPrev=!0,e.setRedirect(l,a,"onPrev",l.prevPath,l.prevStep)),l.trustedContent=n.trustAsHtml(l.content),r.tourStep=l,r.tour=a,Object.defineProperties(l,{element:{value:o},scope:{value:r}}),r.$on("$destroy",function(){a.removeStep(l),c(),p(),f()})}}}r.$inject=["TourHelpers","uiTourService","$sce"],Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var o=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(o);n(23),n(24)},function(e,t){var n,r=window.angular;try{n=r.module(["bm.uiTour"])}catch(e){n=r.module("bm.uiTour",[])}var o="<div class=\"tourStep ui-tour-popup popover {{ tourStep.config('popupClass') }} {{ tourStep.config('orphan') ? 'ui-tour-popup-orphan' : tourStep.config('placement').split('-')[0] + ' ' + tourStep.config('placement') }}\" ng-style=\"{\n        visibility: 'hidden',\n        display: 'block',\n        position: tourStep.config('fixed') || tourStep.config('orphan') ? 'fixed' : 'absolute',\n        zIndex: tourStep.config('backdropZIndex') + 2\n     }\" tabindex=\"0\" aria-hidden=\"{{ tour._getCurrentStep() !== tourStep }}\">\n<div class=\"arrow\"></div>\n<div class=\"popover-inner tour-step-inner\">\n<h3 class=\"popover-title tour-step-title\" ng-bind=\"tourStep.config('title')\" ng-if=\"tourStep.config('title')\"></h3>\n<div class=\"popover-content tour-step-content\" ng-include=\"tourStep.config('templateUrl') || 'tour-step-template.html'\"></div>\n</div>\n</div>\n",i="tour-step-popup.html",u=r.element(window.document).injector();u?u.get("$templateCache").put(i,o):n.run(["$templateCache",function(e){e.put(i,o)}]),e.exports=o},function(e,t){var n,r=window.angular;try{n=r.module(["bm.uiTour"])}catch(e){n=r.module("bm.uiTour",[])}var o='<div>\n<div class="popover-content tour-step-content" bind-html-compile="tourStep.trustedContent || tourStep.content"></div>\n<div class="popover-navigation tour-step-navigation">\n<div class="btn-group">\n<button type="button" class="btn btn-sm btn-default" ng-if="tourStep.isPrev()" ng-click="tour.prev()">&laquo; Prev</button>\n<button type="button" class="btn btn-sm btn-default" ng-if="tourStep.isNext()" ng-click="tour.next()">Next &raquo;</button>\n<button type="button" class="btn btn-sm btn-default" ng-click="tour.pause()">Pause</button>\n</div>\n<button type="button" class="btn btn-sm btn-default" ng-click="tour.end()">End tour</button>\n</div>\n</div>\n',i="tour-step-template.html",u=r.element(window.document).injector();u?u.get("$templateCache").put(i,o):n.run(["$templateCache",function(e){e.put(i,o)}]),e.exports=o}])});(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory(require('rgbcolor'),require('stackblur-canvas')):typeof define==='function'&&define.amd?define(['rgbcolor','stackblur-canvas'],factory):(global.canvg=factory(global.RGBColor,global.StackBlur));}(this,(function(rgbcolor,stackblurCanvas){'use strict';rgbcolor=rgbcolor&&rgbcolor.hasOwnProperty('default')?rgbcolor['default']:rgbcolor;stackblurCanvas=stackblurCanvas&&stackblurCanvas.hasOwnProperty('default')?stackblurCanvas['default']:stackblurCanvas;function createCommonjsModule(fn,module){return module={exports:{}},fn(module,module.exports),module.exports;}
var canvg_1=createCommonjsModule(function(module){var isNode=(module.exports&&typeof window==='undefined'),nodeEnv=false;var windowEnv;{windowEnv=window;windowEnv.DOMParser=window.DOMParser;}
var defaultClientWidth=800,defaultClientHeight=600;function createCanvas(){var c;{c=document.createElement('canvas');}
return c;}
var canvg=function(target,s,opts){if(target==null&&s==null&&opts==null){var svgTags=document.querySelectorAll('svg');for(var i=0;i<svgTags.length;i++){var svgTag=svgTags[i];var c=document.createElement('canvas');c.width=svgTag.clientWidth;c.height=svgTag.clientHeight;svgTag.parentNode.insertBefore(c,svgTag);svgTag.parentNode.removeChild(svgTag);var div=document.createElement('div');div.appendChild(svgTag);canvg(c,div.innerHTML);}
return;}
var svg=build(opts||{});if(typeof target=='string'){target=document.getElementById(target);}
if(target.svg!=null)target.svg.stop();if(!(target.childNodes&&target.childNodes.length==1&&target.childNodes[0].nodeName=='OBJECT'))target.svg=svg;var ctx=target.getContext('2d');if(typeof s.documentElement!='undefined'){svg.loadXmlDoc(ctx,s);}else if(s.substr(0,1)=='<'){svg.loadXml(ctx,s);}else{svg.load(ctx,s);}};var matchesSelector;{if(typeof Element=='undefined');else if(typeof Element.prototype.matches!='undefined'){matchesSelector=function(node,selector){return node.matches(selector);};}else if(typeof Element.prototype.webkitMatchesSelector!='undefined'){matchesSelector=function(node,selector){return node.webkitMatchesSelector(selector);};}else if(typeof Element.prototype.mozMatchesSelector!='undefined'){matchesSelector=function(node,selector){return node.mozMatchesSelector(selector);};}else if(typeof Element.prototype.msMatchesSelector!='undefined'){matchesSelector=function(node,selector){return node.msMatchesSelector(selector);};}else if(typeof Element.prototype.oMatchesSelector!='undefined'){matchesSelector=function(node,selector){return node.oMatchesSelector(selector);};}else{if(typeof jQuery==='function'||typeof Zepto==='function'){matchesSelector=function(node,selector){return $(node).is(selector);};}
if(typeof matchesSelector==='undefined'&&typeof Sizzle!=='undefined'){matchesSelector=Sizzle.matchesSelector;}}}
var attributeRegex=/(\[[^\]]+\])/g;var idRegex=/(#[^\s\+>~\.\[:]+)/g;var classRegex=/(\.[^\s\+>~\.\[:]+)/g;var pseudoElementRegex=/(::[^\s\+>~\.\[:]+|:first-line|:first-letter|:before|:after)/gi;var pseudoClassWithBracketsRegex=/(:[\w-]+\([^\)]*\))/gi;var pseudoClassRegex=/(:[^\s\+>~\.\[:]+)/g;var elementRegex=/([^\s\+>~\.\[:]+)/g;function getSelectorSpecificity(selector){var typeCount=[0,0,0];var findMatch=function(regex,type){var matches=selector.match(regex);if(matches==null){return;}
typeCount[type]+=matches.length;selector=selector.replace(regex,' ');};selector=selector.replace(/:not\(([^\)]*)\)/g,'     $1 ');selector=selector.replace(/{[\s\S]*/gm,' ');findMatch(attributeRegex,1);findMatch(idRegex,0);findMatch(classRegex,1);findMatch(pseudoElementRegex,2);findMatch(pseudoClassWithBracketsRegex,1);findMatch(pseudoClassRegex,1);selector=selector.replace(/[\*\s\+>~]/g,' ');selector=selector.replace(/[#\.]/g,' ');findMatch(elementRegex,2);return typeCount.join('');}
function build(opts){var svg={opts:opts};svg.FRAMERATE=30;svg.MAX_VIRTUAL_PIXELS=30000;svg.rootEmSize=12;svg.emSize=12;svg.log=function(msg){};if(svg.opts['log']==true&&typeof console!='undefined'){svg.log=function(msg){console.log(msg);};}
svg.init=function(ctx){var uniqueId=0;svg.UniqueId=function(){uniqueId++;return'canvg'+uniqueId;};svg.Definitions={};svg.Styles={};svg.StylesSpecificity={};svg.Animations=[];svg.Images=[];svg.ctx=ctx;svg.ViewPort=new(function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[];};this.SetCurrent=function(width,height){this.viewPorts.push({width:width,height:height});};this.RemoveCurrent=function(){this.viewPorts.pop();};this.Current=function(){return this.viewPorts[this.viewPorts.length-1];};this.width=function(){return this.Current().width;};this.height=function(){return this.Current().height;};this.ComputeSize=function(d){if(d!=null&&typeof d=='number')return d;if(d=='x')return this.width();if(d=='y')return this.height();return Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2);};});};svg.init();svg.ImagesLoaded=function(){for(var i=0;i<svg.Images.length;i++){if(!svg.Images[i].loaded)return false;}
return true;};svg.trim=function(s){return s.replace(/^\s+|\s+$/g,'');};svg.compressSpaces=function(s){return s.replace(/(?!\u3000)\s+/gm,' ');};svg.ajax=function(url){var AJAX;if(windowEnv.XMLHttpRequest){AJAX=new windowEnv.XMLHttpRequest();}else{AJAX=new ActiveXObject('Microsoft.XMLHTTP');}
if(AJAX){AJAX.open('GET',url,false);AJAX.send(null);return AJAX.responseText;}
return null;};svg.parseXml=function(xml){if(typeof Windows!='undefined'&&typeof Windows.Data!='undefined'&&typeof Windows.Data.Xml!='undefined'){var xmlDoc=new Windows.Data.Xml.Dom.XmlDocument();var settings=new Windows.Data.Xml.Dom.XmlLoadSettings();settings.prohibitDtd=false;xmlDoc.loadXml(xml,settings);return xmlDoc;}else if(windowEnv.DOMParser){try{var parser=opts.xmldom?new windowEnv.DOMParser(opts.xmldom):new windowEnv.DOMParser();return parser.parseFromString(xml,'image/svg+xml');}catch(e){parser=opts.xmldom?new windowEnv.DOMParser(opts.xmldom):new windowEnv.DOMParser();return parser.parseFromString(xml,'text/xml');}}else{xml=xml.replace(/<!DOCTYPE svg[^>]*>/,'');var xmlDoc=new ActiveXObject('Microsoft.XMLDOM');xmlDoc.async='false';xmlDoc.loadXML(xml);return xmlDoc;}};svg.Property=function(name,value){this.name=name;this.value=value;};svg.Property.prototype.getValue=function(){return this.value;};svg.Property.prototype.hasValue=function(){return(this.value!=null&&this.value!=='');};svg.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var n=parseFloat(this.value);if((this.value+'').match(/%$/)){n=n/100.0;}
return n;};svg.Property.prototype.valueOrDefault=function(def){if(this.hasValue())return this.value;return def;};svg.Property.prototype.numValueOrDefault=function(def){if(this.hasValue())return this.numValue();return def;};svg.Property.prototype.addOpacity=function(opacityProp){var newValue=this.value;if(opacityProp.value!=null&&opacityProp.value!=''&&typeof this.value=='string'){var color=new rgbcolor(this.value);if(color.ok){newValue='rgba('+color.r+', '+color.g+', '+color.b+', '+opacityProp.numValue()+')';}}
return new svg.Property(this.name,newValue);};svg.Property.prototype.getDefinition=function(){var name=this.value.match(/#([^\)'"]+)/);if(name){name=name[1];}
if(!name){name=this.value;}
return svg.Definitions[name];};svg.Property.prototype.isUrlDefinition=function(){return this.value.indexOf('url(')==0};svg.Property.prototype.getFillStyleDefinition=function(e,opacityProp){var def=this.getDefinition();if(def!=null&&def.createGradient){return def.createGradient(svg.ctx,e,opacityProp);}
if(def!=null&&def.createPattern){if(def.getHrefAttribute().hasValue()){var pt=def.attribute('patternTransform');def=def.getHrefAttribute().getDefinition();if(pt.hasValue()){def.attribute('patternTransform',true).value=pt.value;}}
return def.createPattern(svg.ctx,e);}
return null;};svg.Property.prototype.getDPI=function(viewPort){return 96.0;};svg.Property.prototype.getREM=function(viewPort){return svg.rootEmSize;};svg.Property.prototype.getEM=function(viewPort){return svg.emSize;};svg.Property.prototype.getUnits=function(){var s=this.value+'';return s.replace(/[0-9\.\-]/g,'');};svg.Property.prototype.isPixels=function(){if(!this.hasValue())return false;var s=this.value+'';if(s.match(/px$/))return true;if(s.match(/^[0-9]+$/))return true;return false;};svg.Property.prototype.toPixels=function(viewPort,processPercent){if(!this.hasValue())return 0;var s=this.value+'';if(s.match(/rem$/))return this.numValue()*this.getREM(viewPort);if(s.match(/em$/))return this.numValue()*this.getEM(viewPort);if(s.match(/ex$/))return this.numValue()*this.getEM(viewPort)/2.0;if(s.match(/px$/))return this.numValue();if(s.match(/pt$/))return this.numValue()*this.getDPI(viewPort)*(1.0/72.0);if(s.match(/pc$/))return this.numValue()*15;if(s.match(/cm$/))return this.numValue()*this.getDPI(viewPort)/2.54;if(s.match(/mm$/))return this.numValue()*this.getDPI(viewPort)/25.4;if(s.match(/in$/))return this.numValue()*this.getDPI(viewPort);if(s.match(/%$/))return this.numValue()*svg.ViewPort.ComputeSize(viewPort);var n=this.numValue();if(processPercent&&n<1.0)return n*svg.ViewPort.ComputeSize(viewPort);return n;};svg.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var s=this.value+'';if(s.match(/s$/))return this.numValue()*1000;if(s.match(/ms$/))return this.numValue();return this.numValue();};svg.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var s=this.value+'';if(s.match(/deg$/))return this.numValue()*(Math.PI/180.0);if(s.match(/grad$/))return this.numValue()*(Math.PI/200.0);if(s.match(/rad$/))return this.numValue();return this.numValue()*(Math.PI/180.0);};var textBaselineMapping={'baseline':'alphabetic','before-edge':'top','text-before-edge':'top','middle':'middle','central':'middle','after-edge':'bottom','text-after-edge':'bottom','ideographic':'ideographic','alphabetic':'alphabetic','hanging':'hanging','mathematical':'alphabetic'};svg.Property.prototype.toTextBaseline=function(){if(!this.hasValue())return null;return textBaselineMapping[this.value];};svg.Font=new(function(){this.Styles='normal|italic|oblique|inherit';this.Variants='normal|small-caps|inherit';this.Weights='normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit';this.CreateFont=function(fontStyle,fontVariant,fontWeight,fontSize,fontFamily,inherit){var f=inherit!=null?this.Parse(inherit):this.CreateFont('','','','','',svg.ctx.font);var fontFamily=fontFamily||f.fontFamily;return{fontFamily:fontFamily,fontSize:fontSize||f.fontSize,fontStyle:fontStyle||f.fontStyle,fontWeight:fontWeight||f.fontWeight,fontVariant:fontVariant||f.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(' ')}}};var that=this;this.Parse=function(s){var f={};var d=svg.trim(svg.compressSpaces(s||'')).split(' ');var set={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};var ff='';for(var i=0;i<d.length;i++){if(!set.fontStyle&&that.Styles.indexOf(d[i])!=-1){if(d[i]!='inherit')f.fontStyle=d[i];set.fontStyle=true;}else if(!set.fontVariant&&that.Variants.indexOf(d[i])!=-1){if(d[i]!='inherit')f.fontVariant=d[i];set.fontStyle=set.fontVariant=true;}else if(!set.fontWeight&&that.Weights.indexOf(d[i])!=-1){if(d[i]!='inherit')f.fontWeight=d[i];set.fontStyle=set.fontVariant=set.fontWeight=true;}else if(!set.fontSize){if(d[i]!='inherit')f.fontSize=d[i].split('/')[0];set.fontStyle=set.fontVariant=set.fontWeight=set.fontSize=true;}else{if(d[i]!='inherit')ff+=d[i];}}
if(ff!='')f.fontFamily=ff;return f;};});svg.ToNumberArray=function(s){var a=svg.trim(svg.compressSpaces((s||'').replace(/,/g,' '))).split(' ');for(var i=0;i<a.length;i++){a[i]=parseFloat(a[i]);}
return a;};svg.Point=function(x,y){this.x=x;this.y=y;};svg.Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x);};svg.Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4];var yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp;this.y=yp;};svg.CreatePoint=function(s){var a=svg.ToNumberArray(s);return new svg.Point(a[0],a[1]);};svg.CreatePath=function(s){var a=svg.ToNumberArray(s);var path=[];for(var i=0;i<a.length;i+=2){path.push(new svg.Point(a[i],a[i+1]));}
return path;};svg.BoundingBox=function(x1,y1,x2,y2){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1;};this.y=function(){return this.y1;};this.width=function(){return this.x2-this.x1;};this.height=function(){return this.y2-this.y1;};this.addPoint=function(x,y){if(x!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=x;this.x2=x;}
if(x<this.x1)this.x1=x;if(x>this.x2)this.x2=x;}
if(y!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=y;this.y2=y;}
if(y<this.y1)this.y1=y;if(y>this.y2)this.y2=y;}};this.addX=function(x){this.addPoint(x,null);};this.addY=function(y){this.addPoint(null,y);};this.addBoundingBox=function(bb){this.addPoint(bb.x1,bb.y1);this.addPoint(bb.x2,bb.y2);};this.addQuadraticCurve=function(p0x,p0y,p1x,p1y,p2x,p2y){var cp1x=p0x+2/3*(p1x-p0x);var cp1y=p0y+2/3*(p1y-p0y);var cp2x=cp1x+1/3*(p2x-p0x);var cp2y=cp1y+1/3*(p2y-p0y);this.addBezierCurve(p0x,p0y,cp1x,cp2x,cp1y,cp2y,p2x,p2y);};this.addBezierCurve=function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var p0=[p0x,p0y],p1=[p1x,p1y],p2=[p2x,p2y],p3=[p3x,p3y];this.addPoint(p0[0],p0[1]);this.addPoint(p3[0],p3[1]);for(var i=0;i<=1;i++){var f=function(t){return Math.pow(1-t,3)*p0[i]+
3*Math.pow(1-t,2)*t*p1[i]+
3*(1-t)*Math.pow(t,2)*p2[i]+
Math.pow(t,3)*p3[i];};var b=6*p0[i]-12*p1[i]+6*p2[i];var a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i];var c=3*p1[i]-3*p0[i];if(a==0){if(b==0)continue;var t=-c/b;if(0<t&&t<1){if(i==0)this.addX(f(t));if(i==1)this.addY(f(t));}
continue;}
var b2ac=Math.pow(b,2)-4*c*a;if(b2ac<0)continue;var t1=(-b+Math.sqrt(b2ac))/(2*a);if(0<t1&&t1<1){if(i==0)this.addX(f(t1));if(i==1)this.addY(f(t1));}
var t2=(-b-Math.sqrt(b2ac))/(2*a);if(0<t2&&t2<1){if(i==0)this.addX(f(t2));if(i==1)this.addY(f(t2));}}};this.isPointInBox=function(x,y){return(this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2);};this.addPoint(x1,y1);this.addPoint(x2,y2);};svg.Transform=function(v){var that=this;this.Type={};this.Type.translate=function(s){this.p=svg.CreatePoint(s);this.apply=function(ctx){ctx.translate(this.p.x||0.0,this.p.y||0.0);};this.unapply=function(ctx){ctx.translate(-1.0*this.p.x||0.0,-1.0*this.p.y||0.0);};this.applyToPoint=function(p){p.applyTransform([1,0,0,1,this.p.x||0.0,this.p.y||0.0]);};};this.Type.rotate=function(s){var a=svg.ToNumberArray(s);this.angle=new svg.Property('angle',a[0]);this.cx=a[1]||0;this.cy=a[2]||0;this.apply=function(ctx){ctx.translate(this.cx,this.cy);ctx.rotate(this.angle.toRadians());ctx.translate(-this.cx,-this.cy);};this.unapply=function(ctx){ctx.translate(this.cx,this.cy);ctx.rotate(-1.0*this.angle.toRadians());ctx.translate(-this.cx,-this.cy);};this.applyToPoint=function(p){var a=this.angle.toRadians();p.applyTransform([1,0,0,1,this.p.x||0.0,this.p.y||0.0]);p.applyTransform([Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0]);p.applyTransform([1,0,0,1,-this.p.x||0.0,-this.p.y||0.0]);};};this.Type.scale=function(s){this.p=svg.CreatePoint(s);this.apply=function(ctx){ctx.scale(this.p.x||1.0,this.p.y||this.p.x||1.0);};this.unapply=function(ctx){ctx.scale(1.0/this.p.x||1.0,1.0/this.p.y||this.p.x||1.0);};this.applyToPoint=function(p){p.applyTransform([this.p.x||0.0,0,0,this.p.y||0.0,0,0]);};};this.Type.matrix=function(s){this.m=svg.ToNumberArray(s);this.apply=function(ctx){ctx.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5]);};this.unapply=function(ctx){var a=this.m[0];var b=this.m[2];var c=this.m[4];var d=this.m[1];var e=this.m[3];var f=this.m[5];var g=0.0;var h=0.0;var i=1.0;var det=1/(a*(e*i-f*h)-b*(d*i-f*g)+c*(d*h-e*g));ctx.transform(det*(e*i-f*h),det*(f*g-d*i),det*(c*h-b*i),det*(a*i-c*g),det*(b*f-c*e),det*(c*d-a*f));};this.applyToPoint=function(p){p.applyTransform(this.m);};};this.Type.SkewBase=function(s){this.base=that.Type.matrix;this.base(s);this.angle=new svg.Property('angle',s);};this.Type.SkewBase.prototype=new this.Type.matrix;this.Type.skewX=function(s){this.base=that.Type.SkewBase;this.base(s);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0];};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(s){this.base=that.Type.SkewBase;this.base(s);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0];};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(ctx){for(var i=0;i<this.transforms.length;i++){this.transforms[i].apply(ctx);}};this.unapply=function(ctx){for(var i=this.transforms.length-1;i>=0;i--){this.transforms[i].unapply(ctx);}};this.applyToPoint=function(p){for(var i=0;i<this.transforms.length;i++){this.transforms[i].applyToPoint(p);}};var data=svg.trim(svg.compressSpaces(v)).replace(/\)([a-zA-Z])/g,') $1').replace(/\)(\s?,\s?)/g,') ').split(/\s(?=[a-z])/);for(var i=0;i<data.length;i++){if(data[i]==='none'){continue;}
var type=svg.trim(data[i].split('(')[0]);var s=data[i].split('(')[1].replace(')','');var transformType=this.Type[type];if(typeof transformType!='undefined'){var transform=new transformType(s);transform.type=type;this.transforms.push(transform);}}};svg.AspectRatio=function(ctx,aspectRatio,width,desiredWidth,height,desiredHeight,minX,minY,refX,refY){aspectRatio=svg.compressSpaces(aspectRatio);aspectRatio=aspectRatio.replace(/^defer\s/,'');var align=aspectRatio.split(' ')[0]||'xMidYMid';var meetOrSlice=aspectRatio.split(' ')[1]||'meet';var scaleX=width/desiredWidth;var scaleY=height/desiredHeight;var scaleMin=Math.min(scaleX,scaleY);var scaleMax=Math.max(scaleX,scaleY);if(meetOrSlice=='meet'){desiredWidth*=scaleMin;desiredHeight*=scaleMin;}
if(meetOrSlice=='slice'){desiredWidth*=scaleMax;desiredHeight*=scaleMax;}
refX=new svg.Property('refX',refX);refY=new svg.Property('refY',refY);if(refX.hasValue()&&refY.hasValue()){ctx.translate(-scaleMin*refX.toPixels('x'),-scaleMin*refY.toPixels('y'));}else{if(align.match(/^xMid/)&&((meetOrSlice=='meet'&&scaleMin==scaleY)||(meetOrSlice=='slice'&&scaleMax==scaleY)))ctx.translate(width/2.0-desiredWidth/2.0,0);if(align.match(/YMid$/)&&((meetOrSlice=='meet'&&scaleMin==scaleX)||(meetOrSlice=='slice'&&scaleMax==scaleX)))ctx.translate(0,height/2.0-desiredHeight/2.0);if(align.match(/^xMax/)&&((meetOrSlice=='meet'&&scaleMin==scaleY)||(meetOrSlice=='slice'&&scaleMax==scaleY)))ctx.translate(width-desiredWidth,0);if(align.match(/YMax$/)&&((meetOrSlice=='meet'&&scaleMin==scaleX)||(meetOrSlice=='slice'&&scaleMax==scaleX)))ctx.translate(0,height-desiredHeight);}
if(align=='none')ctx.scale(scaleX,scaleY);else if(meetOrSlice=='meet')ctx.scale(scaleMin,scaleMin);else if(meetOrSlice=='slice')ctx.scale(scaleMax,scaleMax);ctx.translate(minX==null?0:-minX,minY==null?0:-minY);};svg.Element={};svg.EmptyProperty=new svg.Property('EMPTY','');svg.Element.ElementBase=function(node){this.attributes={};this.styles={};this.stylesSpecificity={};this.children=[];this.attribute=function(name,createIfNotExists){var a=this.attributes[name];if(a!=null)return a;if(createIfNotExists==true){a=new svg.Property(name,'');this.attributes[name]=a;}
return a||svg.EmptyProperty;};this.getHrefAttribute=function(){for(var a in this.attributes){if(a=='href'||a.match(/:href$/)){return this.attributes[a];}}
return svg.EmptyProperty;};this.style=function(name,createIfNotExists,skipAncestors){var s=this.styles[name];if(s!=null)return s;var a=this.attribute(name);if(a!=null&&a.hasValue()){this.styles[name]=a;return a;}
if(skipAncestors!=true){var p=this.parent;if(p!=null){var ps=p.style(name);if(ps!=null&&ps.hasValue()){return ps;}}}
if(createIfNotExists==true){s=new svg.Property(name,'');this.styles[name]=s;}
return s||svg.EmptyProperty;};this.render=function(ctx){if(this.style('display').value=='none')return;if(this.style('visibility').value=='hidden')return;ctx.save();if(this.style('mask').hasValue()){var mask=this.style('mask').getDefinition();if(mask!=null)mask.apply(ctx,this);}else if(this.style('filter').hasValue()){var filter=this.style('filter').getDefinition();if(filter!=null)filter.apply(ctx,this);}else{this.setContext(ctx);this.renderChildren(ctx);this.clearContext(ctx);}
ctx.restore();};this.setContext=function(ctx){};this.clearContext=function(ctx){};this.renderChildren=function(ctx){for(var i=0;i<this.children.length;i++){this.children[i].render(ctx);}};this.addChild=function(childNode,create){var child=childNode;if(create)child=svg.CreateElement(childNode);child.parent=this;if(child.type!='title'){this.children.push(child);}};this.addStylesFromStyleDefinition=function(){for(var selector in svg.Styles){if(selector[0]!='@'&&matchesSelector(node,selector)){var styles=svg.Styles[selector];var specificity=svg.StylesSpecificity[selector];if(styles!=null){for(var name in styles){var existingSpecificity=this.stylesSpecificity[name];if(typeof existingSpecificity=='undefined'){existingSpecificity='000';}
if(specificity>existingSpecificity){this.styles[name]=styles[name];this.stylesSpecificity[name]=specificity;}}}}}};var allUppercase=new RegExp("^[A-Z\-]+$");var normalizeAttributeName=function(name){if(allUppercase.test(name)){return name.toLowerCase();}
return name;};if(node!=null&&node.nodeType==1){for(var i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];var nodeName=normalizeAttributeName(attribute.nodeName);this.attributes[nodeName]=new svg.Property(nodeName,attribute.value);}
this.addStylesFromStyleDefinition();if(this.attribute('style').hasValue()){var styles=this.attribute('style').value.split(';');for(var i=0;i<styles.length;i++){if(svg.trim(styles[i])!=''){var style=styles[i].split(':');var name=svg.trim(style[0]);var value=svg.trim(style[1]);this.styles[name]=new svg.Property(name,value);}}}
if(this.attribute('id').hasValue()){if(svg.Definitions[this.attribute('id').value]==null){svg.Definitions[this.attribute('id').value]=this;}}
for(var i=0;i<node.childNodes.length;i++){var childNode=node.childNodes[i];if(childNode.nodeType==1)this.addChild(childNode,true);if(this.captureTextNodes&&(childNode.nodeType==3||childNode.nodeType==4)){var text=childNode.value||childNode.text||childNode.textContent||'';if(svg.compressSpaces(text)!=''){this.addChild(new svg.Element.tspan(childNode),false);}}}}};svg.Element.RenderedElementBase=function(node){this.base=svg.Element.ElementBase;this.base(node);this.calculateOpacity=function(){var opacity=1.0;var el=this;while(el!=null){var opacityStyle=el.style('opacity',false,true);if(opacityStyle.hasValue()){opacity=opacity*opacityStyle.numValue();}
el=el.parent;}
return opacity;};this.setContext=function(ctx,fromMeasure){if(!fromMeasure){if(this.style('fill').isUrlDefinition()){var fs=this.style('fill').getFillStyleDefinition(this,this.style('fill-opacity'));if(fs!=null)ctx.fillStyle=fs;}else if(this.style('fill').hasValue()){var fillStyle=this.style('fill');if(fillStyle.value=='currentColor')fillStyle.value=this.style('color').value;if(fillStyle.value!='inherit')ctx.fillStyle=(fillStyle.value=='none'?'rgba(0,0,0,0)':fillStyle.value);}
if(this.style('fill-opacity').hasValue()){var fillStyle=new svg.Property('fill',ctx.fillStyle);fillStyle=fillStyle.addOpacity(this.style('fill-opacity'));ctx.fillStyle=fillStyle.value;}
if(this.style('stroke').isUrlDefinition()){var fs=this.style('stroke').getFillStyleDefinition(this,this.style('stroke-opacity'));if(fs!=null)ctx.strokeStyle=fs;}else if(this.style('stroke').hasValue()){var strokeStyle=this.style('stroke');if(strokeStyle.value=='currentColor')strokeStyle.value=this.style('color').value;if(strokeStyle.value!='inherit')ctx.strokeStyle=(strokeStyle.value=='none'?'rgba(0,0,0,0)':strokeStyle.value);}
if(this.style('stroke-opacity').hasValue()){var strokeStyle=new svg.Property('stroke',ctx.strokeStyle);strokeStyle=strokeStyle.addOpacity(this.style('stroke-opacity'));ctx.strokeStyle=strokeStyle.value;}
if(this.style('stroke-width').hasValue()){var newLineWidth=this.style('stroke-width').toPixels();ctx.lineWidth=newLineWidth==0?0.001:newLineWidth;}
if(this.style('stroke-linecap').hasValue())ctx.lineCap=this.style('stroke-linecap').value;if(this.style('stroke-linejoin').hasValue())ctx.lineJoin=this.style('stroke-linejoin').value;if(this.style('stroke-miterlimit').hasValue())ctx.miterLimit=this.style('stroke-miterlimit').value;if(this.style('paint-order').hasValue())ctx.paintOrder=this.style('paint-order').value;if(this.style('stroke-dasharray').hasValue()&&this.style('stroke-dasharray').value!='none'){var gaps=svg.ToNumberArray(this.style('stroke-dasharray').value);if(typeof ctx.setLineDash!='undefined'){ctx.setLineDash(gaps);}else if(typeof ctx.webkitLineDash!='undefined'){ctx.webkitLineDash=gaps;}else if(typeof ctx.mozDash!='undefined'&&!(gaps.length==1&&gaps[0]==0)){ctx.mozDash=gaps;}
var offset=this.style('stroke-dashoffset').toPixels();if(typeof ctx.lineDashOffset!='undefined'){ctx.lineDashOffset=offset;}else if(typeof ctx.webkitLineDashOffset!='undefined'){ctx.webkitLineDashOffset=offset;}else if(typeof ctx.mozDashOffset!='undefined'){ctx.mozDashOffset=offset;}}}
if(typeof ctx.font!='undefined'){ctx.font=svg.Font.CreateFont(this.style('font-style').value,this.style('font-variant').value,this.style('font-weight').value,this.style('font-size').hasValue()?this.style('font-size').toPixels()+'px':'',this.style('font-family').value).toString();var currentFontSize=this.style('font-size',false,false);if(currentFontSize.isPixels()){svg.emSize=currentFontSize.toPixels();}}
if(this.style('transform',false,true).hasValue()){var transform=new svg.Transform(this.style('transform',false,true).value);transform.apply(ctx);}
if(this.style('clip-path',false,true).hasValue()){var clip=this.style('clip-path',false,true).getDefinition();if(clip!=null)clip.apply(ctx);}
ctx.globalAlpha=this.calculateOpacity();};};svg.Element.RenderedElementBase.prototype=new svg.Element.ElementBase;svg.Element.PathElementBase=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.path=function(ctx){if(ctx!=null)ctx.beginPath();return new svg.BoundingBox();};this.renderChildren=function(ctx){this.path(ctx);svg.Mouse.checkPath(this,ctx);if(ctx.fillStyle!=''){if(this.style('fill-rule').valueOrDefault('inherit')!='inherit'){ctx.fill(this.style('fill-rule').value);}else{ctx.fill();}}
if(ctx.strokeStyle!='')ctx.stroke();var markers=this.getMarkers();if(markers!=null){if(this.style('marker-start').isUrlDefinition()){var marker=this.style('marker-start').getDefinition();marker.render(ctx,markers[0][0],markers[0][1]);}
if(this.style('marker-mid').isUrlDefinition()){var marker=this.style('marker-mid').getDefinition();for(var i=1;i<markers.length-1;i++){marker.render(ctx,markers[i][0],markers[i][1]);}}
if(this.style('marker-end').isUrlDefinition()){var marker=this.style('marker-end').getDefinition();marker.render(ctx,markers[markers.length-1][0],markers[markers.length-1][1]);}}};this.getBoundingBox=function(){return this.path();};this.getMarkers=function(){return null;};};svg.Element.PathElementBase.prototype=new svg.Element.RenderedElementBase;svg.Element.svg=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.baseClearContext=this.clearContext;this.clearContext=function(ctx){this.baseClearContext(ctx);svg.ViewPort.RemoveCurrent();};this.baseSetContext=this.setContext;this.setContext=function(ctx){ctx.strokeStyle='rgba(0,0,0,0)';ctx.lineCap='butt';ctx.lineJoin='miter';ctx.miterLimit=4;if(ctx.canvas.style&&typeof ctx.font!='undefined'&&typeof windowEnv.getComputedStyle!='undefined'){ctx.font=windowEnv.getComputedStyle(ctx.canvas).getPropertyValue('font');var fontSize=new svg.Property('fontSize',svg.Font.Parse(ctx.font).fontSize);if(fontSize.hasValue())svg.rootEmSize=svg.emSize=fontSize.toPixels('y');}
this.baseSetContext(ctx);if(!this.attribute('x').hasValue())this.attribute('x',true).value=0;if(!this.attribute('y').hasValue())this.attribute('y',true).value=0;ctx.translate(this.attribute('x').toPixels('x'),this.attribute('y').toPixels('y'));var width=svg.ViewPort.width();var height=svg.ViewPort.height();if(!this.attribute('width').hasValue())this.attribute('width',true).value='100%';if(!this.attribute('height').hasValue())this.attribute('height',true).value='100%';if(typeof this.root=='undefined'){width=this.attribute('width').toPixels('x');height=this.attribute('height').toPixels('y');var x=0;var y=0;if(this.attribute('refX').hasValue()&&this.attribute('refY').hasValue()){x=-this.attribute('refX').toPixels('x');y=-this.attribute('refY').toPixels('y');}
if(this.attribute('overflow').valueOrDefault('hidden')!='visible'){ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(width,y);ctx.lineTo(width,height);ctx.lineTo(x,height);ctx.closePath();ctx.clip();}}
svg.ViewPort.SetCurrent(width,height);if(this.attribute('viewBox').hasValue()){var viewBox=svg.ToNumberArray(this.attribute('viewBox').value);var minX=viewBox[0];var minY=viewBox[1];width=viewBox[2];height=viewBox[3];svg.AspectRatio(ctx,this.attribute('preserveAspectRatio').value,svg.ViewPort.width(),width,svg.ViewPort.height(),height,minX,minY,this.attribute('refX').value,this.attribute('refY').value);svg.ViewPort.RemoveCurrent();svg.ViewPort.SetCurrent(viewBox[2],viewBox[3]);}};};svg.Element.svg.prototype=new svg.Element.RenderedElementBase;svg.Element.rect=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.path=function(ctx){var x=this.attribute('x').toPixels('x');var y=this.attribute('y').toPixels('y');var width=this.attribute('width').toPixels('x');var height=this.attribute('height').toPixels('y');var rx=this.attribute('rx').toPixels('x');var ry=this.attribute('ry').toPixels('y');if(this.attribute('rx').hasValue()&&!this.attribute('ry').hasValue())ry=rx;if(this.attribute('ry').hasValue()&&!this.attribute('rx').hasValue())rx=ry;rx=Math.min(rx,width/2.0);ry=Math.min(ry,height/2.0);if(ctx!=null){var KAPPA=4*((Math.sqrt(2)-1)/3);ctx.beginPath();ctx.moveTo(x+rx,y);ctx.lineTo(x+width-rx,y);ctx.bezierCurveTo(x+width-rx+(KAPPA*rx),y,x+width,y+ry-(KAPPA*ry),x+width,y+ry);ctx.lineTo(x+width,y+height-ry);ctx.bezierCurveTo(x+width,y+height-ry+(KAPPA*ry),x+width-rx+(KAPPA*rx),y+height,x+width-rx,y+height);ctx.lineTo(x+rx,y+height);ctx.bezierCurveTo(x+rx-(KAPPA*rx),y+height,x,y+height-ry+(KAPPA*ry),x,y+height-ry);ctx.lineTo(x,y+ry);ctx.bezierCurveTo(x,y+ry-(KAPPA*ry),x+rx-(KAPPA*rx),y,x+rx,y);ctx.closePath();}
return new svg.BoundingBox(x,y,x+width,y+height);};};svg.Element.rect.prototype=new svg.Element.PathElementBase;svg.Element.circle=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.path=function(ctx){var cx=this.attribute('cx').toPixels('x');var cy=this.attribute('cy').toPixels('y');var r=this.attribute('r').toPixels();if(ctx!=null){ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2,false);ctx.closePath();}
return new svg.BoundingBox(cx-r,cy-r,cx+r,cy+r);};};svg.Element.circle.prototype=new svg.Element.PathElementBase;svg.Element.ellipse=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.path=function(ctx){var KAPPA=4*((Math.sqrt(2)-1)/3);var rx=this.attribute('rx').toPixels('x');var ry=this.attribute('ry').toPixels('y');var cx=this.attribute('cx').toPixels('x');var cy=this.attribute('cy').toPixels('y');if(ctx!=null){ctx.beginPath();ctx.moveTo(cx+rx,cy);ctx.bezierCurveTo(cx+rx,cy+(KAPPA*ry),cx+(KAPPA*rx),cy+ry,cx,cy+ry);ctx.bezierCurveTo(cx-(KAPPA*rx),cy+ry,cx-rx,cy+(KAPPA*ry),cx-rx,cy);ctx.bezierCurveTo(cx-rx,cy-(KAPPA*ry),cx-(KAPPA*rx),cy-ry,cx,cy-ry);ctx.bezierCurveTo(cx+(KAPPA*rx),cy-ry,cx+rx,cy-(KAPPA*ry),cx+rx,cy);ctx.closePath();}
return new svg.BoundingBox(cx-rx,cy-ry,cx+rx,cy+ry);};};svg.Element.ellipse.prototype=new svg.Element.PathElementBase;svg.Element.line=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.getPoints=function(){return[new svg.Point(this.attribute('x1').toPixels('x'),this.attribute('y1').toPixels('y')),new svg.Point(this.attribute('x2').toPixels('x'),this.attribute('y2').toPixels('y'))];};this.path=function(ctx){var points=this.getPoints();if(ctx!=null){ctx.beginPath();ctx.moveTo(points[0].x,points[0].y);ctx.lineTo(points[1].x,points[1].y);}
return new svg.BoundingBox(points[0].x,points[0].y,points[1].x,points[1].y);};this.getMarkers=function(){var points=this.getPoints();var a=points[0].angleTo(points[1]);return[[points[0],a],[points[1],a]];};};svg.Element.line.prototype=new svg.Element.PathElementBase;svg.Element.polyline=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.points=svg.CreatePath(this.attribute('points').value);this.path=function(ctx){var bb=new svg.BoundingBox(this.points[0].x,this.points[0].y);if(ctx!=null){ctx.beginPath();ctx.moveTo(this.points[0].x,this.points[0].y);}
for(var i=1;i<this.points.length;i++){bb.addPoint(this.points[i].x,this.points[i].y);if(ctx!=null)ctx.lineTo(this.points[i].x,this.points[i].y);}
return bb;};this.getMarkers=function(){var markers=[];for(var i=0;i<this.points.length-1;i++){markers.push([this.points[i],this.points[i].angleTo(this.points[i+1])]);}
if(markers.length>0){markers.push([this.points[this.points.length-1],markers[markers.length-1][1]]);}
return markers;};};svg.Element.polyline.prototype=new svg.Element.PathElementBase;svg.Element.polygon=function(node){this.base=svg.Element.polyline;this.base(node);this.basePath=this.path;this.path=function(ctx){var bb=this.basePath(ctx);if(ctx!=null){ctx.lineTo(this.points[0].x,this.points[0].y);ctx.closePath();}
return bb;};};svg.Element.polygon.prototype=new svg.Element.polyline;svg.Element.path=function(node){this.base=svg.Element.PathElementBase;this.base(node);var d=this.attribute('d').value;d=d.replace(/,/gm,' ');for(var i=0;i<2;i++)
d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,'$1 $2');d=d.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,'$1 $2');d=d.replace(/([0-9])([+\-])/gm,'$1 $2');for(var i=0;i<2;i++)
d=d.replace(/(\.[0-9]*)(\.)/gm,'$1 $2');d=d.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,'$1 $3 $4 ');d=svg.compressSpaces(d);d=svg.trim(d);this.PathParser=new(function(d){this.tokens=d.split(' ');this.reset=function(){this.i=-1;this.command='';this.previousCommand='';this.start=new svg.Point(0,0);this.control=new svg.Point(0,0);this.current=new svg.Point(0,0);this.points=[];this.angles=[];};this.isEnd=function(){return this.i>=this.tokens.length-1;};this.isCommandOrEnd=function(){if(this.isEnd())return true;return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null;};this.isRelativeCommand=function(){switch(this.command){case'm':case'l':case'h':case'v':case'c':case's':case'q':case't':case'a':case'z':return true;break;}
return false;};this.getToken=function(){this.i++;return this.tokens[this.i];};this.getScalar=function(){return parseFloat(this.getToken());};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken();};this.getPoint=function(){var p=new svg.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p);};this.getAsControlPoint=function(){var p=this.getPoint();this.control=p;return p;};this.getAsCurrentPoint=function(){var p=this.getPoint();this.current=p;return p;};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!='c'&&this.previousCommand.toLowerCase()!='s'&&this.previousCommand.toLowerCase()!='q'&&this.previousCommand.toLowerCase()!='t'){return this.current;}
var p=new svg.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return p;};this.makeAbsolute=function(p){if(this.isRelativeCommand()){p.x+=this.current.x;p.y+=this.current.y;}
return p;};this.addMarker=function(p,from,priorTo){if(priorTo!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(priorTo);}
this.addMarkerAngle(p,from==null?null:from.angleTo(p));};this.addMarkerAngle=function(p,a){this.points.push(p);this.angles.push(a);};this.getMarkerPoints=function(){return this.points;};this.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++){if(this.angles[i]==null){for(var j=i+1;j<this.angles.length;j++){if(this.angles[j]!=null){this.angles[i]=this.angles[j];break;}}}}
return this.angles;};})(d);this.path=function(ctx){var pp=this.PathParser;pp.reset();var bb=new svg.BoundingBox();if(ctx!=null)ctx.beginPath();while(!pp.isEnd()){pp.nextCommand();switch(pp.command){case'M':case'm':var p=pp.getAsCurrentPoint();pp.addMarker(p);bb.addPoint(p.x,p.y);if(ctx!=null)ctx.moveTo(p.x,p.y);pp.start=pp.current;while(!pp.isCommandOrEnd()){var p=pp.getAsCurrentPoint();pp.addMarker(p,pp.start);bb.addPoint(p.x,p.y);if(ctx!=null)ctx.lineTo(p.x,p.y);}
break;case'L':case'l':while(!pp.isCommandOrEnd()){var c=pp.current;var p=pp.getAsCurrentPoint();pp.addMarker(p,c);bb.addPoint(p.x,p.y);if(ctx!=null)ctx.lineTo(p.x,p.y);}
break;case'H':case'h':while(!pp.isCommandOrEnd()){var newP=new svg.Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current);pp.current=newP;bb.addPoint(pp.current.x,pp.current.y);if(ctx!=null)ctx.lineTo(pp.current.x,pp.current.y);}
break;case'V':case'v':while(!pp.isCommandOrEnd()){var newP=new svg.Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar());pp.addMarker(newP,pp.current);pp.current=newP;bb.addPoint(pp.current.x,pp.current.y);if(ctx!=null)ctx.lineTo(pp.current.x,pp.current.y);}
break;case'C':case'c':while(!pp.isCommandOrEnd()){var curr=pp.current;var p1=pp.getPoint();var cntrl=pp.getAsControlPoint();var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null)ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);}
break;case'S':case's':while(!pp.isCommandOrEnd()){var curr=pp.current;var p1=pp.getReflectedControlPoint();var cntrl=pp.getAsControlPoint();var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null)ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);}
break;case'Q':case'q':while(!pp.isCommandOrEnd()){var curr=pp.current;var cntrl=pp.getAsControlPoint();var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null)ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y);}
break;case'T':case't':while(!pp.isCommandOrEnd()){var curr=pp.current;var cntrl=pp.getReflectedControlPoint();pp.control=cntrl;var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null)ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y);}
break;case'A':case'a':while(!pp.isCommandOrEnd()){var curr=pp.current;var rx=pp.getScalar();var ry=pp.getScalar();var xAxisRotation=pp.getScalar()*(Math.PI/180.0);var largeArcFlag=pp.getScalar();var sweepFlag=pp.getScalar();var cp=pp.getAsCurrentPoint();var currp=new svg.Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2.0+Math.sin(xAxisRotation)*(curr.y-cp.y)/2.0,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2.0+Math.cos(xAxisRotation)*(curr.y-cp.y)/2.0);var l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);if(l>1){rx*=Math.sqrt(l);ry*=Math.sqrt(l);}
var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt(((Math.pow(rx,2)*Math.pow(ry,2))-(Math.pow(rx,2)*Math.pow(currp.y,2))-(Math.pow(ry,2)*Math.pow(currp.x,2)))/
(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));if(isNaN(s))s=0;var cpp=new svg.Point(s*rx*currp.y/ry,s*-ry*currp.x/rx);var centp=new svg.Point((curr.x+cp.x)/2.0+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2.0+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y);var m=function(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2));};var r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v))};var a=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v));};var a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]);var u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry];var v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry];var ad=a(u,v);if(r(u,v)<=-1)ad=Math.PI;if(r(u,v)>=1)ad=0;var dir=1-sweepFlag?1.0:-1.0;var ah=a1+dir*(ad/2.0);var halfWay=new svg.Point(centp.x+rx*Math.cos(ah),centp.y+ry*Math.sin(ah));pp.addMarkerAngle(halfWay,ah-dir*Math.PI/2);pp.addMarkerAngle(cp,ah-dir*Math.PI);bb.addPoint(cp.x,cp.y);if(ctx!=null){var r=rx>ry?rx:ry;var sx=rx>ry?1:rx/ry;var sy=rx>ry?ry/rx:1;ctx.translate(centp.x,centp.y);ctx.rotate(xAxisRotation);ctx.scale(sx,sy);ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag);ctx.scale(1/sx,1/sy);ctx.rotate(-xAxisRotation);ctx.translate(-centp.x,-centp.y);}}
break;case'Z':case'z':if(ctx!=null){if(bb.x1!==bb.x2&&bb.y1!==bb.y2){ctx.closePath();}}
pp.current=pp.start;}}
return bb;};this.getMarkers=function(){var points=this.PathParser.getMarkerPoints();var angles=this.PathParser.getMarkerAngles();var markers=[];for(var i=0;i<points.length;i++){markers.push([points[i],angles[i]]);}
return markers;};};svg.Element.path.prototype=new svg.Element.PathElementBase;svg.Element.pattern=function(node){this.base=svg.Element.ElementBase;this.base(node);this.createPattern=function(ctx,element){var width=this.attribute('width').toPixels('x',true);var height=this.attribute('height').toPixels('y',true);var tempSvg=new svg.Element.svg();tempSvg.attributes['viewBox']=new svg.Property('viewBox',this.attribute('viewBox').value);tempSvg.attributes['width']=new svg.Property('width',width+'px');tempSvg.attributes['height']=new svg.Property('height',height+'px');tempSvg.attributes['transform']=new svg.Property('transform',this.attribute('patternTransform').value);tempSvg.children=this.children;var c=createCanvas();c.width=width;c.height=height;var cctx=c.getContext('2d');if(this.attribute('x').hasValue()&&this.attribute('y').hasValue()){cctx.translate(this.attribute('x').toPixels('x',true),this.attribute('y').toPixels('y',true));}
for(var x=-1;x<=1;x++){for(var y=-1;y<=1;y++){cctx.save();tempSvg.attributes['x']=new svg.Property('x',x*c.width);tempSvg.attributes['y']=new svg.Property('y',y*c.height);tempSvg.render(cctx);cctx.restore();}}
var pattern=ctx.createPattern(c,'repeat');return pattern;};};svg.Element.pattern.prototype=new svg.Element.ElementBase;svg.Element.marker=function(node){this.base=svg.Element.ElementBase;this.base(node);this.baseRender=this.render;this.render=function(ctx,point,angle){if(!point){return;}
ctx.translate(point.x,point.y);if(this.attribute('orient').valueOrDefault('auto')=='auto')ctx.rotate(angle);if(this.attribute('markerUnits').valueOrDefault('strokeWidth')=='strokeWidth')ctx.scale(ctx.lineWidth,ctx.lineWidth);ctx.save();var tempSvg=new svg.Element.svg();tempSvg.attributes['viewBox']=new svg.Property('viewBox',this.attribute('viewBox').value);tempSvg.attributes['refX']=new svg.Property('refX',this.attribute('refX').value);tempSvg.attributes['refY']=new svg.Property('refY',this.attribute('refY').value);tempSvg.attributes['width']=new svg.Property('width',this.attribute('markerWidth').value);tempSvg.attributes['height']=new svg.Property('height',this.attribute('markerHeight').value);tempSvg.attributes['fill']=new svg.Property('fill',this.attribute('fill').valueOrDefault('black'));tempSvg.attributes['stroke']=new svg.Property('stroke',this.attribute('stroke').valueOrDefault('none'));tempSvg.children=this.children;tempSvg.render(ctx);ctx.restore();if(this.attribute('markerUnits').valueOrDefault('strokeWidth')=='strokeWidth')ctx.scale(1/ctx.lineWidth,1/ctx.lineWidth);if(this.attribute('orient').valueOrDefault('auto')=='auto')ctx.rotate(-angle);ctx.translate(-point.x,-point.y);};};svg.Element.marker.prototype=new svg.Element.ElementBase;svg.Element.defs=function(node){this.base=svg.Element.ElementBase;this.base(node);this.render=function(ctx){};};svg.Element.defs.prototype=new svg.Element.ElementBase;svg.Element.GradientBase=function(node){this.base=svg.Element.ElementBase;this.base(node);this.stops=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.type=='stop')this.stops.push(child);}
this.getGradient=function(){};this.gradientUnits=function(){return this.attribute('gradientUnits').valueOrDefault('objectBoundingBox');};this.attributesToInherit=['gradientUnits'];this.inheritStopContainer=function(stopsContainer){for(var i=0;i<this.attributesToInherit.length;i++){var attributeToInherit=this.attributesToInherit[i];if(!this.attribute(attributeToInherit).hasValue()&&stopsContainer.attribute(attributeToInherit).hasValue()){this.attribute(attributeToInherit,true).value=stopsContainer.attribute(attributeToInherit).value;}}};this.createGradient=function(ctx,element,parentOpacityProp){var stopsContainer=this;if(this.getHrefAttribute().hasValue()){stopsContainer=this.getHrefAttribute().getDefinition();this.inheritStopContainer(stopsContainer);}
var addParentOpacity=function(color){if(parentOpacityProp.hasValue()){var p=new svg.Property('color',color);return p.addOpacity(parentOpacityProp).value;}
return color;};var g=this.getGradient(ctx,element);if(g==null)return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length-1].color);for(var i=0;i<stopsContainer.stops.length;i++){g.addColorStop(stopsContainer.stops[i].offset,addParentOpacity(stopsContainer.stops[i].color));}
if(this.attribute('gradientTransform').hasValue()){var rootView=svg.ViewPort.viewPorts[0];var rect=new svg.Element.rect();rect.attributes['x']=new svg.Property('x',-svg.MAX_VIRTUAL_PIXELS/3.0);rect.attributes['y']=new svg.Property('y',-svg.MAX_VIRTUAL_PIXELS/3.0);rect.attributes['width']=new svg.Property('width',svg.MAX_VIRTUAL_PIXELS);rect.attributes['height']=new svg.Property('height',svg.MAX_VIRTUAL_PIXELS);var group=new svg.Element.g();group.attributes['transform']=new svg.Property('transform',this.attribute('gradientTransform').value);group.children=[rect];var tempSvg=new svg.Element.svg();tempSvg.attributes['x']=new svg.Property('x',0);tempSvg.attributes['y']=new svg.Property('y',0);tempSvg.attributes['width']=new svg.Property('width',rootView.width);tempSvg.attributes['height']=new svg.Property('height',rootView.height);tempSvg.children=[group];var c=createCanvas();c.width=rootView.width;c.height=rootView.height;var tempCtx=c.getContext('2d');tempCtx.fillStyle=g;tempSvg.render(tempCtx);return tempCtx.createPattern(c,'no-repeat');}
return g;};};svg.Element.GradientBase.prototype=new svg.Element.ElementBase;svg.Element.linearGradient=function(node){this.base=svg.Element.GradientBase;this.base(node);this.attributesToInherit.push('x1');this.attributesToInherit.push('y1');this.attributesToInherit.push('x2');this.attributesToInherit.push('y2');this.getGradient=function(ctx,element){var bb=this.gradientUnits()=='objectBoundingBox'?element.getBoundingBox(ctx):null;if(!this.attribute('x1').hasValue()&&!this.attribute('y1').hasValue()&&!this.attribute('x2').hasValue()&&!this.attribute('y2').hasValue()){this.attribute('x1',true).value=0;this.attribute('y1',true).value=0;this.attribute('x2',true).value=1;this.attribute('y2',true).value=0;}
var x1=(this.gradientUnits()=='objectBoundingBox'?bb.x()+bb.width()*this.attribute('x1').numValue():this.attribute('x1').toPixels('x'));var y1=(this.gradientUnits()=='objectBoundingBox'?bb.y()+bb.height()*this.attribute('y1').numValue():this.attribute('y1').toPixels('y'));var x2=(this.gradientUnits()=='objectBoundingBox'?bb.x()+bb.width()*this.attribute('x2').numValue():this.attribute('x2').toPixels('x'));var y2=(this.gradientUnits()=='objectBoundingBox'?bb.y()+bb.height()*this.attribute('y2').numValue():this.attribute('y2').toPixels('y'));if(x1==x2&&y1==y2)return null;return ctx.createLinearGradient(x1,y1,x2,y2);};};svg.Element.linearGradient.prototype=new svg.Element.GradientBase;svg.Element.radialGradient=function(node){this.base=svg.Element.GradientBase;this.base(node);this.attributesToInherit.push('cx');this.attributesToInherit.push('cy');this.attributesToInherit.push('r');this.attributesToInherit.push('fx');this.attributesToInherit.push('fy');this.getGradient=function(ctx,element){var bb=element.getBoundingBox(ctx);if(!this.attribute('cx').hasValue())this.attribute('cx',true).value='50%';if(!this.attribute('cy').hasValue())this.attribute('cy',true).value='50%';if(!this.attribute('r').hasValue())this.attribute('r',true).value='50%';var cx=(this.gradientUnits()=='objectBoundingBox'?bb.x()+bb.width()*this.attribute('cx').numValue():this.attribute('cx').toPixels('x'));var cy=(this.gradientUnits()=='objectBoundingBox'?bb.y()+bb.height()*this.attribute('cy').numValue():this.attribute('cy').toPixels('y'));var fx=cx;var fy=cy;if(this.attribute('fx').hasValue()){fx=(this.gradientUnits()=='objectBoundingBox'?bb.x()+bb.width()*this.attribute('fx').numValue():this.attribute('fx').toPixels('x'));}
if(this.attribute('fy').hasValue()){fy=(this.gradientUnits()=='objectBoundingBox'?bb.y()+bb.height()*this.attribute('fy').numValue():this.attribute('fy').toPixels('y'));}
var r=(this.gradientUnits()=='objectBoundingBox'?(bb.width()+bb.height())/2.0*this.attribute('r').numValue():this.attribute('r').toPixels());return ctx.createRadialGradient(fx,fy,0,cx,cy,r);};};svg.Element.radialGradient.prototype=new svg.Element.GradientBase;svg.Element.stop=function(node){this.base=svg.Element.ElementBase;this.base(node);this.offset=this.attribute('offset').numValue();if(this.offset<0)this.offset=0;if(this.offset>1)this.offset=1;var stopColor=this.style('stop-color',true);if(stopColor.value==='')stopColor.value='#000';if(this.style('stop-opacity').hasValue())stopColor=stopColor.addOpacity(this.style('stop-opacity'));this.color=stopColor.value;};svg.Element.stop.prototype=new svg.Element.ElementBase;svg.Element.AnimateBase=function(node){this.base=svg.Element.ElementBase;this.base(node);svg.Animations.push(this);this.duration=0.0;this.begin=this.attribute('begin').toMilliseconds();this.maxDuration=this.begin+this.attribute('dur').toMilliseconds();this.getProperty=function(){var attributeType=this.attribute('attributeType').value;var attributeName=this.attribute('attributeName').value;if(attributeType=='CSS'){return this.parent.style(attributeName,true);}
return this.parent.attribute(attributeName,true);};this.initialValue=null;this.initialUnits='';this.removed=false;this.calcValue=function(){return'';};this.update=function(delta){if(this.initialValue==null){this.initialValue=this.getProperty().value;this.initialUnits=this.getProperty().getUnits();}
if(this.duration>this.maxDuration){if(this.attribute('repeatCount').value=='indefinite'||this.attribute('repeatDur').value=='indefinite'){this.duration=0.0;}else if(this.attribute('fill').valueOrDefault('remove')=='freeze'&&!this.frozen){this.frozen=true;this.parent.animationFrozen=true;this.parent.animationFrozenValue=this.getProperty().value;}else if(this.attribute('fill').valueOrDefault('remove')=='remove'&&!this.removed){this.removed=true;this.getProperty().value=this.parent.animationFrozen?this.parent.animationFrozenValue:this.initialValue;return true;}
return false;}
this.duration=this.duration+delta;var updated=false;if(this.begin<this.duration){var newValue=this.calcValue();if(this.attribute('type').hasValue()){var type=this.attribute('type').value;newValue=type+'('+newValue+')';}
this.getProperty().value=newValue;updated=true;}
return updated;};this.from=this.attribute('from');this.to=this.attribute('to');this.values=this.attribute('values');if(this.values.hasValue())this.values.value=this.values.value.split(';');this.progress=function(){var ret={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var p=ret.progress*(this.values.value.length-1);var lb=Math.floor(p),ub=Math.ceil(p);ret.from=new svg.Property('from',parseFloat(this.values.value[lb]));ret.to=new svg.Property('to',parseFloat(this.values.value[ub]));ret.progress=(p-lb)/(ub-lb);}else{ret.from=this.from;ret.to=this.to;}
return ret;};};svg.Element.AnimateBase.prototype=new svg.Element.ElementBase;svg.Element.animate=function(node){this.base=svg.Element.AnimateBase;this.base(node);this.calcValue=function(){var p=this.progress();var newValue=p.from.numValue()+(p.to.numValue()-p.from.numValue())*p.progress;return newValue+this.initialUnits;};};svg.Element.animate.prototype=new svg.Element.AnimateBase;svg.Element.animateColor=function(node){this.base=svg.Element.AnimateBase;this.base(node);this.calcValue=function(){var p=this.progress();var from=new rgbcolor(p.from.value);var to=new rgbcolor(p.to.value);if(from.ok&&to.ok){var r=from.r+(to.r-from.r)*p.progress;var g=from.g+(to.g-from.g)*p.progress;var b=from.b+(to.b-from.b)*p.progress;return'rgb('+parseInt(r,10)+','+parseInt(g,10)+','+parseInt(b,10)+')';}
return this.attribute('from').value;};};svg.Element.animateColor.prototype=new svg.Element.AnimateBase;svg.Element.animateTransform=function(node){this.base=svg.Element.AnimateBase;this.base(node);this.calcValue=function(){var p=this.progress();var from=svg.ToNumberArray(p.from.value);var to=svg.ToNumberArray(p.to.value);var newValue='';for(var i=0;i<from.length;i++){newValue+=from[i]+(to[i]-from[i])*p.progress+' ';}
return newValue;};};svg.Element.animateTransform.prototype=new svg.Element.animate;svg.Element.font=function(node){this.base=svg.Element.ElementBase;this.base(node);this.horizAdvX=this.attribute('horiz-adv-x').numValue();this.isRTL=false;this.isArabic=false;this.fontFace=null;this.missingGlyph=null;this.glyphs=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.type=='font-face'){this.fontFace=child;if(child.style('font-family').hasValue()){svg.Definitions[child.style('font-family').value]=this;}}else if(child.type=='missing-glyph')this.missingGlyph=child;else if(child.type=='glyph'){if(child.arabicForm!=''){this.isRTL=true;this.isArabic=true;if(typeof this.glyphs[child.unicode]=='undefined')this.glyphs[child.unicode]=[];this.glyphs[child.unicode][child.arabicForm]=child;}else{this.glyphs[child.unicode]=child;}}}};svg.Element.font.prototype=new svg.Element.ElementBase;svg.Element.fontface=function(node){this.base=svg.Element.ElementBase;this.base(node);this.ascent=this.attribute('ascent').value;this.descent=this.attribute('descent').value;this.unitsPerEm=this.attribute('units-per-em').numValue();};svg.Element.fontface.prototype=new svg.Element.ElementBase;svg.Element.missingglyph=function(node){this.base=svg.Element.path;this.base(node);this.horizAdvX=0;};svg.Element.missingglyph.prototype=new svg.Element.path;svg.Element.glyph=function(node){this.base=svg.Element.path;this.base(node);this.horizAdvX=this.attribute('horiz-adv-x').numValue();this.unicode=this.attribute('unicode').value;this.arabicForm=this.attribute('arabic-form').value;};svg.Element.glyph.prototype=new svg.Element.path;svg.Element.text=function(node){this.captureTextNodes=true;this.base=svg.Element.RenderedElementBase;this.base(node);this.baseSetContext=this.setContext;this.setContext=function(ctx){this.baseSetContext(ctx);var textBaseline=this.style('dominant-baseline').toTextBaseline();if(textBaseline==null)textBaseline=this.style('alignment-baseline').toTextBaseline();if(textBaseline!=null)ctx.textBaseline=textBaseline;};this.initializeCoordinates=function(ctx){this.x=this.attribute('x').toPixels('x');this.y=this.attribute('y').toPixels('y');if(this.attribute('dx').hasValue())this.x+=this.attribute('dx').toPixels('x');if(this.attribute('dy').hasValue())this.y+=this.attribute('dy').toPixels('y');this.x+=this.getAnchorDelta(ctx,this,0);};this.getBoundingBox=function(ctx){this.initializeCoordinates(ctx);var bb=null;for(var i=0;i<this.children.length;i++){var childBB=this.getChildBoundingBox(ctx,this,this,i);if(bb==null)bb=childBB;else bb.addBoundingBox(childBB);}
return bb;};this.renderChildren=function(ctx){this.initializeCoordinates(ctx);for(var i=0;i<this.children.length;i++){this.renderChild(ctx,this,this,i);}};this.getAnchorDelta=function(ctx,parent,startI){var textAnchor=this.style('text-anchor').valueOrDefault('start');if(textAnchor!='start'){var width=0;for(var i=startI;i<parent.children.length;i++){var child=parent.children[i];if(i>startI&&child.attribute('x').hasValue())break;width+=child.measureTextRecursive(ctx);}
return-1*(textAnchor=='end'?width:width/2.0);}
return 0;};this.adjustChildCoordinates=function(ctx,textParent,parent,i){var child=parent.children[i];if(child.attribute('x').hasValue()){child.x=child.attribute('x').toPixels('x')+textParent.getAnchorDelta(ctx,parent,i);if(child.attribute('dx').hasValue())child.x+=child.attribute('dx').toPixels('x');}else{if(child.attribute('dx').hasValue())textParent.x+=child.attribute('dx').toPixels('x');child.x=textParent.x;}
textParent.x=child.x+child.measureText(ctx);if(child.attribute('y').hasValue()){child.y=child.attribute('y').toPixels('y');if(child.attribute('dy').hasValue())child.y+=child.attribute('dy').toPixels('y');}else{if(child.attribute('dy').hasValue())textParent.y+=child.attribute('dy').toPixels('y');child.y=textParent.y;}
textParent.y=child.y;return child;};this.getChildBoundingBox=function(ctx,textParent,parent,i){var child=this.adjustChildCoordinates(ctx,textParent,parent,i);var bb=child.getBoundingBox(ctx);for(var i=0;i<child.children.length;i++){var childBB=textParent.getChildBoundingBox(ctx,textParent,child,i);bb.addBoundingBox(childBB);}
return bb;};this.renderChild=function(ctx,textParent,parent,i){var child=this.adjustChildCoordinates(ctx,textParent,parent,i);child.render(ctx);for(var i=0;i<child.children.length;i++){textParent.renderChild(ctx,textParent,child,i);}};};svg.Element.text.prototype=new svg.Element.RenderedElementBase;svg.Element.TextElementBase=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.getGlyph=function(font,text,i){var c=text[i];var glyph=null;if(font.isArabic){var arabicForm='isolated';if((i==0||text[i-1]==' ')&&i<text.length-2&&text[i+1]!=' ')arabicForm='terminal';if(i>0&&text[i-1]!=' '&&i<text.length-2&&text[i+1]!=' ')arabicForm='medial';if(i>0&&text[i-1]!=' '&&(i==text.length-1||text[i+1]==' '))arabicForm='initial';if(typeof font.glyphs[c]!='undefined'){glyph=font.glyphs[c][arabicForm];if(glyph==null&&font.glyphs[c].type=='glyph')glyph=font.glyphs[c];}}else{glyph=font.glyphs[c];}
if(glyph==null)glyph=font.missingGlyph;return glyph;};this.renderChildren=function(ctx){var customFont=this.parent.style('font-family').getDefinition();if(customFont!=null){var fontSize=this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);var fontStyle=this.parent.style('font-style').valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle);var text=this.getText();if(customFont.isRTL)text=text.split("").reverse().join("");var dx=svg.ToNumberArray(this.parent.attribute('dx').value);for(var i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i);var scale=fontSize/customFont.fontFace.unitsPerEm;ctx.translate(this.x,this.y);ctx.scale(scale,-scale);var lw=ctx.lineWidth;ctx.lineWidth=ctx.lineWidth*customFont.fontFace.unitsPerEm/fontSize;if(fontStyle=='italic')ctx.transform(1,0,.4,1,0,0);glyph.render(ctx);if(fontStyle=='italic')ctx.transform(1,0,-.4,1,0,0);ctx.lineWidth=lw;ctx.scale(1/scale,-1/scale);ctx.translate(-this.x,-this.y);this.x+=fontSize*(glyph.horizAdvX||customFont.horizAdvX)/customFont.fontFace.unitsPerEm;if(typeof dx[i]!='undefined'&&!isNaN(dx[i])){this.x+=dx[i];}}
return;}
if(ctx.paintOrder=="stroke"){if(ctx.strokeStyle!='')ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y);if(ctx.fillStyle!='')ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y);}else{if(ctx.fillStyle!='')ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y);if(ctx.strokeStyle!='')ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y);}};this.getText=function(){};this.measureTextRecursive=function(ctx){var width=this.measureText(ctx);for(var i=0;i<this.children.length;i++){width+=this.children[i].measureTextRecursive(ctx);}
return width;};this.measureText=function(ctx){var customFont=this.parent.style('font-family').getDefinition();if(customFont!=null){var fontSize=this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);var measure=0;var text=this.getText();if(customFont.isRTL)text=text.split("").reverse().join("");var dx=svg.ToNumberArray(this.parent.attribute('dx').value);for(var i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i);measure+=(glyph.horizAdvX||customFont.horizAdvX)*fontSize/customFont.fontFace.unitsPerEm;if(typeof dx[i]!='undefined'&&!isNaN(dx[i])){measure+=dx[i];}}
return measure;}
var textToMeasure=svg.compressSpaces(this.getText());if(!ctx.measureText)return textToMeasure.length*10;ctx.save();this.setContext(ctx,true);var width=ctx.measureText(textToMeasure).width;ctx.restore();return width;};this.getBoundingBox=function(ctx){var fontSize=this.parent.style('font-size').numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);return new svg.BoundingBox(this.x,this.y-fontSize,this.x+this.measureText(ctx),this.y);};};svg.Element.TextElementBase.prototype=new svg.Element.RenderedElementBase;svg.Element.tspan=function(node){this.captureTextNodes=true;this.base=svg.Element.TextElementBase;this.base(node);this.text=svg.compressSpaces(node.value||node.text||node.textContent||'');this.getText=function(){if(this.children.length>0){return'';}
return this.text;};};svg.Element.tspan.prototype=new svg.Element.TextElementBase;svg.Element.tref=function(node){this.base=svg.Element.TextElementBase;this.base(node);this.getText=function(){var element=this.getHrefAttribute().getDefinition();if(element!=null)return element.children[0].getText();};};svg.Element.tref.prototype=new svg.Element.TextElementBase;svg.Element.a=function(node){this.base=svg.Element.TextElementBase;this.base(node);this.hasText=node.childNodes.length>0;for(var i=0;i<node.childNodes.length;i++){if(node.childNodes[i].nodeType!=3)this.hasText=false;}
this.text=this.hasText?node.childNodes[0].value||node.childNodes[0].data:'';this.getText=function(){return this.text;};this.baseRenderChildren=this.renderChildren;this.renderChildren=function(ctx){if(this.hasText){this.baseRenderChildren(ctx);var fontSize=new svg.Property('fontSize',svg.Font.Parse(svg.ctx.font).fontSize);svg.Mouse.checkBoundingBox(this,new svg.BoundingBox(this.x,this.y-fontSize.toPixels('y'),this.x+this.measureText(ctx),this.y));}else if(this.children.length>0){var g=new svg.Element.g();g.children=this.children;g.parent=this;g.render(ctx);}};this.onclick=function(){windowEnv.open(this.getHrefAttribute().value);};this.onmousemove=function(){svg.ctx.canvas.style.cursor='pointer';};};svg.Element.a.prototype=new svg.Element.TextElementBase;svg.Element.image=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);var href=this.getHrefAttribute().value;if(href==''){return;}
var isSvg=href.match(/\.svg$/);svg.Images.push(this);this.loaded=false;if(!isSvg){this.img=document.createElement('img');if(svg.opts['useCORS']==true){this.img.crossOrigin='Anonymous';}
var self=this;this.img.onload=function(){self.loaded=true;};this.img.onerror=function(){svg.log('ERROR: image "'+href+'" not found');self.loaded=true;};this.img.src=href;}else{this.img=svg.ajax(href);this.loaded=true;}
this.renderChildren=function(ctx){var x=this.attribute('x').toPixels('x');var y=this.attribute('y').toPixels('y');var width=this.attribute('width').toPixels('x');var height=this.attribute('height').toPixels('y');if(width==0||height==0)return;ctx.save();if(isSvg){ctx.drawSvg(this.img,x,y,width,height);}else{ctx.translate(x,y);svg.AspectRatio(ctx,this.attribute('preserveAspectRatio').value,width,this.img.width,height,this.img.height,0,0);if(self.loaded){if(this.img.complete===undefined||this.img.complete){ctx.drawImage(this.img,0,0);}}}
ctx.restore();};this.getBoundingBox=function(){var x=this.attribute('x').toPixels('x');var y=this.attribute('y').toPixels('y');var width=this.attribute('width').toPixels('x');var height=this.attribute('height').toPixels('y');return new svg.BoundingBox(x,y,x+width,y+height);};};svg.Element.image.prototype=new svg.Element.RenderedElementBase;svg.Element.g=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.getBoundingBox=function(ctx){var bb=new svg.BoundingBox();for(var i=0;i<this.children.length;i++){bb.addBoundingBox(this.children[i].getBoundingBox(ctx));}
return bb;};};svg.Element.g.prototype=new svg.Element.RenderedElementBase;svg.Element.symbol=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.render=function(ctx){};};svg.Element.symbol.prototype=new svg.Element.RenderedElementBase;svg.Element.style=function(node){this.base=svg.Element.ElementBase;this.base(node);var css='';for(var i=0;i<node.childNodes.length;i++){css+=node.childNodes[i].data;}
css=css.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,'');css=svg.compressSpaces(css);var cssDefs=css.split('}');for(var i=0;i<cssDefs.length;i++){if(svg.trim(cssDefs[i])!=''){var cssDef=cssDefs[i].split('{');var cssClasses=cssDef[0].split(',');var cssProps=cssDef[1].split(';');for(var j=0;j<cssClasses.length;j++){var cssClass=svg.trim(cssClasses[j]);if(cssClass!=''){var props=svg.Styles[cssClass]||{};for(var k=0;k<cssProps.length;k++){var prop=cssProps[k].indexOf(':');var name=cssProps[k].substr(0,prop);var value=cssProps[k].substr(prop+1,cssProps[k].length-prop);if(name!=null&&value!=null){props[svg.trim(name)]=new svg.Property(svg.trim(name),svg.trim(value));}}
svg.Styles[cssClass]=props;svg.StylesSpecificity[cssClass]=getSelectorSpecificity(cssClass);if(cssClass=='@font-face'&&!nodeEnv){var fontFamily=props['font-family'].value.replace(/"/g,'');var srcs=props['src'].value.split(',');for(var s=0;s<srcs.length;s++){if(srcs[s].indexOf('format("svg")')>0){var urlStart=srcs[s].indexOf('url');var urlEnd=srcs[s].indexOf(')',urlStart);var url=srcs[s].substr(urlStart+5,urlEnd-urlStart-6);var doc=svg.parseXml(svg.ajax(url));var fonts=doc.getElementsByTagName('font');for(var f=0;f<fonts.length;f++){var font=svg.CreateElement(fonts[f]);svg.Definitions[fontFamily]=font;}}}}}}}}};svg.Element.style.prototype=new svg.Element.ElementBase;svg.Element.use=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.baseSetContext=this.setContext;this.setContext=function(ctx){this.baseSetContext(ctx);if(this.attribute('x').hasValue())ctx.translate(this.attribute('x').toPixels('x'),0);if(this.attribute('y').hasValue())ctx.translate(0,this.attribute('y').toPixels('y'));};var element=this.getHrefAttribute().getDefinition();this.path=function(ctx){if(element!=null)element.path(ctx);};this.elementTransform=function(){if(element!=null&&element.style('transform',false,true).hasValue()){return new svg.Transform(element.style('transform',false,true).value);}};this.getBoundingBox=function(ctx){if(element!=null)return element.getBoundingBox(ctx);};this.renderChildren=function(ctx){if(element!=null){var tempSvg=element;if(element.type=='symbol'){tempSvg=new svg.Element.svg();tempSvg.type='svg';tempSvg.attributes['viewBox']=new svg.Property('viewBox',element.attribute('viewBox').value);tempSvg.attributes['preserveAspectRatio']=new svg.Property('preserveAspectRatio',element.attribute('preserveAspectRatio').value);tempSvg.attributes['overflow']=new svg.Property('overflow',element.attribute('overflow').value);tempSvg.children=element.children;}
if(tempSvg.type=='svg'){if(this.attribute('width').hasValue())tempSvg.attributes['width']=new svg.Property('width',this.attribute('width').value);if(this.attribute('height').hasValue())tempSvg.attributes['height']=new svg.Property('height',this.attribute('height').value);}
var oldParent=tempSvg.parent;tempSvg.parent=null;tempSvg.render(ctx);tempSvg.parent=oldParent;}};};svg.Element.use.prototype=new svg.Element.RenderedElementBase;svg.Element.mask=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,element){var x=this.attribute('x').toPixels('x');var y=this.attribute('y').toPixels('y');var width=this.attribute('width').toPixels('x');var height=this.attribute('height').toPixels('y');if(width==0&&height==0){var bb=new svg.BoundingBox();for(var i=0;i<this.children.length;i++){bb.addBoundingBox(this.children[i].getBoundingBox(ctx));}
var x=Math.floor(bb.x1);var y=Math.floor(bb.y1);var width=Math.floor(bb.width());var height=Math.floor(bb.height());}
var mask=element.attribute('mask').value;element.attribute('mask').value='';var cMask=createCanvas();cMask.width=x+width;cMask.height=y+height;var maskCtx=cMask.getContext('2d');this.renderChildren(maskCtx);var c=createCanvas();c.width=x+width;c.height=y+height;var tempCtx=c.getContext('2d');element.render(tempCtx);tempCtx.globalCompositeOperation='destination-in';tempCtx.fillStyle=maskCtx.createPattern(cMask,'no-repeat');tempCtx.fillRect(0,0,x+width,y+height);ctx.fillStyle=tempCtx.createPattern(c,'no-repeat');ctx.fillRect(0,0,x+width,y+height);element.attribute('mask').value=mask;};this.render=function(ctx){};};svg.Element.mask.prototype=new svg.Element.ElementBase;svg.Element.clipPath=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx){var hasContext2D=(typeof CanvasRenderingContext2D!=='undefined');var oldBeginPath=ctx.beginPath;var oldClosePath=ctx.closePath;if(hasContext2D){CanvasRenderingContext2D.prototype.beginPath=function(){};CanvasRenderingContext2D.prototype.closePath=function(){};}
oldBeginPath.call(ctx);for(var i=0;i<this.children.length;i++){var child=this.children[i];if(typeof child.path!='undefined'){var transform=typeof child.elementTransform!='undefined'&&child.elementTransform();if(!transform&&child.style('transform',false,true).hasValue()){transform=new svg.Transform(child.style('transform',false,true).value);}
if(transform){transform.apply(ctx);}
child.path(ctx);if(hasContext2D){CanvasRenderingContext2D.prototype.closePath=oldClosePath;}
if(transform){transform.unapply(ctx);}}}
oldClosePath.call(ctx);ctx.clip();if(hasContext2D){CanvasRenderingContext2D.prototype.beginPath=oldBeginPath;CanvasRenderingContext2D.prototype.closePath=oldClosePath;}};this.render=function(ctx){};};svg.Element.clipPath.prototype=new svg.Element.ElementBase;svg.Element.filter=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,element){var bb=element.getBoundingBox(ctx);var x=Math.floor(bb.x1);var y=Math.floor(bb.y1);var width=Math.floor(bb.width());var height=Math.floor(bb.height());var filter=element.style('filter').value;element.style('filter').value='';var px=0,py=0;for(var i=0;i<this.children.length;i++){var efd=this.children[i].extraFilterDistance||0;px=Math.max(px,efd);py=Math.max(py,efd);}
var c=createCanvas();c.width=width+2*px;c.height=height+2*py;var tempCtx=c.getContext('2d');tempCtx.translate(-x+px,-y+py);element.render(tempCtx);for(var i=0;i<this.children.length;i++){if(typeof this.children[i].apply=='function'){this.children[i].apply(tempCtx,0,0,width+2*px,height+2*py);}}
ctx.drawImage(c,0,0,width+2*px,height+2*py,x-px,y-py,width+2*px,height+2*py);element.style('filter',true).value=filter;};this.render=function(ctx){};};svg.Element.filter.prototype=new svg.Element.ElementBase;svg.Element.feMorphology=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,x,y,width,height){};};svg.Element.feMorphology.prototype=new svg.Element.ElementBase;svg.Element.feComposite=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,x,y,width,height){};};svg.Element.feComposite.prototype=new svg.Element.ElementBase;svg.Element.feColorMatrix=function(node){this.base=svg.Element.ElementBase;this.base(node);var matrix=svg.ToNumberArray(this.attribute('values').value);switch(this.attribute('type').valueOrDefault('matrix')){case'saturate':var s=matrix[0];matrix=[0.213+0.787*s,0.715-0.715*s,0.072-0.072*s,0,0,0.213-0.213*s,0.715+0.285*s,0.072-0.072*s,0,0,0.213-0.213*s,0.715-0.715*s,0.072+0.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break;case'hueRotate':var a=matrix[0]*Math.PI/180.0;var c=function(m1,m2,m3){return m1+Math.cos(a)*m2+Math.sin(a)*m3;};matrix=[c(0.213,0.787,-0.213),c(0.715,-0.715,-0.715),c(0.072,-0.072,0.928),0,0,c(0.213,-0.213,0.143),c(0.715,0.285,0.140),c(0.072,-0.072,-0.283),0,0,c(0.213,-0.213,-0.787),c(0.715,-0.715,0.715),c(0.072,0.928,0.072),0,0,0,0,0,1,0,0,0,0,0,1];break;case'luminanceToAlpha':matrix=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.2125,0.7154,0.0721,0,0,0,0,0,0,1];break;}
function imGet(img,x,y,width,height,rgba){return img[y*width*4+x*4+rgba];}
function imSet(img,x,y,width,height,rgba,val){img[y*width*4+x*4+rgba]=val;}
function m(i,v){var mi=matrix[i];return mi*(mi<0?v-255:v);}
this.apply=function(ctx,x,y,width,height){var srcData=ctx.getImageData(0,0,width,height);for(var y=0;y<height;y++){for(var x=0;x<width;x++){var r=imGet(srcData.data,x,y,width,height,0);var g=imGet(srcData.data,x,y,width,height,1);var b=imGet(srcData.data,x,y,width,height,2);var a=imGet(srcData.data,x,y,width,height,3);imSet(srcData.data,x,y,width,height,0,m(0,r)+m(1,g)+m(2,b)+m(3,a)+m(4,1));imSet(srcData.data,x,y,width,height,1,m(5,r)+m(6,g)+m(7,b)+m(8,a)+m(9,1));imSet(srcData.data,x,y,width,height,2,m(10,r)+m(11,g)+m(12,b)+m(13,a)+m(14,1));imSet(srcData.data,x,y,width,height,3,m(15,r)+m(16,g)+m(17,b)+m(18,a)+m(19,1));}}
ctx.clearRect(0,0,width,height);ctx.putImageData(srcData,0,0);};};svg.Element.feColorMatrix.prototype=new svg.Element.ElementBase;svg.Element.feGaussianBlur=function(node){this.base=svg.Element.ElementBase;this.base(node);this.blurRadius=Math.floor(this.attribute('stdDeviation').numValue());this.extraFilterDistance=this.blurRadius;this.apply=function(ctx,x,y,width,height){if(!stackblurCanvas||typeof stackblurCanvas.canvasRGBA==='undefined'){svg.log('ERROR: StackBlur.js must be included for blur to work');return;}
ctx.canvas.id=svg.UniqueId();{ctx.canvas.style.display='none';document.body.appendChild(ctx.canvas);}
stackblurCanvas.canvasRGBA(ctx.canvas,x,y,width,height,this.blurRadius);{document.body.removeChild(ctx.canvas);}};};svg.Element.feGaussianBlur.prototype=new svg.Element.ElementBase;svg.Element.title=function(node){};svg.Element.title.prototype=new svg.Element.ElementBase;svg.Element.desc=function(node){};svg.Element.desc.prototype=new svg.Element.ElementBase;svg.Element.MISSING=function(node){svg.log('ERROR: Element \''+node.nodeName+'\' not yet implemented.');};svg.Element.MISSING.prototype=new svg.Element.ElementBase;svg.CreateElement=function(node){var className=node.nodeName.replace(/^[^:]+:/,'');className=className.replace(/\-/g,'');var e=null;if(typeof svg.Element[className]!='undefined'){e=new svg.Element[className](node);}else{e=new svg.Element.MISSING(node);}
e.type=node.nodeName;return e;};svg.load=function(ctx,url){svg.loadXml(ctx,svg.ajax(url));};svg.loadXml=function(ctx,xml){svg.loadXmlDoc(ctx,svg.parseXml(xml));};svg.loadXmlDoc=function(ctx,dom){svg.init(ctx);var mapXY=function(p){var e=ctx.canvas;while(e){p.x-=e.offsetLeft;p.y-=e.offsetTop;e=e.offsetParent;}
if(windowEnv.scrollX)p.x+=windowEnv.scrollX;if(windowEnv.scrollY)p.y+=windowEnv.scrollY;return p;};if(svg.opts['ignoreMouse']!=true){ctx.canvas.onclick=function(e){var p=mapXY(new svg.Point(e!=null?e.clientX:event.clientX,e!=null?e.clientY:event.clientY));svg.Mouse.onclick(p.x,p.y);};ctx.canvas.onmousemove=function(e){var p=mapXY(new svg.Point(e!=null?e.clientX:event.clientX,e!=null?e.clientY:event.clientY));svg.Mouse.onmousemove(p.x,p.y);};}
var e=svg.CreateElement(dom.documentElement);e.root=true;e.addStylesFromStyleDefinition();var isFirstRender=true;var draw=function(){svg.ViewPort.Clear();if(ctx.canvas.parentNode){svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth,ctx.canvas.parentNode.clientHeight);}else{svg.ViewPort.SetCurrent(defaultClientWidth,defaultClientHeight);}
if(svg.opts['ignoreDimensions']!=true){if(e.style('width').hasValue()){ctx.canvas.width=e.style('width').toPixels('x');if(ctx.canvas.style){ctx.canvas.style.width=ctx.canvas.width+'px';}}
if(e.style('height').hasValue()){ctx.canvas.height=e.style('height').toPixels('y');if(ctx.canvas.style){ctx.canvas.style.height=ctx.canvas.height+'px';}}}
var cWidth=ctx.canvas.clientWidth||ctx.canvas.width;var cHeight=ctx.canvas.clientHeight||ctx.canvas.height;if(svg.opts['ignoreDimensions']==true&&e.style('width').hasValue()&&e.style('height').hasValue()){cWidth=e.style('width').toPixels('x');cHeight=e.style('height').toPixels('y');}
svg.ViewPort.SetCurrent(cWidth,cHeight);if(svg.opts['offsetX']!=null)e.attribute('x',true).value=svg.opts['offsetX'];if(svg.opts['offsetY']!=null)e.attribute('y',true).value=svg.opts['offsetY'];if(svg.opts['scaleWidth']!=null||svg.opts['scaleHeight']!=null){var xRatio=null,yRatio=null,viewBox=svg.ToNumberArray(e.attribute('viewBox').value);if(svg.opts['scaleWidth']!=null){if(e.attribute('width').hasValue())xRatio=e.attribute('width').toPixels('x')/svg.opts['scaleWidth'];else if(!isNaN(viewBox[2]))xRatio=viewBox[2]/svg.opts['scaleWidth'];}
if(svg.opts['scaleHeight']!=null){if(e.attribute('height').hasValue())yRatio=e.attribute('height').toPixels('y')/svg.opts['scaleHeight'];else if(!isNaN(viewBox[3]))yRatio=viewBox[3]/svg.opts['scaleHeight'];}
if(xRatio==null){xRatio=yRatio;}
if(yRatio==null){yRatio=xRatio;}
e.attribute('width',true).value=svg.opts['scaleWidth'];e.attribute('height',true).value=svg.opts['scaleHeight'];e.style('transform',true,true).value+=' scale('+(1.0/xRatio)+','+(1.0/yRatio)+')';}
if(svg.opts['ignoreClear']!=true){ctx.clearRect(0,0,cWidth,cHeight);}
e.render(ctx);if(isFirstRender){isFirstRender=false;if(typeof svg.opts['renderCallback']=='function')svg.opts['renderCallback'](dom);}};var waitingForImages=true;if(svg.ImagesLoaded()){waitingForImages=false;draw();}
{svg.intervalID=setInterval(function(){var needUpdate=false;if(waitingForImages&&svg.ImagesLoaded()){waitingForImages=false;needUpdate=true;}
if(svg.opts['ignoreMouse']!=true){needUpdate=needUpdate|svg.Mouse.hasEvents();}
if(svg.opts['ignoreAnimation']!=true){for(var i=0;i<svg.Animations.length;i++){needUpdate=needUpdate|svg.Animations[i].update(1000/svg.FRAMERATE);}}
if(typeof svg.opts['forceRedraw']=='function'){if(svg.opts['forceRedraw']()==true)needUpdate=true;}
if(needUpdate){draw();svg.Mouse.runEvents();}},1000/svg.FRAMERATE);}};svg.stop=function(){if(svg.intervalID){clearInterval(svg.intervalID);}};svg.Mouse=new(function(){this.events=[];this.hasEvents=function(){return this.events.length!=0;};this.onclick=function(x,y){this.events.push({type:'onclick',x:x,y:y,run:function(e){if(e.onclick)e.onclick();}});};this.onmousemove=function(x,y){this.events.push({type:'onmousemove',x:x,y:y,run:function(e){if(e.onmousemove)e.onmousemove();}});};this.eventElements=[];this.checkPath=function(element,ctx){for(var i=0;i<this.events.length;i++){var e=this.events[i];if(ctx.isPointInPath&&ctx.isPointInPath(e.x,e.y))this.eventElements[i]=element;}};this.checkBoundingBox=function(element,bb){for(var i=0;i<this.events.length;i++){var e=this.events[i];if(bb.isPointInBox(e.x,e.y))this.eventElements[i]=element;}};this.runEvents=function(){svg.ctx.canvas.style.cursor='';for(var i=0;i<this.events.length;i++){var e=this.events[i];var element=this.eventElements[i];while(element){e.run(element);element=element.parent;}}
this.events=[];this.eventElements=[];};});return svg;}
if(typeof CanvasRenderingContext2D!='undefined'){CanvasRenderingContext2D.prototype.drawSvg=function(s,dx,dy,dw,dh,opts){var cOpts={ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:dx,offsetY:dy,scaleWidth:dw,scaleHeight:dh};for(var prop in opts){if(opts.hasOwnProperty(prop)){cOpts[prop]=opts[prop];}}
canvg(this.canvas,s,cOpts);};}
module.exports=canvg;});return canvg_1;})));function RGBColor(color_string)
{this.ok=false;if(color_string.charAt(0)=='#'){color_string=color_string.substr(1,6);}
color_string=color_string.replace(/ /g,'');color_string=color_string.toLowerCase();var simple_colors={aliceblue:'f0f8ff',antiquewhite:'faebd7',aqua:'00ffff',aquamarine:'7fffd4',azure:'f0ffff',beige:'f5f5dc',bisque:'ffe4c4',black:'000000',blanchedalmond:'ffebcd',blue:'0000ff',blueviolet:'8a2be2',brown:'a52a2a',burlywood:'deb887',cadetblue:'5f9ea0',chartreuse:'7fff00',chocolate:'d2691e',coral:'ff7f50',cornflowerblue:'6495ed',cornsilk:'fff8dc',crimson:'dc143c',cyan:'00ffff',darkblue:'00008b',darkcyan:'008b8b',darkgoldenrod:'b8860b',darkgray:'a9a9a9',darkgreen:'006400',darkkhaki:'bdb76b',darkmagenta:'8b008b',darkolivegreen:'556b2f',darkorange:'ff8c00',darkorchid:'9932cc',darkred:'8b0000',darksalmon:'e9967a',darkseagreen:'8fbc8f',darkslateblue:'483d8b',darkslategray:'2f4f4f',darkturquoise:'00ced1',darkviolet:'9400d3',deeppink:'ff1493',deepskyblue:'00bfff',dimgray:'696969',dodgerblue:'1e90ff',feldspar:'d19275',firebrick:'b22222',floralwhite:'fffaf0',forestgreen:'228b22',fuchsia:'ff00ff',gainsboro:'dcdcdc',ghostwhite:'f8f8ff',gold:'ffd700',goldenrod:'daa520',gray:'808080',green:'008000',greenyellow:'adff2f',honeydew:'f0fff0',hotpink:'ff69b4',indianred:'cd5c5c',indigo:'4b0082',ivory:'fffff0',khaki:'f0e68c',lavender:'e6e6fa',lavenderblush:'fff0f5',lawngreen:'7cfc00',lemonchiffon:'fffacd',lightblue:'add8e6',lightcoral:'f08080',lightcyan:'e0ffff',lightgoldenrodyellow:'fafad2',lightgrey:'d3d3d3',lightgreen:'90ee90',lightpink:'ffb6c1',lightsalmon:'ffa07a',lightseagreen:'20b2aa',lightskyblue:'87cefa',lightslateblue:'8470ff',lightslategray:'778899',lightsteelblue:'b0c4de',lightyellow:'ffffe0',lime:'00ff00',limegreen:'32cd32',linen:'faf0e6',magenta:'ff00ff',maroon:'800000',mediumaquamarine:'66cdaa',mediumblue:'0000cd',mediumorchid:'ba55d3',mediumpurple:'9370d8',mediumseagreen:'3cb371',mediumslateblue:'7b68ee',mediumspringgreen:'00fa9a',mediumturquoise:'48d1cc',mediumvioletred:'c71585',midnightblue:'191970',mintcream:'f5fffa',mistyrose:'ffe4e1',moccasin:'ffe4b5',navajowhite:'ffdead',navy:'000080',oldlace:'fdf5e6',olive:'808000',olivedrab:'6b8e23',orange:'ffa500',orangered:'ff4500',orchid:'da70d6',palegoldenrod:'eee8aa',palegreen:'98fb98',paleturquoise:'afeeee',palevioletred:'d87093',papayawhip:'ffefd5',peachpuff:'ffdab9',peru:'cd853f',pink:'ffc0cb',plum:'dda0dd',powderblue:'b0e0e6',purple:'800080',red:'ff0000',rosybrown:'bc8f8f',royalblue:'4169e1',saddlebrown:'8b4513',salmon:'fa8072',sandybrown:'f4a460',seagreen:'2e8b57',seashell:'fff5ee',sienna:'a0522d',silver:'c0c0c0',skyblue:'87ceeb',slateblue:'6a5acd',slategray:'708090',snow:'fffafa',springgreen:'00ff7f',steelblue:'4682b4',tan:'d2b48c',teal:'008080',thistle:'d8bfd8',tomato:'ff6347',turquoise:'40e0d0',violet:'ee82ee',violetred:'d02090',wheat:'f5deb3',white:'ffffff',whitesmoke:'f5f5f5',yellow:'ffff00',yellowgreen:'9acd32'};for(var key in simple_colors){if(color_string==key){color_string=simple_colors[key];}}
var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:['rgb(123, 234, 45)','rgb(255,234,245)'],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])];}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:['#00ff00','336699'],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)];}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:['#fb0','f0f'],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)];}}];for(var i=0;i<color_defs.length;i++){var re=color_defs[i].re;var processor=color_defs[i].process;var bits=re.exec(color_string);if(bits){channels=processor(bits);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true;}}
this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return'rgb('+this.r+', '+this.g+', '+this.b+')';}
this.toHex=function(){var r=this.r.toString(16);var g=this.g.toString(16);var b=this.b.toString(16);if(r.length==1)r='0'+r;if(g.length==1)g='0'+g;if(b.length==1)b='0'+b;return'#'+r+g+b;}
this.getHelpXML=function(){var examples=new Array();for(var i=0;i<color_defs.length;i++){var example=color_defs[i].example;for(var j=0;j<example.length;j++){examples[examples.length]=example[j];}}
for(var sc in simple_colors){examples[examples.length]=sc;}
var xml=document.createElement('ul');xml.setAttribute('id','rgbcolor-examples');for(var i=0;i<examples.length;i++){try{var list_item=document.createElement('li');var list_color=new RGBColor(examples[i]);var example_div=document.createElement('div');example_div.style.cssText='margin: 3px; '
+'border: 1px solid black; '
+'background:'+list_color.toHex()+'; '
+'color:'+list_color.toHex();example_div.appendChild(document.createTextNode('test'));var list_item_value=document.createTextNode(' '+examples[i]+' -> '+list_color.toRGB()+' -> '+list_color.toHex());list_item.appendChild(example_div);list_item.appendChild(list_item_value);xml.appendChild(list_item);}catch(e){}}
return xml;}}
if(typeof Object.assign!='function'){Object.assign=function(target){'use strict';if(target==null){throw new TypeError('Cannot convert undefined or null to object');}
target=Object(target);for(var index=1;index<arguments.length;index++){var source=arguments[index];if(source!=null){for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}}
return target;};}
if(!String.prototype.startsWith){Object.defineProperty(String.prototype,'startsWith',{value:function(search,pos){pos=!pos||pos<0?0:+pos;return this.substring(pos,pos+search.length)===search;}});}
(function(){var out$=typeof exports!='undefined'&&exports||typeof define!='undefined'&&{}||this;var doctype='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>';function isElement(obj){return obj instanceof HTMLElement||obj instanceof SVGElement;}
function requireDomNode(el){if(!isElement(el)){throw new Error('an HTMLElement or SVGElement is required; got '+el);}}
function isExternal(url){return url&&url.lastIndexOf('http',0)==0&&url.lastIndexOf(window.location.host)==-1;}
function inlineImages(el,callback){requireDomNode(el);var images=el.querySelectorAll('image'),left=images.length,checkDone=function(){if(left===0){callback();}};checkDone();for(var i=0;i<images.length;i++){(function(image){var href=image.getAttributeNS("http://www.w3.org/1999/xlink","href");if(href){if(isExternal(href.value)){console.warn("Cannot render embedded images linking to external hosts: "+href.value);return;}}
var canvas=document.createElement('canvas');var ctx=canvas.getContext('2d');var img=new Image();img.crossOrigin="anonymous";href=href||image.getAttribute('href');if(href){img.src=href;img.onload=function(){canvas.width=img.width;canvas.height=img.height;ctx.drawImage(img,0,0);image.setAttributeNS("http://www.w3.org/1999/xlink","href",canvas.toDataURL('image/png'));left--;checkDone();}
img.onerror=function(){console.log("Could not load "+href);left--;checkDone();}}else{left--;checkDone();}})(images[i]);}}
function styles(el,options,cssLoadedCallback){var selectorRemap=options.selectorRemap;var modifyStyle=options.modifyStyle;var css="";var fontsQueue=[];var sheets=document.styleSheets;for(var i=0;i<sheets.length;i++){try{var rules=sheets[i].cssRules;}catch(e){console.warn("Stylesheet could not be loaded: "+sheets[i].href);continue;}
if(rules!=null){for(var j=0,match;j<rules.length;j++,match=null){var rule=rules[j];if(typeof(rule.style)!="undefined"){var selectorText;try{selectorText=rule.selectorText;}catch(err){console.warn('The following CSS rule has an invalid selector: "'+rule+'"',err);}
try{if(selectorText){match=el.querySelector(selectorText)||el.parentNode.querySelector(selectorText);}}catch(err){console.warn('Invalid CSS selector "'+selectorText+'"',err);}
if(match){var selector=selectorRemap?selectorRemap(rule.selectorText):rule.selectorText;var cssText=modifyStyle?modifyStyle(rule.style.cssText):rule.style.cssText;css+=selector+" { "+cssText+" }\n";}else if(rule.cssText.match(/^@font-face/)){var fontUrlRegexp=/url\(["']?(.+?)["']?\)/;var fontUrlMatch=rule.cssText.match(fontUrlRegexp);var externalFontUrl=(fontUrlMatch&&fontUrlMatch[1])||'';var fontUrlIsDataURI=externalFontUrl.match(/^data:/);if(fontUrlIsDataURI){externalFontUrl='';}
if(externalFontUrl==='about:blank'){externalFontUrl='';}
if(externalFontUrl){if(externalFontUrl.startsWith('../')){externalFontUrl=sheets[i].href+'/../'+externalFontUrl}else if(externalFontUrl.startsWith('./')){externalFontUrl=sheets[i].href+'/.'+externalFontUrl}
if(rule.cssText.indexOf("KaTeX")==-1){fontsQueue.push({text:rule.cssText,fontUrlRegexp:fontUrlRegexp,format:getFontMimeTypeFromUrl(externalFontUrl),url:externalFontUrl});}}else{css+=rule.cssText+'\n';}}}}}}
processFontQueue(fontsQueue);function getFontMimeTypeFromUrl(fontUrl){var supportedFormats={'woff2':'font/woff2','woff':'font/woff','otf':'application/x-font-opentype','ttf':'application/x-font-ttf','eot':'application/vnd.ms-fontobject','sfnt':'application/font-sfnt','svg':'image/svg+xml'};var extensions=Object.keys(supportedFormats);for(var i=0;i<extensions.length;++i){var extension=extensions[i];if(fontUrl.indexOf('.'+extension)>0){return supportedFormats[extension];}}
console.error('Unknown font format for '+fontUrl+'; Fonts may not be working correctly');return'application/octet-stream';}
function processFontQueue(queue){if(queue.length>0){var font=queue.pop();processNext(font);}else{cssLoadedCallback(css);}
function processNext(font){var oReq=new XMLHttpRequest();oReq.addEventListener('load',fontLoaded);oReq.addEventListener('error',transferFailed);oReq.addEventListener('abort',transferFailed);oReq.open('GET',font.url);oReq.responseType='arraybuffer';oReq.send();function fontLoaded(){var fontBits=oReq.response;var fontInBase64=arrayBufferToBase64(fontBits);updateFontStyle(font,fontInBase64);}
function transferFailed(e){console.warn('Failed to load font from: '+font.url);console.warn(e)
css+=font.text+'\n';processFontQueue(queue);}
function updateFontStyle(font,fontInBase64){var dataUrl='url("data:'+font.format+';base64,'+fontInBase64+'")';css+=font.text.replace(font.fontUrlRegexp,dataUrl)+'\n';setTimeout(function(){processFontQueue(queue)},0);}}}
function arrayBufferToBase64(buffer){var binary='';var bytes=new Uint8Array(buffer);var len=bytes.byteLength;for(var i=0;i<len;i++){binary+=String.fromCharCode(bytes[i]);}
return window.btoa(binary);}}
function getDimension(el,clone,dim){var v=(el.viewBox&&el.viewBox.baseVal&&el.viewBox.baseVal[dim])||(clone.getAttribute(dim)!==null&&!clone.getAttribute(dim).match(/%$/)&&parseInt(clone.getAttribute(dim)))||el.getBoundingClientRect()[dim]||parseInt(clone.style[dim])||parseInt(window.getComputedStyle(el).getPropertyValue(dim));return(typeof v==='undefined'||v===null||isNaN(parseFloat(v)))?0:v;}
function reEncode(data){data=encodeURIComponent(data);data=data.replace(/%([0-9A-F]{2})/g,function(match,p1){var c=String.fromCharCode('0x'+p1);return c==='%'?'%25':c;});return decodeURIComponent(data);}
out$.prepareSvg=function(el,options,cb){requireDomNode(el);options=options||{};options.scale=options.scale||1;options.responsive=options.responsive||false;var xmlns="http://www.w3.org/2000/xmlns/";inlineImages(el,function(){var outer=document.createElement("div");var clone=el.cloneNode(true);var width,height;if(el.tagName=='svg'){width=options.width||getDimension(el,clone,'width');height=options.height||getDimension(el,clone,'height');}else if(el.getBBox){var box=el.getBBox();width=box.x+box.width;height=box.y+box.height;clone.setAttribute('transform',clone.getAttribute('transform').replace(/translate\(.*?\)/,''));var svg=document.createElementNS('http://www.w3.org/2000/svg','svg')
svg.appendChild(clone)
clone=svg;}else{console.error('Attempted to render non-SVG element',el);return;}
clone.setAttribute("version","1.1");if(!clone.getAttribute('xmlns')){clone.setAttributeNS(xmlns,"xmlns","http://www.w3.org/2000/svg");}
if(!clone.getAttribute('xmlns:xlink')){clone.setAttributeNS(xmlns,"xmlns:xlink","http://www.w3.org/1999/xlink");}
if(options.responsive){clone.removeAttribute('width');clone.removeAttribute('height');clone.setAttribute('preserveAspectRatio','xMinYMin meet');}else{clone.setAttribute("width",width*options.scale);clone.setAttribute("height",height*options.scale);}
clone.setAttribute("viewBox",[options.left||0,options.top||0,width,height].join(" "));var fos=clone.querySelectorAll('foreignObject > *');for(var i=0;i<fos.length;i++){if(!fos[i].getAttribute('xmlns')){fos[i].setAttributeNS(xmlns,"xmlns","http://www.w3.org/1999/xhtml");}}
outer.appendChild(clone);styles(el,options,cssLoadedCallback);function cssLoadedCallback(css){var s=document.createElement('style');s.setAttribute('type','text/css');s.innerHTML="<![CDATA[\n"+css+"\n]]>";var defs=document.createElement('defs');defs.appendChild(s);clone.insertBefore(defs,clone.firstChild);if(cb){var outHtml=outer.innerHTML;outHtml=outHtml.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');cb(outHtml,width,height);}}});}
out$.svgAsDataUri=function(el,options,cb){out$.prepareSvg(el,options,function(svg){var uri='data:image/svg+xml;base64,'+window.btoa(reEncode(doctype+svg));if(cb){cb(uri);}});}
out$.svgAsPngUri=function(el,options,cb){requireDomNode(el);options=options||{};options.encoderType=options.encoderType||'image/png';options.encoderOptions=options.encoderOptions||0.8;var convertToPng=function(src,w,h){var canvas=document.createElement('canvas');var context=canvas.getContext('2d');canvas.width=w;canvas.height=h;if(options.canvg){options.canvg(canvas,src);}else{context.drawImage(src,0,0);}
if(options.backgroundColor){context.globalCompositeOperation='destination-over';context.fillStyle=options.backgroundColor;context.fillRect(0,0,canvas.width,canvas.height);}
var png;try{png=canvas.toDataURL(options.encoderType,options.encoderOptions);}catch(e){if((typeof SecurityError!=='undefined'&&e instanceof SecurityError)||e.name=="SecurityError"){console.error("Rendered SVG images cannot be downloaded in this browser.");return;}else{throw e;}}
cb(png);}
if(options.canvg){out$.prepareSvg(el,options,convertToPng);}else{out$.svgAsDataUri(el,options,function(uri){var image=new Image();image.onload=function(){convertToPng(image,image.width,image.height);}
image.onerror=function(){console.error('There was an error loading the data URI as an image on the following SVG\n',window.atob(uri.slice(26)),'\n',"Open the following link to see browser's diagnosis\n",uri);}
image.src=uri;});}}
out$.download=function(name,uri){if(navigator.msSaveOrOpenBlob){navigator.msSaveOrOpenBlob(uriToBlob(uri),name);}else{var saveLink=document.createElement('a');var downloadSupported='download'in saveLink;if(downloadSupported){saveLink.download=name;saveLink.style.display='none';document.body.appendChild(saveLink);try{var blob=uriToBlob(uri);var url=URL.createObjectURL(blob);saveLink.href=url;saveLink.onclick=function(){requestAnimationFrame(function(){URL.revokeObjectURL(url);})};}catch(e){console.warn('This browser does not support object URLs. Falling back to string URL.');saveLink.href=uri;}
saveLink.click();document.body.removeChild(saveLink);}
else{window.open(uri,'_temp','menubar=no,toolbar=no,status=no');}}}
function uriToBlob(uri){var byteString=window.atob(uri.split(',')[1]);var mimeString=uri.split(',')[0].split(':')[1].split(';')[0]
var buffer=new ArrayBuffer(byteString.length);var intArray=new Uint8Array(buffer);for(var i=0;i<byteString.length;i++){intArray[i]=byteString.charCodeAt(i);}
return new Blob([buffer],{type:mimeString});}
out$.saveSvg=function(el,name,options){requireDomNode(el);options=options||{};out$.svgAsDataUri(el,options,function(uri){out$.download(name,uri);});}
out$.saveSvgAsPng=function(el,name,options){requireDomNode(el);options=options||{};out$.svgAsPngUri(el,options,function(uri){out$.download(name,uri);});}
if(typeof define!=='undefined'){define(function(){return out$;});}})();'use strict';app.controller('saveController',['$scope','$http','$timeout','$q','$state','calculatorService','designService','plotsService','authService',saveController]);function saveController($scope,$http,$timeout,$q,$state,calculatorService,designService,plotsService,authService)
{$scope.userWarn='Saving will rewrite any data';$scope.design=designService;$scope.accordionStatus={isCustomHeaderOpen:!$scope.design.notEmbedded};$scope.save_status=0;$scope.save=function()
{if($state.current.name=='tools.powersize'||$state.current.name=='tools.samplesize')
{saveSampleAndPowerData();}
else if($state.current.name=='design_guide'){saveDesignGuideData();}
else
{savePlots();}
$scope.save_status=1
$timeout(function(){$scope.save_status=0},500);};function saveDesignGuideData(){var projectname=authService.sqlprojects.selected.name;designService.reportData.tool="design_guide";designService.reportData.project=projectname;$http({method:'POST',url:'/saveUserData',headers:{'Content-Type':'application/json'},data:designService.reportData}).then(function successCallback(response){var currentSelectedProject=authService.sqlprojects.selected;authService.getProjects().then(function(){updateCurrentSelectedProject(currentSelectedProject);});},function errorCallback(response){console.log('saveUserData error');console.log(response);});};function updateCurrentSelectedProject(currentSelectedProject){if(currentSelectedProject){var allOpts=authService.sqlprojects.options;var selectedProjMatch=allOpts[0];for(var ii=0;ii<allOpts.length;ii++){if(allOpts[ii].id==currentSelectedProject.id){selectedProjMatch=allOpts[ii];}}
authService.sqlprojects.selected=selectedProjMatch;authService.subProjectSelected=selectedProjMatch.subs[0];}};function saveSampleAndPowerData()
{var projectname=authService.sqlprojects.selected.name;$scope.save_status=0;var data=calculatorService.data;data.test=designService.stat.selectedOption.name;data.user_id=authService.user_id;data.project=projectname;var toolsScope=$scope.$parent.$parent.$parent;if(designService.isNone()||toolsScope.groupError==true||toolsScope.treatmentError==true||data.es==0||!data.es||!data.pow||!data.samplesize||!data.sig||!data.groups){console.log("ERROR: invalid input value")
$scope.save_status=2
$timeout(function(){$scope.save_status=0},3000);}else{$http({method:'POST',url:'/saveUserData',headers:{'Content-Type':'application/json'},data:data}).then(function successCallback(response){var currentSelectedProject=authService.sqlprojects.selected;authService.getProjects().then(function(){updateCurrentSelectedProject(currentSelectedProject);});},function errorCallback(response){console.log('saveUserData error');console.log(response);});}};$scope.hideSave=function(selectedID)
{var tmp=false;if($state.current.name=='tools.powersize'||$state.current.name=='tools.samplesize')
{$scope.userWarn="Select a project to save to FIRST. Saving will overwrite previously saved data in the selected project.";$scope.userInfo="To create or rename your project goto USER PROJECTS under REPORTS or My Account.";tmp=(selectedID==10);}
else if($state.current.name=='tools.pwrgraph')
{$scope.userWarn="A new plot will be saved called 'Power Plot'.";tmp=(selectedID==10);}
else if($state.current.name=='tools.sims')
{$scope.userWarn="A new plot will be saved called 'Sim Plot'.";tmp=(selectedID==10);}
else if($state.current.name=='tools.rng')
{tmp=true;}
return tmp;};function savePlots()
{var nvd3Elements=document.getElementsByTagName("nvd3");var dataURI=new Array(nvd3Elements.length);var options={scale:0.75,canvg:window.canvg};var getUriData=function(index){var def=$q.defer();var svgCanvas=nvd3Elements[index].getElementsByTagName("svg")[0];svgAsPngUri(svgCanvas,options,function(uri2){dataURI[index]=uri2;def.resolve();});return def.promise;};var promiseVector=[];for(var ii=0;ii<dataURI.length;ii++){promiseVector.push(getUriData(ii));}
$q.all(promiseVector).then(function(values){var plotname='';if($state.current.name=='tools.pwrgraph')
plotname="Power Plot";else if($state.current.name=='tools.sims')
plotname="Simulation Plot";else
plotname="Data Analysis";plotname+=" for "+designService.stat.selectedOption.name
plotsService.dataIn.plotType=$state.current.name;var data={user_id:authService.user_id,tool:"graph",project:authService.sqlprojects.selected.name,data:{data:plotsService.dataIn,img:dataURI},plotname:plotname};$http({method:'POST',url:'/saveUserData',data:data,headers:{'Content-Type':'application/json'},}).then(function successCallback(response){var currentSelectedProject=authService.sqlprojects.selected;authService.getProjects().then(function(){updateCurrentSelectedProject(currentSelectedProject);});},function errorCallback(response){console.log("error")});});};};(function(){'use strict';angular.module('tempestApp').service('plotsService',[plotsService]);function plotsService(){this.dataIn=[];this.updateData=function(data){this.dataIn=data;};this.help={simPlotData:[]};}})();(function(){'use strict';angular.module('tempestApp').service('designService',[designService]);function designService(){this.DGcompleted=false;this.designType='Randomized';this.statMethod='1-Way ANOVA';this.notEmbedded=true;this.tourCreated=[0,0,0,0,0,0];this.stat={selectedOption:{},selected:0,options:[{id:10,name:'-- Select type of statistical test for analysis:',ui_sref:'',items:[]},{id:3,name:'T-Test - One Sample',ui_sref:'help.stattests.t1'},{id:8,name:'T-Test - Two Sample',ui_sref:'help.stattests.tI'},{id:4,name:'Paired T-Test',ui_sref:'help.stattests.t2'},{id:1,name:'1-Way ANOVA',ui_sref:'help.stattests.anova'},{id:7,name:'2-Way ANOVA',ui_sref:'help.stattests.2anova'},{id:2,name:'Multi-Way ANOVA',ui_sref:'help.stattests.3anova'},{id:6,name:'Simple Linear Model',ui_sref:'help.stattests.home'},{id:11,name:'Repeated Measures ANOVA',ui_sref:'help.stattests.anova_rep'},{id:12,name:'Crossover',ui_sref:'help.stattests.anova_rep'},],};this.checkSelectedId=function(id){return(this.stat.selectedOption.id==id);};this.isNone=function(){return this.checkSelectedId(10)};this.isTTest1=function(){return this.checkSelectedId(3)};this.isTTest2=function(){return this.checkSelectedId(8)};this.isTTestPaired=function(){return this.checkSelectedId(4)};this.isANOVA1=function(){return this.checkSelectedId(1)};this.isANOVA2=function(){return this.checkSelectedId(7)};this.isANOVAm=function(){return this.checkSelectedId(2)};this.isSLM=function(){return this.checkSelectedId(6)};this.isRMPS1=function(){return this.checkSelectedId(11)};this.isRMCS1=function(){return this.checkSelectedId(12)};this.getTest=function(id){var testStr='';var statOpts=this.stat.options;for(var ii=0;ii<statOpts.length;ii++){if(statOpts[ii].id==id){testStr=statOpts[ii].name;break;}};return testStr;};var rng_url='https://www.mysamplesize.com:3838/ShinyApps/random/';this.type={selected:0,options:[{id:100,name:'-- Select design type:',url:''},{id:0,name:'Completely Randomized',url:rng_url+'complete_rand'},{id:1,name:'Randomized Block',url:rng_url+'block_rand'},{id:2,name:'Incomplete Block',url:rng_url+'block_incomplete'},{id:3,name:'Crossover',url:rng_url+'crossover'},{id:4,name:'Latin Square',url:rng_url+'latin_square'},{id:5,name:'Matched Pair',url:rng_url+'matched_pair'},{id:6,name:'Factorial',url:rng_url+'factorial'},{id:7,name:'Dose Response',url:rng_url+'dose_response'},{id:8,name:'Dose Escalation',url:rng_url+'dose_escalation'},{id:9,name:'Nested',url:rng_url+'nested'},{id:10,name:'Split Plot',url:rng_url+'split_plot'},{id:11,name:'Repeated Measures',url:rng_url+'repeat'},{id:12,name:'Sequential',url:rng_url+'sequential'},{id:13,name:'Simple Regression',url:rng_url+'simple_regression'},],};this.stat.selectedOption=this.stat.options[this.stat.selected];this.type.selectedOption=this.type.options[this.type.selected];this.numGroups=null;this.change=function(type_id,stat_id)
{var stat_ndx=-1;var type_ndx=-1;for(var ii=0;ii<this.stat.options.length;ii++)
{var opt=this.stat.options[ii];if(stat_id==opt.id)
{stat_ndx=ii;break;}}
for(var ii=0;ii<this.type.options.length;ii++)
{var opt=this.type.options[ii];if(type_id==opt.id)
{type_ndx=ii;break;}}
this.stat.selected=stat_ndx;this.type.selected=type_ndx;if(stat_ndx<0||stat_ndx>this.stat.options.length)
this.statMethod='unable to calculate at this time';else
this.statMethod=this.stat.options[this.stat.selected].name;this.stat.selectedOption=this.stat.options[this.stat.selected];if(type_ndx<0||type_ndx>this.type.options.length)
this.designType='unable to calculate at this time';else
this.designType=this.type.options[this.type.selected].name;};this.treatment_table=null;this.graphsText='',this.formData={step:0,hypothesis:null,responseTypes:{selected:0,options:[{name:"Continuous",id:0},{name:"Discrete",id:1},{name:"Binary",id:2},],},takeBaseline:0,controlTypes:[{name:"Negative",id:0},{name:"Positive",id:1},],nControlAdditionalSelected:0,litResource:0,treatments:[{level:[{id:1,name:null}],description:null,control:{},control_desc:null},],stdev:null,effectSize:null,effectSizeLarge:null,obsUnits:null,outMeas:null,factors:[],covariates:[],repeatedMeasures:[{level:1,description:null},],repMeas:{checked:0,opt:1,multipleES:0,timePts:5,withinSD:6,betweenSD:5,checkboxes:{measDiffOverTrtm:{selected:true,esLg:null,esSm:null,label:"Detecting differences in measures over treatments/manipulations/other factors?"},measDiffOverTime:{selected:false,esLg:null,esSm:null,label:"Detecting differences in measures over time?"},measDiffOverIntr:{selected:false,esLg:null,esSm:null,label:"Detecting existence of interactions between time and treatments?"}}},correlation:0,};this.count_addl_controls=function(){var addlCtl=this.formData.controlTypes;this.formData.nControlAdditionalSelected=0;for(var ii=0;ii<addlCtl.length;ii++)
{var ct=addlCtl[ii];if(ct.selected)
{this.formData.nControlAdditionalSelected++;this.formData.treatment_table.push({'group':'Additional control: '+ct.name,'selected':ct.selected})}}};this.count_factors_levels=function(){var nFactors=[];for(var ii=0;ii<this.formData.treatments.length;ii++)
nFactors.push(this.formData.treatments[ii].level.length+1);for(var ii=0;ii<this.formData.factors.length;ii++)
nFactors.push(this.formData.factors[ii].level.length);return nFactors;};function loadJSON(tmp)
{var power_data=TOOLS_LABELS_POWER;var sample_data=TOOLS_LABELS_SAMPLE;for(var ii=0;ii<tmp.stat.options.length;ii++)
{var id=tmp.stat.options[ii].id;if(id==3){tmp.stat.options[ii].power_items=power_data.ttest_1s;tmp.stat.options[ii].sample_items=sample_data.ttest_1s;}
if(id==8){tmp.stat.options[ii].power_items=power_data.ttest_2s;tmp.stat.options[ii].sample_items=sample_data.ttest_2s;}
if(id==4){tmp.stat.options[ii].power_items=power_data.ttest_paired;tmp.stat.options[ii].sample_items=sample_data.ttest_paired;}
if(id==1){tmp.stat.options[ii].power_items=power_data.aov1;tmp.stat.options[ii].sample_items=sample_data.aov1;}
if(id==7){tmp.stat.options[ii].power_items=power_data.aov2;tmp.stat.options[ii].sample_items=sample_data.aov2;}
if(id==2){tmp.stat.options[ii].power_items=power_data.aovm;tmp.stat.options[ii].sample_items=sample_data.aovm;}
if(id==11){tmp.stat.options[ii].power_items=power_data.rm_parallel;tmp.stat.options[ii].sample_items=sample_data.rm_parallel;}
if(id==12){tmp.stat.options[ii].power_items=power_data.rm_crossover;tmp.stat.options[ii].sample_items=sample_data.rm_crossover;}}};loadJSON(this);}})();app.controller('designguideController',['$scope','$http','$state','designService','calculatorService','$anchorScroll','$location','$q','$uibModal','$timeout','$rootScope','authService',function designguideController($scope,$http,$state,designService,calculatorService,$anchorScroll,$location,$q,$uibModal,$timeout,$rootScope,authService)
{$scope.design=designService;$scope.designReport='/static/partials/webpage_reports/report.design.html';$scope.quiztableinfo='/static/partials/webpage_design/guide/quiz.table_info.html';$scope.quiztablegroups='/static/partials/webpage_design/guide/quiz.table_groups.html';$scope.quizrepmeasps='/static/partials/webpage_design/guide/quiz.repMeasures_parallelSingle.html';$scope.quizrepmeascs='/static/partials/webpage_design/guide/quiz.repMeasures_crossoverSingle.html';$scope.quizrepmeases='static/partials/webpage_tools/repMeasuresES.html';$scope.inProgress=false;$scope.calculator=calculatorService;$scope.outputGraphs=[];$scope.graphsText=[];var collapseAll=function()
{var ttmp=true;var ftmp=false;if($scope.formData.step==1)
{ttmp=false;ftmp=true;}
for(var ii=0;ii<$scope.tcollapse.length;ii++)
$scope.tcollapse[ii].isCollapsed=ttmp;for(var ii=0;ii<$scope.fcollapse.length;ii++)
$scope.fcollapse[ii].isCollapsed=ftmp;}
$scope.swipe_class={name:'swipe-views swipe-views-left'};$scope.changeSwipeClass=function(step){if(step>$scope.formData.step){$scope.swipe_class.name="swipe-views swipe-views-right";}else if(step<$scope.formData.step){$scope.swipe_class.name="swipe-views swipe-views-left";}};$scope.setStep=function(step){if(step<0){step=0;$scope.formData.step=step;return;};if(step!==4)
$scope.tools.showSimPlots=false;$scope.formData.step=step;collapseAll();$scope.processForm();$location.hash('scrollArea');$anchorScroll.yOffset=200;$anchorScroll();$location.hash('');for(var ii=0;ii<6;ii++)
{if(ii==step)
continue;designService.tourCreated[step]=0;}}
$scope.simPlotExists=null;$scope.simPlotFcn=null;$scope.DG_register=function(simPlotExists,callPythonToPlot)
{$scope.simPlotExists=simPlotExists;$scope.simPlotFcn=callPythonToPlot;};var svgOptions={canvg:window.canvg};$scope.reportProgress={item:0,total:4};function createURIs(n,def){var deferred=def||$q.defer();$scope.reportProgress.item=n-$scope.reportProgress.total;if(n==0){deferred.resolve(true);return deferred.promise;}
$scope.simPlotFcn().then(function(){var allSvgElements=document.getElementsByTagName("nvd3");var URI2=new Array(allSvgElements.length);var getUriData=function(index){var def2=$q.defer();svgAsPngUri(allSvgElements[index].children[0],svgOptions,function(uri2){URI2[index]=uri2;def2.resolve();});return def2.promise;};var promiseVector=[];for(var ii=1;ii<URI2.length;ii++){promiseVector.push(getUriData(ii));}
$q.all(promiseVector).then(function(values){for(var ii=1;ii<URI2.length;ii++){$scope.outputGraphs.push(URI2[ii]);$scope.graphsText.push(designService.graphsText);}
createURIs(n-1,deferred);});});return deferred.promise;};$scope.loadDataModal=function(){var openModal=$uibModal.open({templateUrl:mpath+'design.loadData.html',size:'lg',scope:$scope,controller:'ModalInstanceCtrl',});};$scope.saveDataModal=function(){$scope.processForm();var openModal=$uibModal.open({templateUrl:mpath+'design.saveData.html',size:'lg',scope:$scope,controller:'ModalInstanceCtrl',});};$scope.stepUp=function(){sendDataToServer();if($scope.formData.step==4)
{$scope.outputGraphs=[];$scope.graphsText=[];if($scope.formData.repMeas.checked)
{sendDataToServer();$scope.setStep($scope.formData.step+1);return;}
var processModalInstance=$uibModal.open({templateUrl:mpath+'design.processForm.html',size:'md',scope:$scope,backdrop:'static',keyboard:false,});var nURIS=3;$scope.reportProgress.total=nURIS+1;if(!$scope.simPlotExists())
{nURIS=0;}
$scope.inProgress=true;var svgElements=document.getElementsByTagName("nvd3")[0];createURIs(nURIS).then(function success(){svgAsPngUri(svgElements.children[0],svgOptions,function(uri1){$scope.outputGraphs.push(uri1);$scope.graphsText.push('');processModalInstance.close();$scope.setStep($scope.formData.step+1);})},function error(){console.log('uri error');},function notify(){console.log('notify');});}
else if($scope.formData.step==5){return;}else{$scope.setStep($scope.formData.step+1);}
$scope.inProgress=false;}
$scope.stepDown=function(){$scope.setStep($scope.formData.step-1);}
$scope.levelUp=function(thisTreatment)
{var nLevels=thisTreatment.level.length;nLevels=nLevels+1;var newLevel={id:nLevels,name:null};thisTreatment.level.push(newLevel);$scope.processForm();}
$scope.levelDown=function(thisTreatment)
{var nLevels=thisTreatment.level.length;if(nLevels==1)
return;nLevels=nLevels-1;thisTreatment.level.splice(nLevels,1);$scope.processForm();}
$scope.controlTypes2=[{name:"Negative",id:6},{name:"Positive",id:1},{name:"Comparative",id:3},{name:"Sham",id:2},{name:"Vehicle",id:0},{name:"Naive",id:4},{name:"Wild Type",id:5}];$scope.tcollapse=[{isCollapsed:false,nLevels:1}];$scope.fcollapse=[{isCollapsed:false,nLevels:1}];designService.formData.treatments[0].control=$scope.controlTypes2[0];$scope.formData=designService.formData;$scope.formData.pilotStudy=0;$scope.formData.step=0;calculatorService.data.esComb={index:[],effect:[5]};$scope.$watchGroup(['calculator.RMPS1.esMultiple','formData.step'],function(){if($scope.formData.step==3&&$scope.formData.repMeas.checked){if(calculatorService.RMPS1.esMultiple){designService.change(11,11+$scope.formData.repMeas.opt-1);calculatorService.resetDG();}}});$scope.groupsMax=3;$scope.makeTreatmentTable=function()
{var treatments=$scope.formData.treatments;var factors=$scope.formData.factors;var myArgs=new Array(treatments.length+factors.length);for(var ii=0;ii<treatments.length;ii++)
{var nLevels=treatments[ii].level.length;myArgs[ii]=new Array(nLevels);var tmt=treatments[ii].description;if((tmt==null)||(tmt==undefined))
tmt="Treatment "+(ii+1);for(var jj=0;jj<nLevels;jj++)
{var lvl=treatments[ii].level[jj].name;if((lvl==null)||(lvl==undefined))
lvl="Level "+(jj+1);myArgs[ii][jj]="("+tmt+": "+lvl+")";}
var cDesc=treatments[ii].control_desc;if((cDesc==null)||(cDesc==undefined))
cDesc="Control ";myArgs[ii][nLevels]="("+cDesc+": "+treatments[ii].control.name+" control)";}
for(var ii=0;ii<factors.length;ii++)
{var nLevels=factors[ii].level.length;myArgs[ii+treatments.length]=new Array(nLevels);var tmt=factors[ii].description;if((tmt==null)||(tmt==undefined))
tmt="Factor "+(ii+1);for(var jj=0;jj<nLevels;jj++)
{var lvl=factors[ii].level[jj].name;if((lvl==null)||(lvl==undefined))
lvl="Level "+(jj+1);myArgs[ii+treatments.length][jj]="("+tmt+": "+lvl+")";}}
var r=[];function helper(arr,i){for(var j=0,l=myArgs[i].length;j<l;j++){var a=arr.slice(0);a.push(myArgs[i][j]);if(i==myArgs.length-1)
r.push(a);else
helper(a,i+1);}}
if(myArgs.length)
helper([],0);for(var ii=0;ii<r.length;ii++)
{var tmp=r[ii][0];for(var jj=1;jj<r[ii].length;jj++)
tmp=tmp+" + "+r[ii][jj];r[ii]=tmp;}
var selected=true;var treatment_table=[{'group':r[0],'selected':selected}];for(var ii=1;ii<r.length;ii++)
{var combo_str=r[ii];treatment_table.push({'group':combo_str,'selected':selected})}
if($scope.treatment_table!=null)
{for(var ii=0;ii<r.length;ii++){for(var jj=0;jj<$scope.treatment_table.length;jj++){if($scope.treatment_table[jj].group===r[ii])
{treatment_table[ii].selected=$scope.treatment_table[jj].selected;break;}}}}
$scope.treatment_table=treatment_table;designService.numGroups=$scope.treatment_table.length;designService.treatment_table=$scope.treatment_table;designService.formData=$scope.formData;return;}
$scope.addRow=function(objStr)
{var myArray=$scope.formData[objStr];var newRow={'level':[{id:1,name:null}],'description':null};if(objStr==='treatments')
{newRow.control=$scope.controlTypes2[0];newRow.control_desc=null;$scope.tcollapse.push({isCollapsed:false});}else{newRow={'level':[{id:1,name:null},{id:2,name:null}],'description':null};$scope.fcollapse.push({isCollapsed:false});}
myArray.push(newRow);$scope.processForm();};$scope.removeRow=function(objStr,index){var myArray=$scope.formData[objStr];if(objStr==='treatments'&&myArray.length==1){return;};myArray.splice(index,1);if(objStr==='treatments'){$scope.tcollapse.splice(index,1);}else{$scope.fcollapse.splice(index,1);}
$scope.processForm();};$scope.processForm=function()
{designService.formData=$scope.formData;$scope.makeTreatmentTable()
{designService.DGcompleted=true;}
designService.change(-1,-1);var formData=$scope.formData;var Tlength=formData.treatments.length;var Flength=0;var TandFlength=Tlength;if(formData.factors!='undefined'){Flength=formData.factors.length;TandFlength=Tlength+Flength;}
if(formData.repMeas.checked)
{designService.change(11,11+formData.repMeas.opt-1);sendDataToServer();return;}
if((formData.covariates.length==0))
{if(TandFlength==1){designService.change(0,1);}else if(TandFlength==2){designService.change(0,7);}else if(TandFlength>=3){designService.change(6,2);}
sendDataToServer();return;}
else if(formData.factors.length!==0)
{designService.change(1,2);}
else
{designService.change(-1,0);}
sendDataToServer();return;};$scope.$watch('calculator.calcData',function(){});function sendDataToServer(){return updateDesignReport();};function updateDesignReport()
{$scope.makeTreatmentTable();var data=$scope.formData;data.user_id=authService.user_id;data.treatment_table=$scope.treatment_table.slice();data.designType=designService.designType;data.statMethod=designService.statMethod;data.outputGraphs=$scope.outputGraphs;data.graphsText=$scope.graphsText;data.tools=calculatorService.calcData;designService.count_addl_controls();designService.reportData=data;$scope.nTotalGroups=$scope.formData.treatments.length+$scope.formData.factors.length+$scope.formData.nControlAdditionalSelected;$http({method:'POST',url:'/update_design_summary',headers:{'Content-Type':'application/json'},data:data}).then(function successCallback(response){if(response.data.error){console.log(response.data.msg)}
$scope.pdf_url=response.data.pdf
$scope.html_url=response.data.html
$rootScope.design_report_url=$rootScope.trustSrc('/design_report'+get_rand_string());},function errorCallback(response){});};var get_rand_string=function()
{var currentDate=new Date();var rand_string=currentDate.getDate()+''+currentDate.getMonth()+''+
currentDate.getFullYear()+''+currentDate.getHours()+''+
currentDate.getMinutes()+''+currentDate.getSeconds();rand_string='&v='+rand_string;rand_string='?user_id='+authService.user_id+rand_string;return rand_string;};$scope.tools={type:"samplesize",showSimPlots:false};$scope.$watch('design.formData',function(nv,ov){if(nv!==ov){$scope.formData=$scope.design.formData;$state.go("design_guide");$scope.setStep(0);}});$scope.fillForm=function()
{var dat=$scope;$scope.treatment_table=null;$scope.formData.hypothesis="Pharmacological activation of Group II metabotropic glutamate receptors with compound DCG-IV will reduce neuronal cell degeneration measured at 24 hours after experimental TBI in rats."
$scope.formData.outMeas="degenerating cells";$scope.formData.obsUnits="number of cells";$scope.formData.effectSize=60;$scope.formData.effectSizeLarge=140;$scope.formData.stdev="125";$scope.formData.treatments=[{level:[{id:1,name:"20 fmol DCG-IV"},{id:2,name:"100 fmol DCG-IV"},{id:3,name:"500 fmol DCG-IV"},],description:"drug",control:{name:"Vehicle",id:0},control_desc:"Artificial CSF"}];$scope.formData.factors=[];$state.go("design_guide");$scope.setStep(0);};$scope.tourCreated=[0,0,0,0,0,0];}]);'use strict';app.controller('designGuideWalkthroughController',['$scope','$rootScope','uiTourService','designService',function designGuideWalkthroughController($scope,$rootScope,TourService,designService)
{designService.tourCreated=[0,0,0,0,0,0];$scope.tourInit=function(step)
{var designPages=['start','treatments','factors','outcome','calc','end'];var tour=TourService.getTourByName(designPages[step]);if(step===0&&!designService.tourCreated[step])
{designService.tourCreated[step]=1;tour.createStep({elementId:'pageIntro0',order:0,orphan:true,title:'Welcome!',trustedContent:$rootScope.trustHTML('Welcome to DesignGuide. We will walk you through an example, Case 1 in Case Studies under HELP.<br><br>'+'You will be prompted to enter data to each field.'),});tour.createStep({elementId:'dg-hypoth',order:10,title:'Hypothesis',trustedContent:$rootScope.trustHTML('Enter your hypothesis here.  Case 1 hypothesis: <br><br> <b>Pharmacological activation of Group II metabotropic glutamate receptors with compound DCG-IV will reduce neuronal cell degeneration measured at 24 hours after experimental TBI in rats.</b> <br><br>  Tip: you can simply copy and paste the above.'),});tour.createStep({elementId:'dg-outMeas',order:20,title:'Outcome Measure',trustedContent:$rootScope.trustHTML('Case 1 outcome measure: <b>Degenerating cells </b>'),});tour.createStep({elementId:'dg-outUnits',order:30,title:'Outcome Measurement Units',trustedContent:$rootScope.trustHTML('Case 1 outcome measure unit: <b>Number of cells</b>'),});}else if(step===1&&!designService.tourCreated[step])
{designService.tourCreated[step]=1;tour.createStep({elementId:'pageIntro1',order:0,orphan:true,title:'Treatments',trustedContent:$rootScope.trustHTML('This case has <b>one</b> treatment and <b>three</b> levels.'),});tour.createStep({elementId:'case1-t1Name',order:10,title:'Treatment 1 Name',trustedContent:$rootScope.trustHTML('Case 1: <b>drug</b>'),});tour.createStep({elementId:'case1-t1nLevel',order:20,title:'Treatment 1 No. of Levels',trustedContent:$rootScope.trustHTML('Case 1: <b>3</b>'),});tour.createStep({elementId:'case1-t1cType',order:30,title:'Treatment 1 Control Type',trustedContent:$rootScope.trustHTML('Case 1: <b>Vehicle</b>'),});tour.createStep({elementId:'case1-t1cName',order:30,title:'Treatment 1 Control Name',trustedContent:$rootScope.trustHTML('Case 1: <b>Artificial CSF</b>'),});tour.createStep({elementId:'case1-t1Levels',order:30,title:'Treatment 1 Levels',trustedContent:$rootScope.trustHTML('Case 1:'
+'<br>Setting 1: <b>  20 fmol DCG-IV</b>'
+'<br>Setting 2: <b> 100 fmol DCG-IV</b>'
+'<br>Setting 3: <b> 500 fmol DCG-IV</b>'),});tour.createStep({elementId:'additional-control',order:40,title:'Additional Control',trustedContent:$rootScope.trustHTML('Case 1 has no additional controls.'),});}else if(step===2&&!designService.tourCreated[step])
{designService.tourCreated[step]=1;tour.createStep({elementId:'pageIntro2',order:0,orphan:true,title:'Factors',trustedContent:$rootScope.trustHTML('No additional information.'),});tour.createStep({elementId:'fct-dg-check',order:10,title:'Check Your Design',trustedContent:$rootScope.trustHTML('Click this button to check your current design again!'),});}else if(step===3&&!designService.tourCreated[step])
{designService.tourCreated[step]=1;tour.createStep({elementId:'pageIntro3',order:0,orphan:true,title:'Outcome Measure',trustedContent:$rootScope.trustHTML('We will enter information about effect size.'),});tour.createStep({elementId:'outMeas-largediff',order:10,title:'Largest possible effect size',trustedContent:$rootScope.trustHTML('125'),});tour.createStep({elementId:'outMeas-smalldiff',order:20,title:'Smallest possible effect size',trustedContent:$rootScope.trustHTML('75'),});tour.createStep({elementId:'outMeas-SD',order:30,title:'Standard Deviation',trustedContent:$rootScope.trustHTML('125'),});}else if(step===4&&!designService.tourCreated[step])
{designService.tourCreated[step]=1;tour.createStep({elementId:'pageIntro4',order:0,orphan:true,title:'Sample Size',trustedContent:$rootScope.trustHTML('No additional information.'),});tour.createStep({elementId:'sim-your-design',order:10,title:'Sample Size',trustedContent:$rootScope.trustHTML('Click this button to simulate your design.'),});tour.createStep({elementId:'dg-genReport',order:20,title:'Sample Size',trustedContent:$rootScope.trustHTML('Click this button to generate report.'),});}
tour.start();};}]);app.service('authService',['$http','$q','$state','$uibModal',function($http,$q,$state,$uibModal){var AUTH_IS_RESOLVED=false;this.user_id=null;this.authenticated=false;this.email=null;this.customer_id=null;this.subProjectSelected=null;this.stripeInfo=null;this.payment={delinquent:false,ended:false,};this.hasHandledInfo=function(){var def=$q.defer();if(!AUTH_IS_RESOLVED){return this.checkAuth();}else{def.resolve();}
return def.promise;};this.sqlprojects={selected:0,options:[{id:0,name:'Login to Select a Project.',created:null,subs:[]},],};this.getAccountInfo=function(){var authServ=this;AUTH_IS_RESOLVED=false;return $http.get('/get_stripe_account_info?user_id='+authServ.user_id).then(function successCallback(response){AUTH_IS_RESOLVED=true;var data=response.data;authServ.customer_id=data.message.id;var subscriptions=data.message.subscriptions;authServ.payment={delinquent:false,ended:false};if(data.error==false){if(angular.equals(subscriptions,{})||angular.equals(subscriptions.data,[])){data.error=true;data.message="You don't have an associated subscription";authServ.payment.ended=true;return;}
authServ.stripeInfo=subscriptions.data[0];authServ.stripeInfo.delinquent=data.message.delinquent;authServ.stripeInfo.email=data.message.email;authServ.stripeInfo.name=data.auth0.name;authServ.stripeInfo.coupon=data.message.coupon;authServ.payment.delinquent=authServ.stripeInfo.delinquent;authServ.plan=authServ.stripeInfo.plan;authServ.plan.billing=(authServ.stripeInfo.billing).replace('_',' ');authServ.plan.trialing=(authServ.stripeInfo.status=="trialing");}else{data.error=true;data.message=data.message;authServ.payment.ended=true;authServ.stripeInfo={email:authServ.email,};AUTH_IS_RESOLVED=true;}},function errorCallback(response){console.log(response);});};this.handleGetProjects=function(projDict){var authServ=this;authServ.sqlprojects.options=projDict;for(var ii=0;ii<projDict.length;ii++)authServ.sqlprojects.options[ii].id=ii;authServ.sqlprojects.selected=authServ.sqlprojects.options[0];authServ.sqlprojects.options.sort(function(a,b){var textA=a.name.toUpperCase();var textB=b.name.toUpperCase();return(textA<textB)?-1:(textA>textB)?1:0;});if(authServ.sqlprojects.selected)
authServ.subProjectSelected=authServ.sqlprojects.selected.subs[0];};this.getProjects=function(){var authServ=this;return $http.get('/sqlprojects?user_id='+authServ.user_id).then(function(response){var projDict=response.data;authServ.handleGetProjects(projDict);});};this.updateProfile=function(user_id,email){var deferred=$q.defer();this.user_id=null;this.email='bfitzpatrick@lmu.edu';if(user_id!=null){this.authenticated=true;this.email=email;this.user_id=user_id;this.getProjects();return this.getAccountInfo().then(function(){deferred.resolve();return deferred.promise;});}
if(user_id==null){this.user_id=1;this.sqlprojects={selected:0,options:[{id:0,name:'Login to Select a Project',created:null},],};deferred.resolve();}
return deferred.promise;};this.login=function(){window.location.href='/login';};this.checkAuth=function(){var authServ=this;var def=$q.defer();$http({method:'GET',url:'/check_auth',headers:{'Content-Type':'application/json'},}).then(function successCallback(response){var data=response.data;authServ.authenticated=data.authenticated;if(authServ.authenticated){data=data.user_info;authServ.user_id=data.user_id;authServ.email=data.email;return authServ.updateProfile(data.user_id,data.email).then(function(){def.resolve();return def.promise;});}else{def.resolve();return def.promise;}},function errorCallback(response){def.resolve();console.log(response);});return def.promise;};this.logOut=function(){this.authenticated=false;window.location.href='/logout';};this.showEULA=function(){var EULA_modal=$uibModal.open({templateUrl:mpath+'EULA.html',size:'lg',controller:'ModalInstanceCtrl',backdrop:'static',keyboard:true,});};}]);'use strict';app.service('stripeService',['authService','$uibModal',function stripeService(authService,$uibModal)
{this.info={};this.resetInfo=function(){this.info={email:'',password:'',name:'',affiliation:'',phone:'',token:'',success:false,message:'Payment successful.',display_price:2000,license_code:null,coupon_selected:false,tab_selected:0,quantity:1,selected_plan_id:'',subscription:{interval:'month',amount:3000,id:'',},group:{plan:{tiers:[{amount:2000}]},price:2000,},error:false,in_progress:false,processed:false};if(authService.authenticated)
this.info.email=authService.email;};this.resetInfo();this.stripe_plans=[this.info.subscription];this.updateFinalPrice=function(tmp){this.info.coupon_selected=false;if(tmp){this.info.display_price=tmp;}else{this.info.display_price=this.info.subscription.amount;}};this.initSingleUserInfo=function(){this.info.quantity=1;this.info.subscription=this.stripe_plans[0];this.info.selected_plan_id=this.info.subscription.id;this.updateFinalPrice(this.info.subscription.amount);};this.updateGroupPrice=function(){this.info.selected_plan_id=this.info.group.plan.id;var quantity=this.info.quantity;var tiers=this.info.group.plan.tiers;var tiered_price=tiers[0].unit_amount;for(var ii=0;ii<tiers.length;ii++){if(quantity<=tiers[ii].up_to){tiered_price=tiers[ii].unit_amount;break;}
tiered_price=tiers[ii].unit_amount;}
this.info.group.price=tiered_price*quantity;this.updateFinalPrice(this.info.group.price);};function createElement(stripeService){var style={base:{color:'#32325d',lineHeight:'18px',fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:'antialiased',fontSize:'16px','::placeholder':{color:'#c5c5c5'}},invalid:{color:'#fa755a',iconColor:'#fa755a'}};var stripeTest='pk_test_Td9lBt0smxltYrCM566Ivqod';var stripeLive='pk_live_8vn865K8DkJmZP106wPUBEHS';var stripe=Stripe(stripeLive);var elements=stripe.elements();var card=elements.create('card',{style:style});card.addEventListener('change',function(event){var displayError=document.getElementById('card-errors');if(event.error){displayError.textContent=event.error.message;}else{displayError.textContent='';}});stripeService.cardElement=card;stripeService.stripeElement=stripe;};this.cardElement='';this.stripeElement='';createElement(this);}]);'use strict';app.controller('stripeController',['$scope','$http','$uibModal','stripeService','authService','$timeout',function stripeController($scope,$http,$uibModal,stripeService,authService,$timeout)
{$scope.stripe=stripeService;$scope.authService=authService;$scope.submit_display="Submit";$scope.currentEventListener=function(){};var newEventListener_paymentToken=function(event){event.preventDefault();$scope.stripe.info.in_progress=true;stripeService.stripeElement.createToken(stripeService.cardElement).then(function(result){if(result.error){var errorElement=document.getElementById('card-errors');errorElement.textContent=result.error.message;$scope.stripe.info.in_progress=false;}else{processStripe(result);}});};var replaceEventListener=function(newEventListener){console.log("replacing event listener");var form=document.getElementById('payment-form');form.removeEventListener('submit',$scope.currentEventListener);form.addEventListener('submit',newEventListener);$scope.currentEventListener=newEventListener;};$scope.stripe.info.tab_selected=0;$scope.$watch('stripe.info.tab_selected',function(){$scope.stripe.info.coupon_selected=false;if($scope.stripe.info.tab_selected==1){replaceEventListener(newEventListener_paymentToken);$scope.submit_display="pay";}
if(!authService.authenticated&&($scope.stripe.info.tab_selected!==1)){$scope.stripe.info.coupon_selected=true;var newEventListener=function(event){event.preventDefault();processStripe(null);};replaceEventListener(newEventListener);}
else{$scope.stripe.info.license_code=null;}});$scope.stripe.resetInfo();$scope.stripe.initSingleUserInfo();$scope.coupon={waiting:false,id:'',data:{error:false,message:''},get:function(id){$scope.coupon.waiting=true;$http({method:'GET',url:'/get_coupon'+'?id='+id,}).then(function successCallback(response){$scope.coupon.waiting=false;$scope.coupon.data=response.data;},function errorCallback(response){$scope.coupon.waiting=false;$scope.coupon.data=response.data;});},};function resetCouponData(){$scope.coupon.waiting=false;$scope.coupon.id='';$scope.coupon.data={error:false,message:''};};$scope.$watch('coupon.data',function(){if($scope.coupon.data.error){$timeout(function(){resetCouponData();},2000);}});$http({method:'GET',url:'/get_stripe_plans',headers:{'Content-Type':'application/json'},}).then(function successCallback(response){$scope.stripe.stripe_plans=response.data;$scope.stripe.info.group.plan=$scope.stripe.stripe_plans[2];var tiers=$scope.stripe.info.group.plan.tiers;tiers[tiers.length-1].up_to=tiers[tiers.length-2].up_to+1+'+';$scope.stripe.stripe_plans.pop();$scope.stripe.stripe_plans.pop();$scope.stripe.initSingleUserInfo();$scope.stripe.info.quantity=tiers[0].up_to;},function errorCallback(response){});$scope.make_stripe_element=function(){stripeService.cardElement.mount('#card-element');replaceEventListener(newEventListener_paymentToken);};function processStripe(result)
{$scope.stripe.info.in_progress=true;$scope.stripe.info.processed=false;$scope.stripe.info.error=false;$scope.stripe.info.message="Processing...";if(result)
$scope.stripe.info.token=result.token;var processModalInstance=$uibModal.open({templateUrl:mpath+'processing.html',size:'md',scope:$scope,backdrop:'static',keyboard:false,});var payment_url='/stripe-pay-new-account';if(authService.authenticated){payment_url='/stripe-pay-existing-customer'
$scope.stripe.info.customer_id=authService.customer_id;}
$http({method:'POST',url:payment_url,headers:{'Content-Type':'application/json'},data:$scope.stripe.info}).then(function successCallback(response){$scope.stripe.info.in_progress=false;var resp=response.data;authService.stripeInfo=resp;$scope.stripe.info.message=resp.message;if(resp.error===false)
{if($scope.stripe.info.message.license){$scope.stripe.info.license_code=$scope.stripe.info.message.license;}
$scope.stripe.info.processed=true;}else{$scope.stripe.info.error=true;}
processModalInstance.close();},function errorCallback(response){processModalInstance.close();});};}]);'use strict';app.controller('myAccountController',['$scope','$state','$http','authService','stripeService','$uibModal',function myAccountController($scope,$state,$http,authService,stripeService,$uibModal)
{$scope.stripe=stripeService.stripeInfo;$scope.custPlan=authService.plan;$scope.custInfo=authService.stripeInfo;$scope.display={refreshInProg:false,updatePaymentMethod:false,cancelSubscription:false,changePassword:false,messageFlash:false,};$scope.getAccountInfo=function()
{$scope.display.refreshInProg=true;authService.getAccountInfo().then(function(){$scope.display.refreshInProg=false;$scope.custPlan=authService.plan;$scope.custInfo=authService.stripeInfo;if($scope.custPlan){if($scope.custPlan.trialing){$scope.custInfo.trial_end=$scope.convertDateTimeObject($scope.custInfo.trial_end);}}});};$scope.convertDateTimeObject=function(tmp){var datestr=$scope.convertDateObject(tmp);tmp=new Date(tmp*1000);datestr+=', '+tmp.getHours()+':'+tmp.getMinutes()+':'+tmp.getSeconds();return datestr;};$scope.convertDateObject=function(tmp){tmp=new Date(tmp*1000);var datestr=(tmp.getMonth()+1)+'/'+tmp.getDate()+'/'+tmp.getFullYear();return datestr;};$scope.change_password=function(new_password,new_password2)
{if((!new_password)||(new_password==="")){$scope.display.messageFlash="Password cannot be empty."
return;}
if(!angular.equals(new_password,new_password2)){$scope.display.messageFlash="Passwords do not match."
return;}
var changePswdModal=$uibModal.open({templateUrl:mpath+'processing.html',size:'md',backdrop:'static',keyboard:false,});$http({method:'POST',url:'/change_password',data:{new_password:new_password,user_id:authService.user_id},headers:{'Content-Type':'application/json'},}).then(function successCallback(response){changePswdModal.close();$scope.display.changePassword=false;$scope.display.messageFlash="Password changed!";},function errorCallback(response){console.log(response);changePswdModal.close();$scope.display.changePassword=false;$scope.display.messageFlash="Password change error -- ";});};$scope.cancel_subscription=function()
{$scope.display.cancelSubscription=true;$http.get('/cancel_subscription?user_id='+authService.user_id).then(function successCallback(response){$scope.cancelSubscriptionModal.close();$scope.display.cancelSubscription=false;$scope.getAccountInfo();console.log(response);},function errorCallback(response){console.log(response);$scope.cancelSubscriptionModal.close();$scope.display.cancelSubscription=false;});};$scope.openCancelSubscriptionModal=function(){$scope.cancelSubscriptionModal=$uibModal.open({templateUrl:'static/partials/webpage_auth/cancel.sub.modal.html',size:'md',scope:$scope});};$scope.make_stripe_update_form=function()
{$scope.stripe={success:false,message:'Payment successful.',error:false,in_progress:false,processed:false};stripeService.cardElement.mount('#card-element');var form=document.getElementById('payment-update-form');form.addEventListener('submit',function(event){event.preventDefault();stripeService.stripeElement.createToken(stripeService.cardElement).then(function(result){if(result.error){var errorElement=document.getElementById('card-errors');errorElement.textContent=result.error.message;}else{$scope.stripe.in_progress=true;$scope.stripe.processed=false;$scope.stripe.error=false;$scope.stripe.message="Updating..."
$scope.stripe.token=result.token;$scope.stripe.customer_id=authService.user_id;$http({method:'POST',url:'/stripe-update-pay',headers:{'Content-Type':'application/json'},data:$scope.stripe}).then(function successCallback(response){var data=response.data;$scope.stripe.in_progress=false;$scope.stripe.processed=true;if(data.error){$scope.stripe.error=true;$scope.stripe.message=data.message;}
},function errorCallback(response){});}});});};}]);'use strict';app.controller('userProjectsController',['$scope','$rootScope','$state','$http','designService','authService','$timeout','$uibModal',userProjectsController]);function userProjectsController($scope,$rootScope,$state,$http,designService,authService,$timeout,$uibModal)
{$scope.DGcompleted=designService.DGcompleted;$scope.design=designService;authService.getProjects();$scope.sortUpName=function(){authService.sqlprojects.options.sort(function(a,b){var textA=a.name.toUpperCase();var textB=b.name.toUpperCase();return(textA<textB)?-1:(textA>textB)?1:0;});};$scope.sortDownName=function(){authService.sqlprojects.options.sort(function(a,b){var textA=a.name.toUpperCase();var textB=b.name.toUpperCase();return(textA>textB)?-1:(textA<textB)?1:0;});};$scope.sortUpDate=function(){authService.sqlprojects.options.sort(function(a,b){var textA=a.created.toUpperCase();var textB=b.created.toUpperCase();return(textA<textB)?-1:(textA>textB)?1:0;});};$scope.sortDownDate=function(){authService.sqlprojects.options.sort(function(a,b){var textA=a.created.toUpperCase();var textB=b.created.toUpperCase();return(textA>textB)?-1:(textA<textB)?1:0;});};$scope.validname='NOTvalid';$scope.alert=false;$scope.alert2=false;function checkname(myArray,name){var found=myArray.some(function(el){return el.name===name;});if(!found){$scope.validname='valid'}
if(found){$scope.validname='NOTvalid'}};function addsqlRow(myArray,holdername){$http({method:'GET',url:'/newproject?user_id='+authService.user_id+'&project='+holdername,}).then(function successCallback(response){$scope.addsqlRow_valid=response.data;authService.handleGetProjects(response.data);},function errorCallback(response){});};$scope.check_addsqlRow=function(myArray){var holdername="New Project";checkname(myArray,holdername);if($scope.validname=='valid'){addsqlRow(myArray,holdername);}else{for(var i=1;i<51;i++){var holdername="New Project "+i;checkname(myArray,holdername);if(i==50){$scope.alert2=true;break;}else if($scope.validname=='valid'){addsqlRow(myArray,holdername);break;}}}};$scope.deleteProject=function(mainProject,subProject)
{$http({method:'POST',url:'/deleteSubProject',headers:{'Content-Type':'application/json'},data:{project:mainProject.name,rowid:subProject.rowid,table:subProject.table,user_id:authService.user_id}}).then(function successCallback(response){authService.handleGetProjects(response.data);},function errorCallback(response){});};$scope.removesqlRow=function(myArray,index){var projectname=myArray[index].name;myArray.splice(0,myArray.length);$http.get('/deleteproject?user_id='+authService.user_id+'&project='+projectname).then(function successCallback(response){authService.handleGetProjects(response.data);},function errorCallback(response){});};$scope.renameSubmit=function(isValid,myArray,index,newname){if(isValid){renameSql(myArray,index,newname);}};function renameSql(myArray,index,newname){var projectname=myArray[index].name;checkname(myArray,newname);if($scope.validname=='valid'){myArray.splice(0,myArray.length);$http({method:'GET',url:'/renameproject?user_id='+authService.user_id+'&project='+projectname+'&newname='+newname,}).then(function successCallback(response){authService.sqlprojects.selected=0;authService.handleGetProjects(response.data);},function errorCallback(response){});$scope.validname='backtonotvalid';$scope.alert=false;}
if($scope.validname=='NOTvalid'){$scope.alert=true;}};$scope.clickProject=function(mainProject,subProject)
{var clickOut="<div class='pull-right'><button class='btn btn-primary' type='button' ng-click='ok()'>X</button></div>";var projName=mainProject.name;var table=subProject.table;var rowid=subProject.rowid;var userid=authService.user_id;var queryStr="project="+projName+"&rowid="+rowid+"&user_id="+userid+"&table="+table;var pyUrl='/toolsHTML';if(!designService.notEmbedded)
{pyUrl='/getDGdata';if(table!=="design_guide"){alert("You can only load Design Guide data into the Design Guide!");return;}}
$http({method:'GET',url:pyUrl+'?'+queryStr,}).then(function successCallback(response){var imgData=response.data;if(!designService.notEmbedded){designService.formData=imgData;return;}
var templateData="<div class='modal-header'><h3>"+projName+" > "+subProject.name;templateData+=clickOut;templateData+="</h3></div> <div class='modal-body text-center'>"+imgData+"</div>";var modalInstance=$uibModal.open({animation:true,controller:'ModalInstanceCtrl',template:templateData,size:'lg'});},function errorCallback(response){});};};'use strict';app.run(['$anchorScroll',function($anchorScroll){$anchorScroll.yOffset=150;}]).controller('HelpCtrl',['$scope','$location','$anchorScroll','$timeout','$state',HelpCtrl]);function HelpCtrl($scope,$location,$anchorScroll,$timeout,$state)
{var rootPath='static/partials/webpage_help/';$scope.statPath=rootPath+'stattests/stat.test.';$scope.basicsPath=rootPath+'statbasics/basics.';$scope.typePath=rootPath+'designtype/design.type.';$scope.casePath=rootPath+'casestudies/example_';$scope.statBasics=[{title:"Basics",groups:[{title:"Overview",ui_sref:"overview"},{title:"Groups, Factors, Levels, Settings",ui_sref:"groups"},{title:"Power",ui_sref:"power"},{title:"Sample Size",ui_sref:"samplesize"},{title:"Significance",ui_sref:"sig"},{title:"Standard Deviation",ui_sref:"stdev"}]},{title:"Effect Size",groups:[{title:"Effect Size",ui_sref:"effect"},{title:"Effect Size in ANOVA",ui_sref:"effect_anova"},{title:"Cohen's d and f Values",ui_sref:"effect_cohen"},]},];$scope.statTests=[{title:"Background",groups:[{title:"Overview",ui_sref:"overview"},{title:"Significance and Power",ui_sref:"sig"},{title:"Mean, Standard Deviation, and Effect Size",ui_sref:"mean_std_es"}]},{title:"T-Test",groups:[{title:"Definitions",ui_sref:"ttest_def"},{title:"One-Sample T-Test",ui_sref:"t1"},{title:"Paired T-Test",ui_sref:"t2"},{title:"Independent-Sample T-Test",ui_sref:"tI"}]},{title:"ANOVA",groups:[{title:"Definitions",ui_sref:"anova_def"},{title:"1-Way ANOVA",ui_sref:"anova"},{title:"2-Way ANOVA",ui_sref:"2anova"},{title:"3-Way ANOVA",ui_sref:"3anova"},{title:"Repeated Measures ANOVA",ui_sref:"anova_rep"}]}];$scope.caseStudiesContents=[{title:"Contents",groups:[{title:"Case 1: Completely Randomized",html:"1.html",active:false},{title:"Case 2: Longitudinal Study",html:"2.html",active:false},{title:"Case 3: Repeated Measures 1",html:"3.html",active:false},{title:"Case 4: Repeated Measures 2",html:"4.html",active:false},]},];$scope.tutorialContents=[{title:"Overview",ui_sref:"help.tutorial.overview",groups:[]},{title:"Design Guide",ui_sref:"help.tutorial.designguide",groups:[{title:"Getting Started",active:false},{title:"Treatment Factors",active:false},{title:"Nontreatment Factors",active:false},{title:"Outcome Measures",active:false},{title:"Sample Size",active:false},{title:"Report",active:false},]},{title:"Statistical Tools",ui_sref:"help.tutorial.tools",groups:[{title:"Sample Size Calculator",active:false},{title:"Statistical Power Calculator",active:false},{title:"Power Plot",active:false},{title:"Random Number Generator",active:false},{title:"Simulations",active:false},{title:"Data Analysis",active:false},]},{title:"Reports",ui_sref:"help.tutorial.reports",groups:[{title:"Design Guide",active:false},{title:"Statistical Tools",active:false},{title:"ARRIVE Supplement Form",active:false},{title:"ARRIVE Supplement Checklist",active:false},]}];$scope.designTypeContents=[{title:"Random Designs",groups:[{title:"Completely Randomized",html:"random.html",active:false}]},{title:"Block Designs",groups:[{title:"Randomized Block",html:"block_random.html",active:false},{title:"Incomplete Block",html:"block_incomplete.html",active:false},{title:"Crossover",html:"crossover.html",active:false},{title:"Latin Square",html:"latin.html",active:false},{title:"Matched Pair",html:"match_pair.html",active:false}]},{title:"Factorial Designs",groups:[{title:"Factorial",html:"factorial.html",active:false},{title:"Dose Response",html:"dose.html",active:false},{title:"Dose Escalation",html:"escalation.html",active:false}]},{title:"Hierarchical Designs",groups:[{title:"Nested",html:"nested.html",active:false},{title:"Split Plot",html:"split.html",active:false}]},{title:"Other Designs",groups:[{title:"Repeated Measures",html:"repeated.html",active:false},{title:"Sequential",html:"sequential.html",active:false}]},];function init()
{var tot_obj=[$scope.designTypeContents,$scope.caseStudiesContents,$scope.tutorialContents];var obj_ids=['types-','cases-','tut-'];for(var kk=0;kk<tot_obj.length;kk++)
{var tmp=0;var obj=tot_obj[kk];for(var ii=0;ii<obj.length;ii++)
{for(var jj=0;jj<obj[ii].groups.length;jj++){tmp++;obj[ii].groups[jj].id=obj_ids[kk]+tmp;}}}};init();$scope.clearAllActive=function(parent)
{for(var ii=0;ii<parent.length;ii++){for(var jj=0;jj<parent[ii].groups.length;jj++){parent[ii].groups[jj].active=false;}}};$scope.openAndMakeActive=function(group,parent)
{$scope.makeActive(group,parent);};$scope.makeActive=function(group,parent)
{var isActive=group.active;for(var ii=0;ii<parent.length;ii++)
{for(var jj=0;jj<parent[ii].groups.length;jj++){var g=parent[ii].groups[jj];g.active=false;}}
group.active=!isActive;var ID_NAME=group.id;if(!group.active)
ID_NAME="topLevel";$timeout(function(){var old=$location.hash();$location.hash(ID_NAME);$anchorScroll();$location.hash(old);},500);};};app.controller('basicsPlotCtrl',['$scope','$sce','$http','$timeout','plotsService',function($scope,$sce,$http,$timeout,plotsService){var ctrlColor="#1f77b4";var trtColor="#ff7f0e";$scope.helpService=plotsService.help;$scope.helpService.simPlotData={};$scope.effectSize_slider={value:0.05,options:{minLimit:0.05,maxLimit:2.0,floor:0.05,ceil:2,showTicksValues:true,draggableRange:false,ticksArray:[0.05,1.0,2.0],step:0.05,precision:2,onChange:function(){updatePlot();}}};$scope.nGroups_slider={value:3,options:{minLimit:2,maxLimit:8,floor:2,ceil:8,showTicksValues:1,draggableRange:false,step:1,precision:0,onChange:function(){updatePlot();}}};$scope.stdev_slider={value:1,options:{minLimit:0.4,maxLimit:2.0,floor:0.4,ceil:2,showTicks:true,draggableRange:false,step:0.2,precision:2,onChange:function(){updatePlot();}}};$scope.sampleSize_slider={value:5,options:{floor:2,ceil:30,minLimit:2,maxLimit:30,showTicksValues:true,ticksArray:[2,15,30],draggableRange:false,step:1,precision:0,onChange:function(){updatePlot();}}};$scope.sigLevel_slider={value:0.05,options:{floor:0.001,ceil:0.1,showTicks:true,showTicksValues:true,logScale:true,ticksArray:[0.001,0.005,0.01,0.05,0.1],draggableRange:false,step:0.001,precision:3,onChange:function(){updatePlot();}}};$scope.tMean1_slider={value:1,options:{floor:0,minLimit:0.1,ceil:4,showTicks:true,showTicksValues:true,draggableRange:false,step:0.1,ticksArray:[0,1,2,3,4],precision:1,onChange:function(){var origPlotType=$scope.plotType;$scope.plotType="ANOVAmeans";updatePlot();$scope.plotType=origPlotType;}}};$scope.tMean2_slider={value:2,options:{floor:0,minLimit:0.1,ceil:4,showTicks:true,showTicksValues:true,draggableRange:false,step:0.1,ticksArray:[0,1,2,3,4],precision:1,onChange:function(){var origPlotType=$scope.plotType;$scope.plotType="ANOVAmeans";updatePlot();$scope.plotType=origPlotType;}}};$scope.esMeanPlotOptions={chart:{type:'lineChart',height:350,margin:{top:30,right:60,bottom:50,left:70},color:d3.scale.category10().range(),x:function(d){return d.x;},y:function(d){return d.y;},duration:500,xAxis:{tickFormat:function(d){return d3.format(',.1f')(d);}},showYAxis:false,useInteractiveGuideline:false,tooltip:{enabled:false}}};$scope.esPlotOptions={chart:{type:'lineChart',height:350,margin:{top:30,right:60,bottom:50,left:70},color:d3.scale.category10().range(),x:function(d){return d.x;},y:function(d){return d.y;},duration:500,xAxis:{tickFormat:function(d){return d3.format(',.1f')(d);}},showYAxis:false,legend:{},useInteractiveGuideline:false,tooltip:{enabled:false}}};$scope.esPlotData=[];$scope.esAnovaData=[];$scope.powerPlotData=[];$scope.samplePlotData=[];$scope.sigPlotData=[];function changePlotDomains(arrsX,arrsY){function getMinVal(arr){var minval=arr[0];for(var ii=1;ii<arr.length;ii++){minval=(arr[ii]<minval)?arr[ii]:minval;}
return minval;};function getMaxVal(arr){var maxval=arr[0];for(var ii=1;ii<arr.length;ii++){maxval=(arr[ii]>maxval)?arr[ii]:maxval;}
return maxval;};var xmin=getMinVal(arrsX);var xmax=getMaxVal(arrsX);var ymin=getMinVal(arrsY);var ymax=getMaxVal(arrsY);ymax=ymax*1.5;$scope.esPlotOptions.chart.xDomain=[xmin,xmax];$scope.esPlotOptions.chart.yDomain=[ymin,ymax];return([xmin,xmax,ymin,ymax]);};function makeEsPlotData(x,y,x2,y2,zcrit,mean1,mean2)
{var siz1=x.length;var siz2=x2.length;var plotData=[];plotData.push({type:"line",color:ctrlColor,key:"Control",values:[]});plotData.push({type:"line",area:true,color:ctrlColor,key:"ControlArea",values:[]});plotData.push({type:"line",color:trtColor,key:"Treatment",values:[]});plotData.push({type:"line",area:true,color:trtColor,key:"TreatmentArea",values:[]});plotData[0].values=new Array(siz1);plotData[1].values=new Array(siz1);plotData[2].values=new Array(siz2);plotData[3].values=new Array(siz2);for(var ii=0;ii<x.length;ii++){var ytmp=((x[ii]<=-zcrit)||(x[ii]>=zcrit))?y[ii]:null;plotData[0].values[ii]={x:x[ii],y:y[ii]}
plotData[1].values[ii]={x:x[ii],y:ytmp};}
for(var ii=0;ii<x2.length;ii++){var ytmp=(x2[ii]>=zcrit)?y2[ii]:null;plotData[2].values[ii]={x:x2[ii],y:y2[ii]}
plotData[3].values[ii]={x:x2[ii],y:ytmp}}
var drange=changePlotDomains(x.concat(x2),y.concat(y2));var ymin=drange[2];var ymax=drange[3];plotData.push({type:"line",classed:'dashed',color:ctrlColor,key:"Control Mean",values:[{x:mean1,y:ymin},{x:mean1,y:ymax}]});plotData.push({type:"line",classed:'dashed',color:trtColor,key:"Treatment Mean",values:[{x:mean2,y:ymin},{x:mean2,y:ymax}]});return plotData;};function makeMeanAnovaPlotData(x,y0,y1,y2)
{var siz=x.length;var plotData=[];plotData.push({type:"line",color:"black",key:"Control",values:[]});plotData.push({type:"line",color:ctrlColor,key:"Treatment 1",values:[]});plotData.push({type:"line",color:trtColor,key:"Treatment 2",values:[]});plotData[0].values=new Array(siz);plotData[1].values=new Array(siz);plotData[2].values=new Array(siz);for(var ii=0;ii<siz;ii++)
{plotData[0].values[ii]={x:x[ii],y:y0[ii]};plotData[1].values[ii]={x:x[ii],y:y1[ii]};plotData[2].values[ii]={x:x[ii],y:y2[ii]};}
return plotData;}
function makeEsAnovaPlotData(x,y,x2,y2,fcrit)
{var siz1=x.length;var siz2=x2.length;var plotData=[];plotData.push({type:"line",color:"black",key:"Null",values:[]});plotData.push({type:"line",area:true,color:ctrlColor,key:"Type I Error",values:[]});plotData.push({type:"line",color:"red",key:"Alternative",values:[]});plotData.push({type:"line",area:true,color:trtColor,key:"Type II Error",values:[]});plotData[0].values=new Array(siz1);plotData[1].values=new Array(siz1);plotData[2].values=new Array(siz2);plotData[3].values=new Array(siz2);for(var ii=0;ii<x.length;ii++){var ytmp=(x[ii]>=fcrit)?y[ii]:null;plotData[0].values[ii]={x:x[ii],y:y[ii]};plotData[1].values[ii]={x:x[ii],y:ytmp};}
for(var ii=0;ii<x2.length;ii++){var ytmp=(x2[ii]>=fcrit)?y2[ii]:null;plotData[2].values[ii]={x:x2[ii],y:y2[ii]};plotData[3].values[ii]={x:x2[ii],y:ytmp};}
changePlotDomains(x.concat(x2),y.concat(y2));return plotData;};function makeSSPlotData(x,y,x2,y2,zcrit,mean1,mean2)
{var siz1=x.length;var siz2=x2.length;var plotData=[];plotData.push({type:"line",color:ctrlColor,key:"Null",values:[]});plotData.push({type:"line",showLegend:false,area:true,color:ctrlColor,key:"NullArea",values:[]});plotData.push({type:"line",color:trtColor,key:"Alternative",values:[]});plotData.push({type:"line",area:true,color:trtColor,key:"Power",values:[]});plotData[0].values=new Array(siz1);plotData[1].values=new Array(siz1);plotData[2].values=new Array(siz2);plotData[3].values=new Array(siz2);for(var ii=0;ii<x.length;ii++){var ytmp=((x[ii]>=-zcrit)&&(x[ii]<=zcrit))?null:y[ii];plotData[0].values[ii]={x:x[ii],y:y[ii]}
plotData[1].values[ii]={x:x[ii],y:ytmp};}
for(var ii=0;ii<x2.length;ii++){var ytmp=(x2[ii]>=zcrit)?y2[ii]:null;plotData[2].values[ii]={x:x2[ii],y:y2[ii]}
plotData[3].values[ii]={x:x2[ii],y:ytmp}}
changePlotDomains(x.concat(x2),y.concat(y2));return plotData;};function makePowerPlotData(x,y,y2,zcrit)
{var siz=x.length;var plotData=[];plotData.push({type:"line",color:ctrlColor,key:"Null",values:[]});plotData.push({type:"line",color:"black",key:"Alternative",values:[]});plotData.push({type:"line",area:true,color:trtColor,key:"Power",values:[]});plotData.push({type:"line",area:true,color:"#6dc173",key:"Type I Error",values:[]});plotData[0].values=new Array(siz);plotData[1].values=new Array(siz);plotData[2].values=new Array(siz);plotData[3].values=new Array(siz);for(var ii=0;ii<x.length;ii++){var ytmp2=(x[ii]<=zcrit)?null:y[ii];var ytmp=(x[ii]>=-zcrit&&x[ii]<=zcrit)?null:y[ii];var pwrArea=(x[ii]<=zcrit)?null:y2[ii];plotData[0].values[ii]={x:x[ii],y:y[ii]}
plotData[1].values[ii]={x:x[ii],y:y2[ii]}
plotData[3].values[ii]={x:x[ii],y:ytmp};plotData[2].values[ii]={x:x[ii],y:pwrArea};}
changePlotDomains(x,y);return plotData;};function makeSigPlotData(x,y,zcrit)
{var siz=x.length;var plotData=[];plotData.push({type:"line",color:ctrlColor,key:"Distribution",values:[]});plotData.push({type:"line",area:true,color:"#6dc173",key:"Two-Tailed",values:[]});plotData.push({type:"line",area:true,color:"#778899",key:"One-Tailed",values:[]});plotData[0].values=new Array(siz);plotData[1].values=new Array(siz);plotData[2].values=new Array(siz);for(var ii=0;ii<x.length;ii++){var ytmp1=(x[ii]>=zcrit[1])?y[ii]:null;var ytmp2=((x[ii]>=zcrit[0])||(x[ii]<=-zcrit[0]))?y[ii]:null;plotData[0].values[ii]={x:x[ii],y:y[ii]}
plotData[1].values[ii]={x:x[ii],y:ytmp1};plotData[2].values[ii]={x:x[ii],y:ytmp2};}
changePlotDomains(x,y);return plotData;};$scope.meanAnovaOutput={effectSize:0,pairDiffs:[0,0,0]};function updatePlot()
{var tmp={es:$scope.effectSize_slider.value,ss:$scope.sampleSize_slider.value,stdev:$scope.stdev_slider.value,sig:$scope.sigLevel_slider.value,nGroups:$scope.nGroups_slider.value,mean1:$scope.tMean1_slider.value,mean2:$scope.tMean2_slider.value,id:$scope.simPlotID,type:$scope.plotType};$http({method:'POST',url:'/tools_demos',data:tmp,headers:{'Content-Type':'application/json'},}).then(function successCallback(response){var data=response.data;$scope.helpService.simPlotData=data;if(tmp.type=="effectSize"){$scope.esPlotData=makeEsPlotData(data.x,data.y,data.x2,data.y2,data.tCrit[0],data.m1,data.m2);$scope.powerVal=data.powerVal[0];}
if(tmp.type=="effectSizeANOVA"){$scope.esAnovaPlotData=makeEsAnovaPlotData(data.x,data.y,data.x2,data.y2,data.fCrit[0]);$scope.powerVal=data.powerVal[0];}
if(tmp.type=="ANOVAmeans"){$scope.meanAnovaPlotData=makeMeanAnovaPlotData(data.x0,data.y0,data.y1,data.y2);$scope.meanAnovaOutput={effectSize:data.es,pairDiffs:[data.d10,data.d12,data.d20]};}
if(tmp.type=="sampleSize"){$scope.samplePlotData=makeSSPlotData(data.x,data.y,data.x2,data.y2,data.tCrit[0],data.m1,data.m2);$scope.powerVal=data.powerVal[0];}
if(tmp.type=="power"){$scope.powerPlotData=makePowerPlotData(data.x,data.y,data.y2,data.tCrit[0]);$scope.powerVal=data.powerVal[0];}
if(tmp.type=="sigLevel"){$scope.sigPlotData=makeSSPlotData(data.x,data.y,data.x2,data.y2,data.tCrit[0],data.m1,data.m2);$scope.powerVal=data.powerVal[0];}
if(tmp.type=="stdev"){$scope.stdevPlotData=makeSSPlotData(data.x,data.y,data.x2,data.y2,data.tCrit[0],data.m1,data.m2);$scope.powerVal=data.powerVal[0];}},function errorCallback(response){console.log(response);});};$scope.initPlotType=function(str)
{$scope.nGroups_slider.value=2;$scope.simPlotID=8;if(str=="power"){$scope.sampleSize_slider.value=6;$scope.effectSize_slider.value=1;$scope.stdev_slider.value=1;$scope.sigLevel_slider.value=0.05;}
if(str=="sampleSize")
{$scope.effectSize_slider.value=0.5;}
if(str=="effectSize"){$scope.effectSize_slider.value=1;}
if(str=="effectSizeANOVA"){$scope.simPlotID=1;$scope.effectSize_slider.value=1;$scope.sampleSize_slider.value=6;$scope.stdev_slider.value=1;$scope.nGroups_slider.value=3;$scope.sigLevel_slider.value=0.05;}
$scope.plotType=str;updatePlot();};}]);'use strict';app.controller('helpEffectController',['$scope','$location','$anchorScroll','$timeout','$state',function($scope,$location,$anchorScroll,$timeout,$state)
{$scope.cohenF=[{fval:1.0,stdev:0.05,nLevels:2,effectSize:0,calc:function(){var tmp=$scope.cohenF[0];var nLevels=1.0*tmp.nLevels;tmp.effectSize=tmp.stdev*tmp.fval*Math.sqrt(nLevels/(nLevels-1));}},{fval:1.0,stdev:0.05,nLevels:[2,2],effectSize:0,calc:function(){var tmp=$scope.cohenF[1];var nLevels=tmp.nLevels;var fac=Math.sqrt((nLevels[0]*nLevels[1])/((nLevels[0]-1)*(nLevels[1]-1)));tmp.effectSize=tmp.stdev*tmp.fval*fac;}},{fval:1.0,stdev:0.05,nLevels:[2,2,2],effectSize:0,calc:function(){var tmp=$scope.cohenF[2];var nLevels=tmp.nLevels;var fac=Math.sqrt((nLevels[0]*nLevels[1]*nLevels[2])/((nLevels[0]-1)*(nLevels[1]-1)*(nLevels[2]-1)));tmp.effectSize=tmp.stdev*tmp.fval*fac;}},];$scope.cohenD={dval:1.0,stdev:0.1,effectSize:10};$scope.cohenD_calc=function(){$scope.cohenD.effectSize=$scope.cohenD.dval*$scope.cohenD.stdev;};function ctlInit(){$scope.cohenD_calc();for(var ii=0;ii<$scope.cohenF.length;ii++){$scope.cohenF[ii].calc();}};ctlInit();}]);app.controller('helpToolsController',['$scope','$location','$anchorScroll','$timeout','$state','calculatorService',function($scope,$location,$anchorScroll,$timeout,$state,calculatorService)
{$scope.calculator=calculatorService;$scope.datum={esMeanAOV:[{group:1,mean:20,placeholder:12.5},{group:2,mean:10,placeholder:12.5},],};function roundToFixed(varname)
{var fixedDigits=3;return varname.toFixed(fixedDigits);};$scope.TtestMean1=10;$scope.TtestMean2=20;$scope.TtestEffectCalc=function(m1,m2){$scope.calculator.data.esMean=roundToFixed(Math.abs(m1-m2));};$scope.TtestSD1=5;$scope.TtestSD2=5;$scope.TtestSDCalc=function(sd1,sd2){var num=Math.pow(sd1,2)+Math.pow(sd2,2);$scope.calculator.data.esSD=roundToFixed(Math.sqrt(num/2));};$scope.AovSDCalc=function(){var numer=0;for(var i=0;i<$scope.calculator.data.groups;i++){var working=$scope.calculator.sdAOV[i].df*$scope.calculator.sdAOV[i].s2;var numer=numer+working;}
var denom=$scope.calculator.data.samplesize-$scope.calculator.data.groups;$scope.calculator.data.esSD_AOV_TEMP=roundToFixed(numer/denom);};$scope.AovSDCalc_change=function(){$scope.calculator.data.esSD_AOV=roundToFixed($scope.calculator.data.esSD_AOV_TEMP);};$scope.effectAOV_lowMean=10;$scope.effectAOV_highMean=20;$scope.AOVmeanHighLow=function(){var diff=$scope.effectAOV_highMean-$scope.effectAOV_lowMean;var numer=(1/$scope.calculator.data.groups)*Math.pow(diff,2);var denom=2*Math.pow($scope.calculator.data.esSD_AOV,2);var ans=Math.sqrt(numer/denom);$scope.calculator.data.esRel=roundToFixed(ans);$scope.calculator.data.esTest='effectRel';};$scope.SSres=10;$scope.SStot=20;$scope.R2calc=function(){$scope.calculator.data.esR2=roundToFixed(1-($scope.SSres/$scope.SStot));};function updateGroups()
{var nGroups_old=$scope.datum.esMeanAOV.length;var nGroups_new=$scope.calculator.data.groups;var change=nGroups_new-nGroups_old;if(change>0){for(var i=nGroups_old;i<nGroups_new;i++){var newGroup={group:i+1,mean:10,placeholder:null};$scope.datum.esMeanAOV.push(newGroup);var newGroup2={group:i+1,df:6,s2:20};$scope.calculator.sdAOV.push(newGroup2);}}else if(change<0){if(nGroups_old==2){return;}else if(nGroups_old-change<2){return;}else{$scope.datum.esMeanAOV.splice(nGroups_new,Math.abs(change));$scope.calculator.sdAOV.splice(nGroups_new,Math.abs(change));}}
var numer=0;for(var i=0;i<$scope.calculator.data.groups;i++){var working=$scope.calculator.sdAOV[i].df*$scope.calculator.sdAOV[i].s2;var numer=numer+working;}
var denom=$scope.calculator.data.samplesize-$scope.calculator.data.groups;$scope.calculator.data.esSD_AOV_TEMP=roundToFixed(numer/denom);};$scope.$watch('calculator.data.groups',function(newVal,oldVal)
{updateGroups();});}]);app.controller('ContactForm',['$scope','$http','$timeout',function($scope,$http,$timeout){$scope.send_status=0;$scope.formData={name:'',email:'',phone:'',message:''};resetFormData=function()
{$scope.formData={name:'',email:'',phone:'',message:''};};$scope.submit=function()
{var data=$scope.formData;$scope.send_status=1;$http({method:'POST',url:'/contact',headers:{'Content-Type':'application/json'},data:data}).then(function successCallback(response){$scope.contactinfo=response.data},function errorCallback(response){});resetFormData();$scope.send_status=2
$timeout(function(){$scope.send_status=0},5000);};}]);"use strict";app.controller("reportsController",["$scope","$rootScope","$state","designService","authService","$timeout","$uibModal",reportsController]);function reportsController($scope,$rootScope,$state,designService,authService,$timeout,$uibModal){$scope.sqlprojects=authService.sqlprojects;$scope.DGcompleted=designService.DGcompleted;$scope.projectChange=function(){authService.subProjectSelected=$scope.sqlprojects.selected.subs[0];};$scope.dataExists=function(){var subProj=authService.subProjectSelected;var subProjExists=(subProj!==null)&&(subProj!==undefined);return(authService.sqlprojects.selected&&subProj);};function get_rand_string_tools(){var currentDate=new Date();var rand_string=currentDate.getDate()+""+currentDate.getMonth()+""+
currentDate.getFullYear()+""+currentDate.getHours()+""+currentDate.getMinutes()+""+currentDate.getSeconds();rand_string="?v="+rand_string;if($scope.dataExists()){var tableName="";if(authService.subProjectSelected){tableName=authService.subProjectSelected.table;if(tableName=="graph"){tableName+="&rowid="+authService.subProjectSelected.rowid;}else{tableName+="&rowid=None";}}
rand_string+="&user_id="+authService.user_id+"&project="+
authService.sqlprojects.selected.name+"&table="+tableName;}
return rand_string;};$scope.tools_report_url="";$scope.getToolsReport=function(){if($scope.dataExists())
$scope.tools_report_url=$rootScope.trustSrc("/toolsPDF"+get_rand_string_tools());else
$scope.tools_report_url=$rootScope.trustSrc("/static/img/arrive/blank.pdf");};$scope.spin_status=0;$scope.spin=function(){$scope.spin_status=100;$timeout(function(){$scope.spin_status=0;},2500);};}
'use strict';app.controller('reportSupplementController',['$scope','$rootScope','$state','$http','designService','$timeout','$uibModal',reportSupplementController]);function reportSupplementController($scope,$rootScope,$state,$http,designService,$timeout,$uibModal)
{$scope.swipe_class={name:'swipe-views swipe-views-left'};$scope.changeSwipeClass=function(step){if(step>$scope.step.current){$scope.swipe_class.name="swipe-views swipe-views-right";}else if(step<$scope.step.current){$scope.swipe_class.name="swipe-views swipe-views-left";}};$scope.step={current:0};$scope.setStep=function(step){$scope.step.current=step;};$scope.stepUp=function(){$scope.setStep($scope.step.current+1);};$scope.stepDown=function(){$scope.setStep($scope.step.current-1);};$scope.formData={abstractElements:[{name:"Short summary of the background highlighting the importance of this research",id:0,selected:0},{name:"Research objective",id:1,selected:0},{name:"Species used",id:2,selected:0},{name:"Key methods",id:3,selected:0},{name:"Principal findings",id:4,selected:0},{name:"Conclusions of the study",id:5,selected:0},],title:[],authors:[],methods:{ethicalStatement:[],experimentalGroups:{selected:0,n:[1,2,3,4,5]},controlGroups:{selected:0,n:[1,2,3,4,5]},bias:[{name:"Randomization",id:0,selected:0},{name:"Blinding",id:1,selected:0},],outMeas:designService.formData.outMeas,expProcedures:[{content:null,name:"Drug Formulation"},{content:null,name:"Drug Dosage"},{content:null,name:"Site of Drug Administration"},{content:null,name:"Route of Drug Administration"},{content:null,name:"Anesthesia and/or Analgesia used"},{content:null,name:"Surgical Procedure(s) used"},{content:null,name:"Method of Euthanasia"},{content:null,name:"Time of Day procedure was carried out at"},{content:null,name:"Location procedure was carried out at"},{content:null,name:"Further explanation (if necessary)"},],expSubject:[{content:null,name:"Species Used"},{content:null,name:"Strain Used"},{content:null,name:"Sex"},{content:null,name:"Developmental Stage or Age"},{content:null,name:"Weight"},{content:null,name:"Source of Subjects"},{content:null,name:"International Strain Nomenclature"},{content:null,name:"Genetic Modification Status"},{content:null,name:"Genotype"},{content:null,name:"Health/Immune Status"},{content:null,name:"Drug or Test Naive"},{content:null,name:"Previous Procedures"},{content:null,name:"Other"},],housingHusbandry:[{content:null,name:"Housing"},{content:null,name:"Breeding Program"},{content:null,name:"Light/Dark Cycle"},{content:null,name:"Temperature"},{content:null,name:"Food"},{content:null,name:"Environmental Enrichment"},{content:null,name:"Other"},{content:null,name:"Welfare Related Assessments"},],sampleSize:{totalSubjects:null,totalSubjectsExpl:null,},allocation:{how:null,order:null,},},results:{numbersAnalyzed:[{content:null,name:"How many animals were included in the final analysis?"},{content:null,name:"How many animals were not included?"},{content:null,name:"Why?"},],outcomes:[{content:null,name:"Report the results for each analysis carried out, with a measure of precision",placeholder:"e.g. standard error or confidence interval",}],reportTypes:{selected:0,options:[{name:"Percentage",id:0},{name:"Exact Number",id:1},{name:"Standard Deviation",id:2},{name:"Standard Error",id:3},{name:"Sample Mean",id:4},{name:"Median",id:5},],},adverseEvents:[{content:null,name:"Give details of all important adverse events in each experimental group"},{content:null,name:"Describe any modifications to the experimental protocols made to reduce adverse events"},],},stats:[{content:null,placeholder:null,name:"Provide details of the statistical tests used for each analysis"},{content:null,name:"Specify the unit of analysis for each dataset",placeholder:"e.g. single animal, group of animals, single neuron"},{content:null,placeholder:null,name:"Describe any methods used to assess whether the data met the assumptions of the statistical approach"},],discussion:{interpret:[{content:null,name:"Interpret the results, taking into account the study objectives and hypotheses, current theory and other relevant studies in the literature"},{content:null,name:"Comment on the study limitations including any potential sources of bias, any limitations of the animal model, and the imprecision associated with the results"},{content:null,name:"Describe any implications of your experimental methods or findings for the replacement, refinement or reduction (the 3Rs) of the use of animals in research"},],},};$scope.buttonClick={wait:false};$scope.genReport=function(file_extension)
{$http({method:'POST',url:'/compute_latex',headers:{'Content-Type':'application/json'},data:$scope.formData}).then(function successCallback(response){var filename=response.data.result;console.log(filename);console.log('download successful')
$scope.buttonClick.wait=false;window.location.replace('/download=ARRIVE'+file_extension);},function errorCallback(response){});};};function errorWholeNumber(number)
{if(number=='undefined'){return false;}else if(number%1==0){return false;}else if(number%1!=0){return true;}};function generateCombinations(n)
{function getPermutations(array,size){function p(t,i){if(t.length===size){result.push(t);return;}
if(i+1>array.length){return;}
p(t.concat(array[i]),i+1);p(t,i+1);}
var result=[];p([],0);return result;}
var array=Array(n);for(var ii=0;ii<n;ii++)
array[ii]=ii+1;var combVec=[];for(var ii=0;ii<n;ii++)
{var tmp=getPermutations(array,ii+1);combVec.push(tmp);}
return combVec;};(function(){'use strict';angular.module('tempestApp').service('calculatorService',['designService',calculatorService]);function calculatorService(designService){this.calculateComplete=true;this.calcData={},this.data={tool:null,test:null,sig:0.05,pow:0.80,samplesize:20,es:null,groups:2,esRel:0.50,esR2:0.5,esMean:2.5,esSD:5,esSD_AOV:5,esComb:{index:[],effect:[5]},treatmentsTotal:2,treatmentsTotalRM:1,wsSD_RM:5,bsSD_RM:5}
this.arraySum=function(arr){var s=0;for(var ii=0;ii<arr.length;ii++){s+=arr[ii];}
return s;};this.treatments=[{treatment:1,levels:2,description:null,es:5},{treatment:2,levels:3,description:null,es:6},{treatment:3,levels:4,description:null,es:7},],this.AOV2={tool:null,test:null,sig:null,df2:null,lambda:null,dfM:null,dfS:null,dfI:null,pow:null,k:null,es:null,};this.RMPS1={tool:null,test:null,sig:null,df1:null,df2:null,lambda:null,pow:null,es:null,esMultiple:0,k:null};this.RMCS1={tool:null,test:null,sig:null,df1:null,df2:null,lambda:null,pow:null,es:null,k:null,};this.AOVmulti={tool:null,test:null,sig:null,df2:null,k:null,es:null,lambda:[],df1:[]};this.AOV2calc=function()
{this.AOV2.esSD_AOV=this.data.esSD_AOV;this.AOV2.esMean=this.data.esMean;this.AOV2.groups=this.data.groups;this.AOV2.tool=this.data.tool;this.AOV2.sig=this.data.sig;this.AOV2.k=this.treatments[0].levels*this.treatments[1].levels;this.AOV2.dfM=this.treatments[0].levels-1;this.AOV2.dfS=this.treatments[1].levels-1;this.AOV2.dfI=(this.treatments[0].levels-1)*(this.treatments[1].levels-1);var es2=Math.pow(this.data.es,2);this.AOV2.lambda=[0,0,0];this.AOV2.lambda[0]=es2*this.AOV2.dfM*this.treatments[1].levels;this.AOV2.lambda[1]=es2*this.AOV2.dfS*this.treatments[0].levels;this.AOV2.lambda[2]=es2*this.AOV2.dfM*this.AOV2.dfS;if(this.AOV2.tool=='samplesize'){this.AOV2.pow=this.data.pow;this.AOV2.es=this.data.es;}
else if(this.AOV2.tool=='power')
{this.AOV2.df2=(this.data.samplesize-1)*this.AOV2.k;for(var ii=0;ii<this.AOV2.lambda.length;ii++){this.AOV2.lambda[ii]=this.AOV2.lambda[ii]*this.data.samplesize;}}};this.AOVmultiCalc=function(combValues)
{this.AOVmulti.esSD_AOV=this.data.esSD_AOV;this.AOVmulti.esMean=this.data.esMean;this.AOVmulti.groups=this.data.groups;this.AOVmulti.tool=this.data.tool;this.AOVmulti.sig=this.data.sig;var df1=combValues;this.AOVmulti.k=this.treatments[0].levels;for(var ii=1;ii<this.data.treatmentsTotal;ii++){this.AOVmulti.k=this.AOVmulti.k*this.treatments[ii].levels;}
var es2_k=Math.pow(this.data.es,2)*this.AOVmulti.k;var df1wk=new Array(df1.length);var lambda=new Array(df1.length);for(var ii=0;ii<df1.length;ii++)
{var tmp=1,tmp2=1;for(var jj=0;jj<df1[ii].length;jj++)
{var ind=df1[ii][jj]-1;tmp=tmp*(this.treatments[ind].levels-1)
tmp2=tmp2*(this.treatments[ind].levels)}
df1wk[ii]=tmp;lambda[ii]=es2_k*df1wk[ii]/tmp2;}
this.AOVmulti.df1=df1wk;this.AOVmulti.lambda=lambda;if(this.AOVmulti.tool=='samplesize'){this.AOVmulti.pow=this.data.pow;}
else if(this.AOVmulti.tool=='power')
{this.AOVmulti.df2=(this.data.samplesize-1)*this.AOVmulti.k;for(var ii=0;ii<lambda.length;ii++)
{lambda[ii]=this.data.samplesize*lambda[ii];}
this.AOVmulti.lambda=lambda;}};this.RMPS1calc=function(effectSize,indices)
{this.RMPS1.tool=this.data.tool;this.RMPS1.sig=this.data.sig;this.RMPS1.bsSD_RM=this.data.bsSD_RM;this.RMPS1.wsSD_RM=this.data.wsSD_RM;var siz=indices.length;var df1=new Array(siz);var df2=new Array(siz);var lambda=new Array(siz);var nTime=this.treatments[0].levels;var trtProd=1.0;this.data.treatmentsTotal=this.data.treatmentsTotalRM+1;for(var jj=1;jj<this.data.treatmentsTotal;jj++)
trtProd=trtProd*this.treatments[jj].levels;this.RMPS1.trtProd=trtProd;var wsSD_2=Math.pow(this.data.wsSD_RM,2);var bsSD_2=Math.pow(this.data.bsSD_RM,2);for(var ii=0;ii<indices.length;ii++){df1[ii]=1.0;df2[ii]=trtProd/this.treatments[0].levels;var timeInter=false;lambda[ii]=trtProd;for(var jj=0;jj<indices[ii].length;jj++){var ndx=indices[ii][jj]-1;var nLevels=this.treatments[ndx].levels
timeInter=(timeInter)||(ndx==0);df1[ii]=df1[ii]*(nLevels-1);lambda[ii]=lambda[ii]*(nLevels-1)/nLevels;}
var denom=wsSD_2+nTime*bsSD_2;if(timeInter){denom=wsSD_2;df2[ii]=df2[ii]*(this.treatments[0].levels-1);}
var ind=0;if(this.RMPS1.esMultiple)
ind=ii;lambda[ii]=lambda[ii]*Math.pow(effectSize[ind],2)/denom;}
if(this.RMPS1.tool=='samplesize'){this.RMPS1.pow=this.data.pow;}
else if(this.RMPS1.tool=='power'){var ss=this.data.samplesize;var ss1=(this.data.samplesize-1);for(var ii=0;ii<lambda.length;ii++){lambda[ii]=ss*lambda[ii];df2[ii]=ss1*df2[ii];}}
this.RMPS1.k=df2;this.RMPS1.df1=df1;this.RMPS1.df2=df2;this.RMPS1.lambda=lambda;this.RMPS1.esComb=this.data.esComb;};this.RMCS1calc=function()
{this.RMCS1.treatmentsTotal=this.data.treatmentsTotalRM;this.RMCS1.tool=this.data.tool;this.RMCS1.sig=this.data.sig;this.RMCS1.wsSD_RM=this.data.wsSD_RM;var nLevels=this.treatments[0].levels;var wsSD_2=Math.pow(this.data.wsSD_RM,2);var es_2=Math.pow(this.data.esMean,2);var df1=nLevels-1;var lambda=nLevels*(nLevels-1)*(es_2/wsSD_2);if(this.RMCS1.tool=='samplesize'){this.RMCS1.pow=this.data.pow;this.RMCS1.k=nLevels;}
else if(this.RMCS1.tool=='power'){var ss=this.data.samplesize;lambda=ss*lambda;this.RMCS1.df2=(nLevels-1)*(ss*nLevels-1);}
this.RMCS1.df1=df1;this.RMCS1.lambda=lambda;this.RMCS1.esMean=this.data.esMean;this.RMCS1.groups=this.treatments[0].levels;};this.effectCalc2=function(id,esMean)
{var es=1;if(id==3||id==8||id==4){es=esMean/this.data.esSD;}else if(id==7||id==2){es=(esMean/this.data.esSD_AOV);}else if(id==1){es=esMean/this.data.esSD_AOV;}else if(id==6){es=this.data.R2/(1-this.data.R2);}else if(id==12){es=esMean/this.data.wsSD_RM;}else if(0){es=1;}
return es;};this.effectCalc2_inv=function(id,es)
{var esMean=es;if(id==3||id==8||id==4){esMean=es*this.data.esSD;}else if(id==7||id==2){esMean=es*this.data.esSD_AOV;}else if(id==1){esMean=es*this.data.esSD_AOV;}else if(id==12){esMean=es*this.data.wsSD_RM;}else if(0){esMean=1;}
return esMean;};this.effectCalc=function(id)
{this.data.es=this.effectCalc2(id,this.data.esMean);};this.RMcomb_reset=function()
{this.data.esComb={index:[],effect:[5]};};this.genCombinations=function(n)
{if(typeof(n)=='undefined')
n=this.data.treatmentsTotal;var tmp=generateCombinations(n);var v=[];for(var ii=0;ii<tmp.length;ii++)
v=v.concat(tmp[ii]);return v;};this.generateEffectCombo=function(RMcomb,n)
{if(!RMcomb){RMcomb={index:[],effect:[5]};}
RMcomb.index=this.genCombinations(n);var curSiz=RMcomb.effect.length;var newSiz=RMcomb.index.length;if(curSiz<=newSiz){for(var ii=curSiz;ii<newSiz;ii++)
RMcomb.effect.push(RMcomb.effect[0]);}else{for(var ii=curSiz;ii>newSiz;ii--)
RMcomb.effect.pop();}
return RMcomb;};this.updateTreatments=function()
{var designStatSelected=designService.stat.selectedOption;this.data.treatmentsTotal=Number(this.data.treatmentsTotal);this.data.treatmentsTotalRM=Number(this.data.treatmentsTotalRM);var treatmentsTotal=this.data.treatmentsTotal;var RMflag=(designService.isRMPS1());if(RMflag)
{treatmentsTotal=this.data.treatmentsTotalRM+1;}
var treatmentError=errorWholeNumber(treatmentsTotal);if(treatmentError)
return treatmentError;treatmentError=false;if(RMflag||designService.isANOVAm())
{var tmp=[];if(this.data.tool=='samplesize')
{tmp=designStatSelected.sample_items;}else
{tmp=designStatSelected.power_items;}
tmp=tmp[tmp.length-1].treatments;var nFactors=tmp.length;var toAdd=treatmentsTotal-nFactors;var disabled=tmp[0].disabled;if(toAdd<0){for(var ii=toAdd;ii<0;ii++)
tmp.pop();}
else if(toAdd>0){for(var ii=0;ii<toAdd;ii++)
{var ndx=nFactors+ii;var newEl={"label":"No. of Levels in Factor "+(ndx+1),"min":2,"max":20,"step":1,"click":"","model":"calculator.treatments["+ndx+"].levels","disabled":disabled,"tooltip":"'Select the total number of groups in each Effect (a Treatment or Factor).'","tooltip_link":"standalone.groups"};tmp.push(newEl);}}
for(var ii=0;ii<treatmentsTotal;ii++)
{tmp[ii].label="No. of Levels in Factor "+(ii+1);}
if(RMflag)
{this.data.esComb=this.generateEffectCombo(this.data.esComb,treatmentsTotal);tmp[0].label="Number of Time Points"
for(var ii=1;ii<treatmentsTotal;ii++)
{tmp[ii].label="No. of Levels in Factor "+ii;}}}
var nGroups_old=this.treatments.length;var nGroups_new=treatmentsTotal;var change=nGroups_new-nGroups_old;if(change>0){for(var i=1;i<=change;i++){var newGroup={treatment:nGroups_old+i,levels:2,description:null};this.treatments.push(newGroup);}}else if(change<0){if(nGroups_old==3)
return;if(nGroups_old-change<3)
return;this.treatments.splice(nGroups_new,Math.abs(change));}
return treatmentError;};this.resetDG=function()
{var formData=designService.formData;var effectSize=Number(formData.effectSize);var stdev=Number(formData.stdev);if(!(effectSize==null||effectSize=='')){this.data.esMean=effectSize;if(designService.isRMPS1()){}}
if(!(stdev==null||stdev==''))
{if(designService.isANOVA1()||designService.isANOVA2()||designService.isANOVAm()){this.data.esSD_AOV=stdev;}else{this.data.esSD=stdev;}}
var repMeas=Number(formData.repMeas.checked);var nTreatments=formData.treatments.length;var nFactors=formData.factors.length;this.data.groups=designService.numGroups;this.data.treatmentsTotal=nTreatments+nFactors+repMeas;this.data.treatmentsTotalRM=this.data.treatmentsTotal-1;var treatmentError=this.updateTreatments();if(repMeas){if(designService.isRMPS1())
{this.data.treatmentsTotalRM=this.data.treatmentsTotal-1;this.treatments[0].levels=Number(formData.repMeas.timePts);this.treatments[0].description='Time';this.treatments[0].es=Number(formData.repMeas.checkboxes.measDiffOverTime.esSm);this.data.wsSD_RM=Number(formData.repMeas.withinSD);this.data.bsSD_RM=Number(formData.repMeas.betweenSD);}
else if(designService.isRMCS1())
{this.treatments[0].levels=Number(formData.treatments[0].level.length+1);this.treatments[0].description=formData.treatments[0].description;this.data.wsSD_RM=Number(formData.repMeas.withinSD);this.data.bsSD_RM=Number(formData.repMeas.betweenSD);}}
for(var i=0;i<nTreatments;i++){var ndx=i+repMeas;var newLevel=formData.treatments[i].level.length+1;var desc=formData.treatments[i].description;var trt_tmp=this.treatments[ndx];trt_tmp.levels=newLevel;trt_tmp.description=desc;trt_tmp.es=Number(5+i);}
for(var i=0;i<nFactors;i++){var newLevel=formData.factors[i].level.length;var ndx=i+repMeas+nTreatments;var trt_tmp=this.treatments[ndx];trt_tmp.levels=newLevel;trt_tmp.description=formData.factors[i].description;}
return treatmentError;};}})();"use strict";app.controller("toolsController",["$scope","designService","calculatorService","$http","$q","$uibModal","$timeout",toolsController]);function toolsController($scope,designService,calculatorService,$http,$q,$uibModal,$timeout){$scope.toolsPath="/static/partials/webpage_tools/";$scope.esTooltip={content:"This is <u>NOT</u> Cohen's D effect size. Click the help (?) for more details.",enabled:function(item_label){var isEffectSizeInp=(item_label=="Effect Size");return isEffectSizeInp;},};$scope.design=designService;$scope.$watch("design.stat.selectedOption",function(){$scope.reset($scope.calculator.data.tool,"selected option change reset");});$scope.calculator=calculatorService;$scope.anyError={tf:false};$scope.groupError=false;$scope.treatmentError=false;$scope.anyError.msg="";$scope.AOVMcomb={values:[],display:[]};$scope.empty=function(){};$scope.childFunction=$scope.empty;$scope.register=function(tmp){$scope.childFunction=tmp;$scope.reset();};designService.notEmbedded=true;$scope.reset=function(toolType,tmp)
{if(tmp){}
$scope.calculator=calculatorService;if(typeof(toolType)!=="undefined")
$scope.calculator.data.tool=toolType;if($scope.state.current.name=="tools.powersize"){$scope.calculator.data.tool="power";}else if($scope.state.current.name=="tools.samplesize"){$scope.calculator.data.tool="samplesize";}else{$scope.childFunction();}
if($scope.design.isANOVAm()){$scope.calculator.data.treatmentsTotal=3;$scope.calculator.data.groups=3;}else if($scope.design.isANOVA2()){$scope.calculator.data.treatmentsTotal=2;$scope.calculator.data.groups=2;}else if($scope.design.isRMPS1()||$scope.design.isRMCS1()){$scope.calculator.data.treatmentsTotal=1;}
if($scope.design.DGcompleted==true){calculatorService.resetDG();}else{calculatorService.data.esComb={index:[],effect:[5]};}
if($scope.calculator.data.tool=="power"){$scope.calculator.data.samplesize=10;}else if($scope.calculator.data.tool=="samplesize"){$scope.calculator.data.pow=0.8;}
$scope.anyError.tf=false;return $scope.calculate();};$scope.resetToDG=function(){console.log("resetting to DG data");calculatorService.resetDG();};$scope.$watch("design.statMethod",function(){if(designService.DGcompleted==true){calculatorService.resetDG();}else{return;}});function updateGroups(){var isgroupError=errorWholeNumber($scope.calculator.data.groups);if(isgroupError==true){$scope.groupError=true;}else if(isgroupError==false){$scope.groupError=false;}};$scope.$watch("calculator.data.groups",function(newVal,oldVal){updateGroups();});function doCalc(data){return $http({method:"POST",url:"/calculate",headers:{"Content-Type":"application/json"},data:data}).then(function successCallback(response){if(response.data.error){$scope.anyError.tf=true;$scope.anyError.msg=response.data.msg;return;}
if(data.tool=="samplesize"){$scope.calculator.data.totalNGroups=$scope.nGroupsForCalcDisplay;$scope.calculator.data.samplesize=response.data.value;$scope.calculator.data.samplesizePD=response.data.valueDunnett;$scope.calculator.data.samplesizePT=response.data.valueTukey;$scope.calculator.data.power=response.data.power;$scope.calculator.data.powerPD=response.data.powerDunnett;$scope.calculator.data.powerPT=response.data.powerTukey;$scope.calculator.data.warn=response.data.warning;$scope.calculator.data.warnPD=response.data.warnDunnett;$scope.calculator.data.warnPT=response.data.warnTukey;}else if(data.tool=="power"){$scope.calculator.data.pow=response.data.value;$scope.calculator.data.powPD=response.data.valueDunnett;$scope.calculator.data.powPT=response.data.valueTukey;}},function errorCallback(response){});};$scope.calculate=function(){var deferred=$q.defer();if($scope.design.isNone()){deferred.resolve();return deferred.promise;}
$scope.anyError.tf=false;if($scope.state.current.name=="tools.powersize"){$scope.calculator.data.tool="power";if(errorWholeNumber($scope.calculator.data.samplesize)){$scope.anyError.tf=true;$scope.anyError.msg="Sample size must be a whole number";}}else if($scope.state.current.name=="tools.samplesize"){$scope.calculator.data.tool="samplesize";}
$scope.treatmentError=$scope.calculator.updateTreatments();updateGroups();$scope.calculator.effectCalc($scope.design.stat.selectedOption.id);var isError=false;var data=$scope.calculator.data;if($scope.design.isNone()){return;}else if($scope.design.isANOVA2()){$scope.calculator.AOV2calc();$scope.AOVMcomb.values=calculatorService.genCombinations();data=$scope.calculator.AOV2;if($scope.groupError==true||$scope.treatmentError==true||!data.tool||!data.dfM||!data.dfI||!data.dfS||!data.sig){isError=true;console.log("err1");}
if($scope.calculator.data.tool=="samplesize"&&(!data.k||!data.es||!data.pow)){isError=true;console.log("err2");}
if($scope.calculator.data.tool=="power"&&(!data.df2||!data.lambda)){isError=true;console.log("err3");}}else if($scope.design.isANOVAm()){$scope.AOVMcomb.values=calculatorService.genCombinations();$scope.calculator.AOVmultiCalc($scope.AOVMcomb.values);data=$scope.calculator.AOVmulti;if($scope.groupError==true||$scope.treatmentError==true||!data.tool||!data.df1){isError=true;console.log("err1");console.log(data);}
if($scope.calculator.data.tool=="samplesize"&&!data.pow){isError=true;console.log("err2");}
if($scope.calculator.data.tool=="power"&&(!data.df2||!data.lambda)){isError=true;console.log("err3");}}else if($scope.design.isRMPS1()){$scope.calculator.RMPS1calc($scope.calculator.data.esComb.effect,$scope.calculator.data.esComb.index);data=$scope.calculator.RMPS1;data.groups=$scope.calculator.data.groups;for(var ii=0;ii<$scope.calculator.data.esComb.effect.length;ii++){var tmp=$scope.calculator.data.esComb.effect[ii];if(!tmp){console.log("RM effect size error");isError=true;break;}}
if($scope.groupError==true||$scope.treatmentError==true||!data.tool||!data.df1||!data.df2||!data.lambda){isError=true;console.log("err1");}
if($scope.calculator.data.tool==("samplesize"&&!data.pow)){isError=true;console.log("err2");}
if($scope.calculator.data.tool=="power"&&(!data.df2||!data.lambda)){isError=true;console.log("err3");}}else if($scope.design.isRMCS1()){$scope.calculator.RMCS1calc();data=$scope.calculator.RMCS1;data.groups=$scope.calculator.data.groups;if($scope.groupError==true||$scope.treatmentError==true||!data.tool||!data.sig||!data.df1||!data.lambda){isError=true;console.log("err1");}
if($scope.calculator.data.tool=="samplesize"&&(!data.pow||!data.k)){isError=true;console.log("err2");}
if($scope.calculator.data.tool=="power"&&!data.df2){isError=true;console.log("err3");}}else{data=$scope.calculator.data;if($scope.groupError==true||$scope.treatmentError==true||!data.tool||!data.es||!data.sig||!data.groups){isError=true;console.log("err1");}
if($scope.calculator.data.tool=="samplesize"&&!data.pow){isError=true;console.log("err2");}
if($scope.calculator.data.tool=="power"&&!data.samplesize){isError=true;console.log("err3");}};data.treatmentsTotal=$scope.calculator.data.treatmentsTotal;data.test=$scope.design.stat.selectedOption.name;calculatorService.calcData=data;if(isError){$scope.anyError.tf=true;$scope.anyError.msg="Invalid input value";console.log("ERROR: invalid input value");deferred.resolve(false);}else{data.samplesize=$scope.calculator.data.samplesize;data.pow=$scope.calculator.data.pow;data.es=$scope.calculator.data.es;var nGroups=!designService.notEmbedded*designService.formData.nControlAdditionalSelected;if(designService.isANOVA2())
nGroups+=calculatorService.AOV2.k;else if(designService.isANOVAm())
nGroups+=calculatorService.AOVmulti.k;else if(designService.isRMPS1())
nGroups+=calculatorService.RMPS1.trtProd;else if(designService.isRMCS1())
nGroups+=calculatorService.RMCS1.k;$scope.nGroupsForCalcDisplay=nGroups;calculatorService.calculateComplete=false;doCalc(data).then(function(){data.samplesize=$scope.calculator.data.samplesize;data.pow=$scope.calculator.data.pow;calculatorService.calcData=Object.assign({},$scope.calculator.data,data);calculatorService.calculateComplete=true;deferred.resolve(true);});}
return deferred.promise;};}
app.controller('powerPlotsController',['$scope','$http','$q','calculatorService','designService','plotsService','$timeout',powerPlotsController]);function powerPlotsController($scope,$http,$q,calculatorService,designService,plotsService,$timeout)
{function computeUsingDG(){return!designService.notEmbedded;};$scope.updateFlag=true;$scope.chartConfig={refreshDataOnly:true,deepWatchData:true};$scope.plotOptions={processing:true,chart:{type:'lineChart',height:450,duration:0,margin:{top:20,right:20,bottom:60,left:65},yDomain:[0,50],color:d3.scale.category10().range(),useInteractiveGuideline:true,clipVoronoi:false,xAxis:{axisLabel:'Relative Effect Size',showMaxMin:false,tickFormat:function(d){return d3.format(',.3f')(d)}},yAxis:{axisLabel:'Sample Size per group',showMaxMin:false,tickFormat:function(d){return d3.format(',.0f')(d)}},zoom:{enabled:false,useFixedDomain:false,useNiceScale:true,horizontalOff:false,verticalOff:true,unzoomEventType:"dblclick.zoom"}}};$scope.plotData=[{key:"Power 1",type:"line",yAxis:1,values:[{x:0,y:1}]},{key:"Power 2",type:"line",yAxis:1,values:[{x:0,y:1}]},{key:"Power 3",type:"line",yAxis:1,values:[{x:0,y:1}]}];$scope.globData=[];$scope.data={nGroups:[2,2,2],aov2effect:{value:'M'},stat:{sig:0.05,sigOpts:[0.001,0.01,0.05,0.1]},};$scope.initPlot=function()
{for(var ii=0;ii<$scope.data.nGroups.length;ii++)
$scope.data.nGroups[ii]=designService.numGroups;if(designService.isANOVA2()){var tmp=designService.formData.treatments.concat(designService.formData.factors);$scope.data.nGroups=Array(tmp.length);for(var ii=0;ii<tmp.length;ii++){$scope.data.nGroups[ii]=tmp[ii].level.length;if(ii<designService.formData.treatments.length)
$scope.data.nGroups[ii]++;}}
if(designService.isANOVAm()){var tmp=designService.formData.treatments.concat(designService.formData.factors);$scope.AOVM.nGroups=Array(tmp.length);for(var ii=0;ii<tmp.length;ii++){$scope.AOVM.nGroups[ii]=tmp[ii].level.length;if(ii<designService.formData.treatments.length)
$scope.AOVM.nGroups[ii]++;}}
$scope.updatePlot();};$scope.calc=calculatorService;$scope.$watch('calc.calculateComplete',function(newval,oldval)
{if(newval===oldval)
return;if(designService.isRMPS1()||designService.isRMCS1())
return;if(newval==true)
updatePlotWithDG();});function updatePlotWithDG()
{if(designService.isSLM()||designService.isRMCS1()||designService.isRMPS1()||designService.isNone()){return;}
if(computeUsingDG())
{var nLevels=designService.count_factors_levels();$scope.data.nGroups=nLevels;if(designService.isANOVAm())
{$scope.AOVM.nGroups=$scope.data.nGroups;$scope.AOVM.nFactors=$scope.AOVM.nGroups.length;$scope.updateFlag=false;$scope.combAOVM();$scope.updateFlag=true;$scope.AOVM.nGroups=$scope.data.nGroups;}
var ss=$scope.calc.data.samplesize;var esMax=Number(designService.formData.effectSizeLarge);var esRel=Number(designService.formData.effectSize);if(esRel==0)
esRel=$scope.calc.data.esMean;if(esMax<=esRel)
esMax=2.0*esRel;if(typeof(ss)!=='number'){ss=Object.assign({},$scope.calc.data.samplesize);for(var ii=1;ii<ss.length;ii++)
ss[0]=((ss[ii]>ss[0])?ss[ii]:ss[0]);ss=ss[0];var ind1=$scope.AOVM.inputTypeSelection.id;var cols=$scope.AOVM.inputTypeOptions.length;var ind2=parseInt($scope.AOVM.interactions);var index=ind2+cols*ind1;ss=$scope.calc.data.samplesize[index];}
$scope.plotOptions.chart.xAxis.axisLabel='Effect Size';$scope.effectSize_slider={minValue:0.01,maxValue:esMax,options:{floor:0.01,ceil:esMax,showTicksValues:10,draggableRange:false,step:10,precision:2,onChange:function(){var slider=$scope.effectSize_slider;clipAxes(slider);}}};add_single_plot_data(esRel,ss,esMax);return;add_single_plot_data(esRel,ss,esMax).then(function(){deferred.resolve();return deferred.promise;});}};$scope.AOVM={comb:{data:[],display:[]},nGroups:[],nFactors:3,interactions:''+0,id:0,inputTypeSelection:{},inputTypeOptions:[{id:0,label:'Main'},{id:1,label:'2-Way'},{id:2,label:'3-Way'},{id:3,label:'4-Way'},{id:4,label:'5-Way'},],numdf:1,totGrpProd:1,lambda1:1};$scope.AOVM.inputTypeSelection=$scope.AOVM.inputTypeOptions[0];$scope.power_slider={minValue:0.7,maxValue:0.9,options:{floor:0.7,ceil:0.9,showTicksValues:true,draggableRange:false,step:0.1,precision:1,ticksArray:[0.7,0.80,0.9],onChange:function()
{$scope.updatePlot();},onStart:function()
{$timeout(function(){$scope.$broadcast('rzSliderForceRender');});}}};$scope.effectSizeRel_slider={minValue:0.01,maxValue:2.0,options:{floor:0.01,ceil:2.0,showTicksValues:0.5,draggableRange:false,step:0.01,precision:2,onChange:function(){var slider=$scope.effectSizeRel_slider;clipAxes(slider);}}};$scope.effectSize_slider={minValue:0.01,maxValue:2.0,options:{floor:0.01,ceil:2.0,showTicksValues:0.5,draggableRange:false,step:0.01,precision:2,onChange:function(){var slider=$scope.effectSize_slider;clipAxes(slider);}}};$scope.sampleSize_slider={minValue:2,maxValue:50,options:{floor:2,ceil:50,showTicksValues:25,draggableRange:false,step:1,precision:0,onChange:function(){var slider=$scope.sampleSize_slider;clipAxes(slider);}}};function slidersReset(){var sliderNames=["sampleSize_slider","effectSize_slider","effectSizeRel_slider","power_slider"];for(var ii=0;ii<sliderNames.length;ii++){$scope[sliderNames[ii]].minValue=$scope[sliderNames[ii]].options.floor;$scope[sliderNames[ii]].maxValue=$scope[sliderNames[ii]].options.ceil;};};function clipAxes(xy){$scope.plotData=[];for(var ii=0;ii<$scope.globData.length;ii++){$scope.plotData.push();$scope.plotData[ii]=Object.assign({},$scope.globData[ii]);}
var ySlider=$scope.sampleSize_slider;var xSlider=$scope.effectSizeRel_slider;if(computeUsingDG())
xSlider=$scope.effectSize_slider;clipAxis(xSlider.minValue,xSlider.maxValue,'x');clipAxis(ySlider.minValue,ySlider.maxValue,'y');$scope.plotOptions.chart.yDomain=[ySlider.minValue,ySlider.maxValue];$scope.plotOptions.chart.xDomain=[xSlider.minValue,xSlider.maxValue];};function clipAxis(vmin,vmax,xy)
{for(var kk=0;kk<$scope.plotData.length;kk++){var tmpArray=$scope.plotData[kk].values;var tmp2=tmpArray.filter(function(el){inRange=(el[xy]>=vmin)&&(el[xy]<=vmax);return inRange;});$scope.plotData[kk].values=tmp2.slice();}};$scope.updateAOVMselection=function()
{var dataNDX=$scope.AOVM.inputTypeSelection.id;var data=$scope.AOVM.comb.display;var tmp=$scope.AOVM.comb.display[dataNDX];var tmpNDX=parseInt($scope.AOVM.interactions);if(typeof(tmp)!=='undefined')
{var intStr=tmp[tmpNDX];var numdf=1;var nGroupsProd=1;var totGrpProd=1;var totalStr=$scope.AOVM.comb.display[$scope.AOVM.comb.display.length-1][0];for(var ii=0;ii<totalStr.length;ii++)
{var nGroups=$scope.AOVM.nGroups[ii];totGrpProd=totGrpProd*nGroups;}
for(var ii=0;ii<intStr.length;ii++)
{var ndx=totalStr.indexOf(intStr[ii]);var nGroups=$scope.AOVM.nGroups[ndx];numdf=numdf*(nGroups-1);nGroupsProd=nGroupsProd*nGroups;}
var lambda1=totGrpProd*numdf/nGroupsProd;$scope.AOVM.numdf=numdf;$scope.AOVM.totGrpProd=totGrpProd;$scope.AOVM.lambda1=lambda1;}
else
{console.log('undef');}
if($scope.updateFlag)
$scope.updatePlot();};$scope.interactionHighlight=function()
{$scope.AOVM.interactions=''+0;$scope.updateAOVMselection();};var makeAOVMoptions=function()
{var n=$scope.AOVM.nFactors;if(!computeUsingDG())
$scope.AOVM.nGroups=[2];$scope.AOVM.inputTypeOptions=[{id:0,label:'Main'}];for(var ii=1;ii<n;ii++)
{var str=(ii+1)+'-Way';$scope.AOVM.inputTypeOptions.push({id:ii,label:str});if(!computeUsingDG())
$scope.AOVM.nGroups.push(2)}
$scope.interactionHighlight();};$scope.combAOVM=function()
{$scope.AOVM.inputTypeSelection=$scope.AOVM.inputTypeOptions[0];var tmp=generateCombinations($scope.AOVM.nFactors);$scope.AOVM.comb.data=tmp;var convert2Char=function(keh){return String.fromCharCode(65+keh-1)};var n=0;for(var ii=0;ii<tmp.length;ii++){var sub=tmp[ii];$scope.AOVM.comb.display[ii]=[];for(var jj=0;jj<sub.length;jj++){var str='';for(var kk=0;kk<sub[jj].length;kk++){n=parseInt(sub[jj][kk])
str=str+convert2Char(n);}
$scope.AOVM.comb.display[ii][jj]=str;}}
makeAOVMoptions();};$scope.resetPlot=function()
{$scope.AOVM.nGroups=2;$scope.data.nGroups=[2,2,2];for(var ii=0;ii<designService.formData.treatments.length;ii++)
$scope.data.nGroups[ii]=$scope.calc.treatments.levels;$scope.updatePlot();};$scope.singleDataPoint=[];$scope.updatePlot=function()
{$scope.plotOptions.processing=true;d3.selectAll('.nvtooltip').remove();if(designService.isSLM()||designService.isRMCS1()||designService.isRMPS1()||designService.isNone()){return;}
$timeout(function(){$scope.$broadcast('rzSliderForceRender');},500);if(computeUsingDG()){var ID=$scope.design.stat.selectedOption.id;var esAbs=$scope.effectSize_slider;var minV=calculatorService.effectCalc2(ID,esAbs.minValue);var maxV=calculatorService.effectCalc2(ID,esAbs.maxValue);$scope.effectSizeRel_slider.minValue=minV;$scope.effectSizeRel_slider.maxValue=maxV;}
var numdf=$scope.AOVM.numdf;var totGrpProd=$scope.AOVM.totGrpProd;var lambda1=$scope.AOVM.lambda1;var test=$scope.design.stat.selectedOption.name;var dataIn={'test':test,'effect':$scope.effectSizeRel_slider,'power':$scope.power_slider,'sig':$scope.data.stat.sig,'nGroups':$scope.data.nGroups,'aovEffect':$scope.data.aov2effect.value,'totGrpProd':$scope.AOVM.totGrpProd,'numdf':$scope.AOVM.numdf,'lambda1':$scope.AOVM.lambda1,'aovm':$scope.AOVM};plotsService.updateData(dataIn);return $http({method:'POST',url:'/power_plot_calc',data:dataIn,headers:{'Content-Type':'application/json'},}).then(function successCallback(response){slidersReset();var data=response.data;var rows=data.y.length;var cols=data.y[0].length;var effectMin=$scope.effectSizeRel_slider.options.floor;var effectMax=$scope.effectSizeRel_slider.options.ceil;if(computeUsingDG())
{effectMin=$scope.effectSize_slider.minValue;effectMax=$scope.effectSize_slider.maxValue;$scope.effectSize_slider.options.step=(effectMax-effectMin)/10;$scope.effectSize_slider.options.precision=5;}
var powerMin=$scope.power_slider.minValue;var powerMax=$scope.power_slider.maxValue;var sampleMin=$scope.sampleSize_slider.options.floor;var sampleMax=$scope.sampleSize_slider.options.ceil;$scope.plotData=[];$scope.globData=[];for(var jj=0;jj<rows;jj++)
{var power=powerMin+jj*$scope.power_slider.options.step;power=Math.round(power*100)/100;var powerVals=data.y[jj];for(var ii=0;ii<cols;ii++)
{var x0=data.x[ii];var y0=powerVals[ii];if(computeUsingDG()){x0=calculatorService.effectCalc2_inv($scope.design.stat.selectedOption.id,x0);}
powerVals[ii]={x:x0,y:Math.round(y0*100)/100};}
$scope.plotData.push({type:"line",yAxis:1,key:"Power "+(power),values:powerVals});}
$scope.plotOptions.chart.xDomain=[effectMin,effectMax];$scope.plotOptions.chart.yDomain=[sampleMin,sampleMax];if($scope.singleDataPoint.length!==0)
$scope.plotData.push($scope.singleDataPoint);$scope.globData=$scope.plotData.slice();$scope.plotOptions.processing=false;if(computeUsingDG()){$scope.effectSize_slider.options.onChange();}
d3.selectAll('.nvtooltip').remove();return;$timeout(function(){},500);},function errorCallback(response){$scope.plotOptions.processing=false;console.log("error")});};function add_single_plot_data(effectSize,sampleSize,maxEffectSize)
{var deferred=$q.defer();var s=$scope.plotData.length;$scope.singleDataPoint={type:"line",yAxis:1,key:"You are here",color:"black",values:[{x:effectSize,y:sampleSize,shape:"circle",size:20.0*Math.random()}]};$scope.updatePlot().then(function(){$scope.effectSize_slider.maxValue=maxEffectSize;$scope.effectSize_slider.options.ceil=maxEffectSize;deferred.resolve();return deferred.promise;});return deferred.promise;};if(!computeUsingDG())
$scope.combAOVM();};app.controller('simPlotCtrl',['$scope','$http','$q','designService','calculatorService','plotsService','$timeout','$interval','$state',function($scope,$http,$q,designService,calculatorService,plotsService,$timeout,$interval,$state)
{function isAnalysisPage(){return $state.current.name=='tools.analysis';};$scope.dataBlob=function(txt){$scope.data.dataIn=txt;};$scope.chartConfig={refreshDataOnly:false,deepWatchData:true};$scope.$watch('data.dataIn',function(nv,ov){if(isAnalysisPage()&&(nv!==ov)){$scope.updateSimPlot();}});$scope.simForm=false;$scope.checkValid=function(simForm,keyName){$scope.simForm=simForm;if(keyName){var inp=simForm[keyName];return inp.$valid;}};$scope.simPlotExists=function(){return(designService.isANOVA1()||designService.isTTest2()||designService.isANOVA2()||(designService.isANOVAm()&&$scope.data.nLevels3.length==3));};function computeUsingDG(){return!designService.notEmbedded;};function exampleData(){var plotData=[];for(var jj=0;jj<3;jj++){var tmp=[];for(var ii=0;ii<10;ii++){var yVal=10*Math.random();tmp.push({x:ii,y:yVal,low:0.9*yVal,high:1.1*yVal});}
plotData.push({key:'Main Factor, Level '+(jj+1),values:tmp});};return plotData;};$scope.render={data:null};function initRenderData(){$scope.render.data=[];};initRenderData();function addRenderData(){$scope.render.data.push(false);return $scope.render.data.length-1;};function makeRenderEndEvent(par,ndx){par.chart.dispatch={renderEnd:function(e){$scope.render.data[ndx]=true;}};};function makeBoxPlotOptions(){var opts={processing:true,chart:{type:'boxPlotGroupedChart',height:450,duration:0,margin:{top:20,right:20,bottom:45,left:45},x:function(d){return d.group;},showControls:false,maxBoxWidth:75,legend:{updateState:false,},}};return opts;};function makeMultiBarOptions(){var opts={processing:true,chart:{type:'multiBarChart',height:450,duration:0,margin:{top:20,right:20,bottom:45,left:45},wrapLabels:true,showControls:false,groupSpacing:0.5,legend:{updateState:false,},legendPosition:'right',clipEdge:true,stacked:false,yDomain:[-1,11],xAxis:{axisLabel:'Secondary Factor',showMaxMin:false,tickFormat:function(d){return d3.format(',f')(d);}},}};return opts;};$scope.multiBar={options:makeMultiBarOptions(),data:exampleData()};$scope.boxPlots={options:makeBoxPlotOptions(),data:null,};function initData(){$scope.data={mu:5,sig:0.05,effectSize:1,std:1,n:10,p:2,iType:"linear",powerVal:0.8,pVal:null,id:8,dataIn:null,nLevels:[2,2],nLevels3:[2,2,2]};};initData();$scope.response={shape:{},options:[{label:"Increasing",value:"linearUp"},{label:"Decreasing",value:"linearDown"},{label:"U-shape",value:"regU"},{label:"Inverted U-shape",value:"invertedU"}]};$scope.response2={shape:{},options:[{label:"Cooperative",value:"coop"},{label:"Opposing",value:"oppo"}]};$scope.response.shape=$scope.response.options[0];$scope.response2.shape=$scope.response2.options[0];$scope.anova={response:[$scope.response.options[0],$scope.response.options[0],$scope.response2.options[0]],};var graphConstants={xrange:[0,100],x:[30,55],errorW:4,barWidth:10};$scope.myOptions=makeOptions();function makeOptions(){var myOptions={processing:true,chart:{type:'multiChart',wrapLabels:true,duration:0,height:475,margin:{top:30,right:60,bottom:75,left:70},legend:{maxKeyLength:100,updateState:false,},yDomain1:[0,100],xAxis:{tickFormat:function(d){return null;}},yAxis1:{axisLabel:'',tickFormat:function(d){return d3.format(',.0f')(d);}},}};return myOptions;};function makeErrorBar(xMid,yLow,yHigh,label)
{var tmp=graphConstants.errorW/2.0;var xLow=xMid-tmp;var xHigh=xMid+tmp;var C="black";var W=2;var errorData=[{type:"line",yAxis:1,key:label,strokeWidth:W,color:C,showLegend:false,values:[{x:xLow,y:yHigh},{x:xHigh,y:yHigh},{x:xHigh,y:null},{x:xLow,y:yLow},{x:xHigh,y:yLow},{x:xMid,y:yLow},{x:xMid,y:yHigh}]}];return errorData;};function adjustBarSpacing()
{var barW=graphConstants.barWidth/2.0;var nBars=$scope.data.p;var tmp1=graphConstants.xrange[1]/(nBars+2);$scope.myOptions.chart.xAxis.tickValues=Array(nBars);graphConstants.x=Array(nBars);for(var ii=0;ii<nBars;ii++)
{graphConstants.x[ii]=tmp1*(ii+1)+(ii+1)*barW;$scope.myOptions.chart.xAxis.tickValues[ii]=graphConstants.x[ii];}
$scope.myOptions.chart.xAxis.tickFormat=function(d)
{return appendTickLabels(d);};};function appendTickLabels(d){for(var ii=0;ii<graphConstants.x.length;ii++)
{var dist=Math.abs(d-graphConstants.x[ii]);if(dist<=0.1)
{var xTickStr="Group "+(ii+1);return xTickStr;if(designService.DGcompleted&&!HELP_PAGE_FLAG)
{var tmp=designService.formData.treatment_table[ii];xTickStr+=tmp.group;}
return xTickStr;}}
return null;};function makeBars(y)
{var barW=graphConstants.barWidth/2.0;var barsT={type:"line",yAxis:1,color:"#7E7E7E",area:true,key:"Bars",showLegend:false,values:[]};var nBars=$scope.data.p;for(var ii=0;ii<nBars;ii++)
{var xL=graphConstants.x[ii]-barW;var xH=graphConstants.x[ii]+barW;barsT.values=barsT.values.concat({x:xL-1,y:null},{x:xL,y:y[ii]},{x:xH,y:y[ii]},{x:xH+1,y:null})}
return barsT;};function gen_rand_color()
{var componentToHex=function(c){var hex=c.toString(16);return hex.length==1?"0"+hex:hex;}
var rgbToHex=function(r,g,b){return"#"+componentToHex(r)+componentToHex(g)+componentToHex(b);}
var getRandomInt=function(min,max){min=Math.ceil(min);max=Math.floor(max);return Math.floor(Math.random()*(max-min))+min;}
return rgbToHex(getRandomInt(10,200),getRandomInt(100,200),getRandomInt(150,200));};function makePopLevels(levels)
{var lines=[];var XL=graphConstants.xrange[0];var XU=graphConstants.xrange[1];for(var ii=0;ii<levels.length;ii++)
{var label="Group "+(ii+1)+" Population Level";var tColor=gen_rand_color();lines.push({type:"line",color:tColor,yAxis:1,key:label,values:[{x:XL,y:levels[ii]},{x:XU,y:levels[ii]}]});}
return lines;};function make_rand_data(){var data={x:null,y:null,myStats:{delta:[5,6],xbar:[45,70],errBarL:[55,80],errBarU:[60,85],quantiles:[0,1,2,3,4,5]}};data.x=new Array(10);for(var ii=0;ii<$scope.data.p;ii++)
{for(var jj=0;jj<$scope.data.n;jj++)
{var ndx=jj+ii*$scope.data.n;var max=80,min=50;data.x[ndx]=Math.random()*(max-min)+min;}}
return data;};function make3WaySimData(data)
{if(!data){data=make_rand_data();}else{$scope.data.nLevels3=data.myStats.nLevels;}
if(isAnalysisPage()){$scope.data.n=data.myStats.n;var nSubCopy=[];for(var ii=0;ii<$scope.data.n.length;ii++)
for(var jj=0;jj<$scope.data.n[ii].length;jj++)
for(var kk=0;kk<$scope.data.n[ii][jj].length;kk++)
nSubCopy.push($scope.data.n[ii][jj][kk]);$scope.data.n=nSubCopy;}
var nBars=$scope.data.nLevels3[0];var nGroups=$scope.data.nLevels3[1];var nPlots=$scope.data.nLevels3[2];$scope.multiBar.data=new Array(nPlots);$scope.multiBar.options=new Array(nPlots);var xBar=data.myStats.xbar;var errBarL=data.myStats.errBarL;var errBarU=data.myStats.errBarU;$scope.boxPlots.options=[]
$scope.boxPlots.data=[];var qDataGlob=data.myStats.quantiles;for(var index=0;index<nPlots;index++)
{$scope.multiBar.data[index]=[];$scope.multiBar.options[index]=makeMultiBarOptions();var rendNdx=addRenderData();makeRenderEndEvent($scope.multiBar.options[index],rendNdx);var yMax=-1;var yMin=0;$scope.boxPlots.options.push(makeBoxPlotOptions());$scope.boxPlots.options[index].chart.type='boxPlotGroupedChart';$scope.boxPlots.data.push([]);var rendNdx2=addRenderData();makeRenderEndEvent($scope.boxPlots.options[index],rendNdx2);for(var ii=0;ii<nBars;ii++){var tmpData=[];for(var jj=0;jj<nGroups;jj++){var yLow=errBarL[ii][jj][index];var yHigh=errBarU[ii][jj][index];yMax=(yHigh>yMax)?yHigh:yMax;yMin=(yLow<yMin)?yLow:yMin;tmpData.push({x:jj+1,y:xBar[ii][jj][index],low:yLow,high:yHigh});var qGrpFactor=qDataGlob[ii][jj][index];var tmpBoxData={label:'Main Factor '+(ii+1)+' '+jj,key:'Main Factor, Level '+(ii+1),showLegend:(jj>0)?false:true,group:jj+1,series:ii+1,values:{Q1:qGrpFactor[1],Q2:qGrpFactor[2],Q3:qGrpFactor[3],whisker_low:qGrpFactor[0],whisker_high:qGrpFactor[4],outliers:[]}};$scope.boxPlots.data[index].push(tmpBoxData);}
var keyName='Factor 1, Level '+(ii+1);$scope.multiBar.data[index].push({key:keyName,values:tmpData});}
$scope.multiBar.options[index].chart.yDomain=[yMin*1.1,yMax*1.1];$scope.boxPlots.options[index].chart.xAxis={axisLabel:'Secondary Factor',};}};function make2WaySimData(data)
{$scope.multiBar.options=makeMultiBarOptions();initRenderData();var rendNdx0=addRenderData();makeRenderEndEvent($scope.multiBar.options,rendNdx0);if(!data){data=make_rand_data();}else{$scope.data.nLevels=data.myStats.nLevels;}
if(isAnalysisPage()){$scope.data.n=data.myStats.n;var nSubCopy=[];for(var ii=0;ii<$scope.data.n.length;ii++)
for(var jj=0;jj<$scope.data.n[ii].length;jj++)
nSubCopy.push($scope.data.n[ii][jj]);$scope.data.n=nSubCopy;}
$scope.multiBar.data=[];var xBar=data.myStats.xbar;var yMax=-1;var yMin=0;$scope.boxPlots.options=makeBoxPlotOptions();$scope.boxPlots.options.chart.type='boxPlotGroupedChart';$scope.boxPlots.data=[];var rendNdx=addRenderData();makeRenderEndEvent($scope.boxPlots.options,rendNdx);for(var ii=0;ii<xBar.length;ii++){var tmpData=[];for(var jj=0;jj<xBar[ii].length;jj++){var yLow=data.myStats.errBarL[ii][jj];var yHigh=data.myStats.errBarU[ii][jj];yMax=(yHigh>yMax)?yHigh:yMax;yMin=(yLow<yMin)?yLow:yMin;tmpData.push({x:jj+1,y:xBar[ii][jj],low:yLow,high:yHigh});var qGrpFactor=data.myStats.quantiles[ii][jj];var tmpBoxData={label:'Main Factor '+(jj+1)+' '+ii,key:'Main Factor, Level '+(ii+1),showLegend:(jj>0)?false:true,group:jj+1,series:ii+1,values:{Q1:qGrpFactor[1],Q2:qGrpFactor[2],Q3:qGrpFactor[3],whisker_low:qGrpFactor[0],whisker_high:qGrpFactor[4],outliers:[]}};$scope.boxPlots.data.push(tmpBoxData);}
$scope.multiBar.data.push({key:'Main Factor, Level '+(ii+1),values:tmpData});}
$scope.multiBar.options.chart.yDomain=[yMin*1.1,yMax*1.1];$scope.boxPlots.options.chart.xAxis={axisLabel:'Secondary Factor',};};function makeSimData(data)
{$scope.myOptions=makeOptions();if(!data){data=make_rand_data();}else{$scope.data.p=data.myStats.p;$scope.data.n=data.myStats.n;}
var nSubCopy=$scope.data.n;if(!isAnalysisPage()){nSubCopy=[];for(var ii=0;ii<$scope.data.p;ii++)
nSubCopy.push($scope.data.n);}
adjustBarSpacing();$scope.myData=[];$scope.myData=$scope.myData.concat(makeBars(data.myStats.xbar));for(var ii=0;ii<$scope.data.p;ii++)
{var xMid=graphConstants.x[ii];var yLow=data.myStats.errBarL[ii];var yHigh=data.myStats.errBarU[ii];var label="Group "+(ii+1)+" Error";$scope.myData=$scope.myData.concat(makeErrorBar(xMid,yLow,yHigh,label));}
$scope.myData.push({type:"scatter",yAxis:1,key:"Scatter",color:"#ff4c4c",showLegend:false,values:[]});var L=$scope.myData.length-1;var yMax=0;var yMin=0;var qData=data.myStats.quantiles;$scope.boxPlots.options=makeBoxPlotOptions();$scope.boxPlots.options.chart.type='boxPlotChart';$scope.boxPlots.data=[];var ndx=0;for(var ii=0;ii<$scope.data.p;ii++)
{for(var jj=0;jj<nSubCopy[ii];jj++)
{var DATVAL=data.x[ndx];$scope.myData[L].values.push({x:graphConstants.x[ii],y:DATVAL,shape:"circle",size:3.0});yMax=(yMax>DATVAL)?yMax:DATVAL;yMin=(yMin<DATVAL)?yMin:DATVAL;ndx=ndx+1;}
var tmpData={label:'Sample '+ii,group:'Group '+(ii+1),values:{Q1:data.myStats.quantiles[ii][1],Q2:data.myStats.quantiles[ii][2],Q3:data.myStats.quantiles[ii][3],whisker_low:data.myStats.quantiles[ii][0],whisker_high:data.myStats.quantiles[ii][4],outliers:[]}};$scope.boxPlots.data.push(tmpData);}
if(!isAnalysisPage()){$scope.myData=$scope.myData.concat(makePopLevels(data.myStats.delta));}
$scope.myOptions.chart.yDomain1=[yMin*1.5,yMax*1.5];initRenderData();var rendNdx0=addRenderData();$scope.myOptions.chart.lines1={dispatch:{renderEnd:function(e){$scope.render.data[rendNdx0]=true;}}};var rendNdx=addRenderData();makeRenderEndEvent($scope.boxPlots.options,rendNdx);$scope.boxPlots.options.chart.yDomain=$scope.myOptions.chart.yDomain1;};if(!isAnalysisPage())
makeSimData();var HELP_PAGE_FLAG=false;$scope.initSimPlot=function(data)
{initData();if(data){HELP_PAGE_FLAG=true;$scope.plotsHelpService=plotsService.help;$scope.$watch('plotsHelpService.simPlotData',function(newval,oldval)
{var data=newval;$scope.data.effectSize=data.es;$scope.data.powerVal=(data.powerVal);$scope.data.sig=data.sigLevel;$scope.data.std=data.sd0;$scope.data.mu=$scope.data.std*4.0;$scope.data.n=data.ss;$scope.data.p=data.nGroups;$scope.data.id=data.id;$scope.updateSimPlot($scope.data.id);},true);$scope.data.effectSize=data.es;$scope.data.powerVal=Number(data.powerVal[0]);$scope.data.sig=data.sigLevel;$scope.data.std=data.sd0;$scope.data.mu=$scope.data.std*4.0;$scope.n=data.ss;$scope.p=data.nGroups;$scope.data.id=data.id;$scope.updateSimPlot($scope.data.id);return;}
if(computeUsingDG())
{var es=Number(designService.formData.effectSize);var stdev=Number(designService.formData.stdev);var treatments=designService.formData.treatments;var factors=designService.formData.factors;es=calculatorService.data.esMean;stdev=calculatorService.data.esSD_AOV;$scope.data.p=designService.numGroups;$scope.data.effectSize=es;$scope.data.std=stdev;$scope.data.n=calculatorService.data.samplesize[0];$scope.data.mu=$scope.data.std*4.0;var nLevelsStr='nLevels';if(designService.isANOVA2()){$scope.data.nLevels=[2,2];}
if(designService.isANOVAm()){nLevelsStr='nLevels3';$scope.data.nLevels3=[2,2,2];}
if(designService.isANOVA2()||designService.isANOVAm()){var nLevels=designService.count_factors_levels();for(var ii=0;ii<nLevels.length;ii++)
$scope.data[nLevelsStr][ii]=nLevels[ii];}else{$scope.myOptions.chart.yAxis1.axisLabel=designService.formData.obsUnits;}
$scope.calc=calculatorService.data;$scope.$watch('calc.samplesize',function(newval,oldval)
{if(computeUsingDG()){var tmp=newval;if(Array.isArray(newval))
tmp=newval[0];$scope.data.n=tmp;$scope.updateSimPlot();}else{return;}});}
$scope.updateSimPlot();};var watchCount=0;$scope.callPythonToPlot=function()
{var def=$q.defer();var isRendered=function(){return $scope.render.data.every(function(val){return val==true;})};var intervalFn,watcher,fnDelay=100,fnCount=50;if(designService.notEmbedded){fnCount=1;}
watcher=$scope.$watch('render.data',function(nv,ov){if(isRendered()){$interval.cancel(intervalFn);}},true);$scope.myOptions.processing=true;plotsService.updateData($scope.data);d3.selectAll('.nvtooltip').remove();$http({method:'POST',url:'/sim_plot_calc',data:$scope.data,headers:{'Content-Type':'application/json'},}).then(function successCallback(response){var data=response.data;if(data.error){$scope.data.error=data.msg;def.resolve();return;}
$scope.data.error=false;data.x=data.myStats.y;if(!isAnalysisPage()||(isAnalysisPage()&&watchCount==0)){$scope.data.dataIn=data.myStats.csvdata;watchCount=watchCount+1;}
$scope.data.pVal=data.myStats.pValue;if(!isAnalysisPage()){for(var ii=0;ii<data.myParms.powerVal.length;ii++){data.myParms.powerVal[ii]=data.myParms.powerVal[ii].toFixed(3);}
$scope.data.powerVal=data.myParms.powerVal;}
if(designService.isANOVAm()){make3WaySimData(data);}else if(designService.isANOVA2()){make2WaySimData(data);}else{makeSimData(data);designService.graphsText="p-value this sim: "+$scope.data.pVal[0].toExponential(3);}
intervalFn=$interval(isRendered,fnDelay,fnCount);var endAll=function(){watcher();def.resolve();};var newprom=intervalFn.then(function(tmp){endAll();},function errorCallback(resp){endAll();});},function errorCallback(response){console.log("error")
def.resolve();});return def.promise;};$scope.updateSimPlot=function(id_inp)
{var test="two.sample";var id=designService.stat.selectedOption.id;$scope.data.test=designService.stat.selectedOption.name;if(id_inp){id=id_inp;$scope.data.test=designService.getTest(id);}else{}
if(id!==8&&id!==1&&id!==7&&id!==2){$scope.myOptions.processing=false;console.log("No sim plot for id",id);return;}
if($scope.simForm){if($scope.simForm.$invalid){console.log("invalid form. do nothing.");$scope.myOptions.processing=false;return;}}
if(designService.isTTest2())
$scope.data.p=2;$scope.data.iType=$scope.response.shape.value;if(designService.isANOVA2()){$scope.data.iType=[$scope.anova.response[0].value,$scope.anova.response[1].value,$scope.anova.response[2].value];}
if(designService.isANOVAm()){$scope.data.iType=[$scope.anova.response[0].value,$scope.anova.response[2].value];if($scope.data.nLevels3.length!=3){$scope.myOptions.processing=false;console.log("ANOVAm nLevels",$scope.data.nLevels3.length);return;}}
if(isAnalysisPage()){$scope.data.csvdata=$scope.data.dataIn;};$scope.callPythonToPlot().then(function(){$scope.myOptions.processing=false;$timeout(function(){window.dispatchEvent(new Event('resize'));},100);});};}]);app.controller('rngController',['$scope','$http','$rootScope','$timeout',function($scope,$http,$rootScope,$timeout){$scope.data={isCrossOver:false,n:5,nTreatments:2,nNonTreatments:1,treatmentLevels:[2,3],nonTreatmentLevels:[2],table:[],};$scope.dataOut={nGroups:1};$scope.range=function(n){return new Array(n);};$scope.$watch('data.nTreatments',function(nv,ov){var dist=nv-ov;for(var ii=0;ii<Math.abs(dist);ii++){if(nv>ov)
$scope.data.treatmentLevels.push(2);else
$scope.data.treatmentLevels.pop();}
$scope.trtUpdate();});$scope.$watch('data.nNonTreatments',function(nv,ov){var dist=nv-ov;for(var ii=0;ii<Math.abs(dist);ii++){if(nv>ov)
$scope.data.nonTreatmentLevels.push(2);else
$scope.data.nonTreatmentLevels.pop();}});$scope.nTreat=function(){return $scope.data.treatmentLevels.length;};$scope.nNonTreat=function(){return $scope.data.nonTreatmentLevels.length;};$scope.maxLevels=function(){return $scope.nTreat()>=$scope.nNonTreat()?$scope.nTreat():$scope.nNonTreat();};$scope.trtUpdate=function(){var nGroups=1;for(var ii=0;ii<$scope.data.treatmentLevels.length;ii++){nGroups=nGroups*$scope.data.treatmentLevels[ii];}
$scope.dataOut.nGroups=nGroups;};$scope.rngCalc=function(){$http({method:'POST',url:'/rng_table',data:$scope.data,headers:{'Content-Type':'application/json'},}).then(function successCallback(response){$scope.data.table=response.data;},function errorCallback(response){console.log(response)});};}]);app.controller('fileController',['$scope','$http','$timeout','$q',function($scope,$http,$timeout,$q){$scope.csvdata='';$scope.display={data:'Random data initialized'};$scope.getFile=function(){return postFormData();};function postFormData(){var formData=new FormData();formData.append('file',$scope.file);return $http({method:'POST',url:'/uploadCSV',data:formData,transformRequest:angular.identity,headers:{'Content-Type':undefined}}).then(function successCallback(response){var content=response.data.content;var status=response.data.status;if(status){$scope.display.data='File loaded: '+$scope.file.name;$scope.myfun(content);}else{$scope.display.data='File load error!';}
return $scope.plotDataFn();$timeout(function(){$scope.display.data=''},2000);},function errorCallback(response){console.log('error response',response);});};$scope.myfun=false;$scope.plotDataFn=false;$scope.fileController_handler=function(myfun,plotDataFn){$scope.myfun=myfun;$scope.plotDataFn=plotDataFn;};$scope.downloadCSV=function(text){if(!text){text=$scope.csvdata;}
var filename='simData.csv';var element=document.createElement('a');element.setAttribute('href','data:text/csv;charset=utf-8,'+encodeURIComponent(text));element.setAttribute('download',filename);element.style.display='none';document.body.appendChild(element);element.click();document.body.removeChild(element);};}]);app.directive("ngFile",function(){return{link:function($scope,el){el.bind("change",function(e){$scope.file=(e.srcElement||e.target).files[0];$scope.getFile().then(function(){(e.srcElement||e.target).value='';});})}}});